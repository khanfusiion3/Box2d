var Box2D={};
(function(t,n){function w(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(g,e,h){h.get instanceof Function&&g.__defineGetter__(e,h.get);h.set instanceof Function&&g.__defineSetter__(e,h.set)});t.inherit=function(g,e){w.prototype=e.prototype;g.prototype=new w;g.prototype.constructor=g};t.generateCallback=function(g,e){return function(){e.apply(g,arguments)}};
t.NVector=function(g){g===n&&(g=0);for(var e=Array(g||0),h=0;h<g;++h)e[h]=0;return e};t.is=function(g,e){return null===g?!1:e instanceof Function&&g instanceof e||g.constructor.__implements!=n&&g.constructor.__implements[e]?!0:!1};t.parseUInt=function(g){return Math.abs(parseInt(g))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"===typeof Box2D&&(Box2D={});"undefined"===typeof Box2D.Collision&&(Box2D.Collision={});
"undefined"===typeof Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={});"undefined"===typeof Box2D.Common&&(Box2D.Common={});"undefined"===typeof Box2D.Common.Math&&(Box2D.Common.Math={});"undefined"===typeof Box2D.Dynamics&&(Box2D.Dynamics={});"undefined"===typeof Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={});"undefined"===typeof Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={});"undefined"===typeof Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={});
(function(){function t(){t.AABB.apply(this,arguments)}function n(){n.Bound.apply(this,arguments)}function w(){w.BoundValues.apply(this,arguments);this.constructor===w&&this.BoundValues.apply(this,arguments)}function g(){g.Collision.apply(this,arguments)}function e(){e.ContactID.apply(this,arguments);this.constructor===e&&this.ContactID.apply(this,arguments)}function h(){h.ContactPoint.apply(this,arguments)}function A(){A.Distance.apply(this,arguments)}function c(){c.DistanceInput.apply(this,arguments)}
function v(){v.DistanceOutput.apply(this,arguments)}function J(){J.DistanceProxy.apply(this,arguments)}function D(){D.DynamicTree.apply(this,arguments);this.constructor===D&&this.DynamicTree.apply(this,arguments)}function z(){z.DynamicTreeBroadPhase.apply(this,arguments)}function B(){B.DynamicTreeNode.apply(this,arguments)}function x(){x.DynamicTreePair.apply(this,arguments)}function M(){M.Manifold.apply(this,arguments);this.constructor===M&&this.Manifold.apply(this,arguments)}function N(){N.ManifoldPoint.apply(this,
arguments);this.constructor===N&&this.ManifoldPoint.apply(this,arguments)}function d(){d.Point.apply(this,arguments)}function E(){E.RayCastInput.apply(this,arguments);this.constructor===E&&this.RayCastInput.apply(this,arguments)}function q(){q.RayCastOutput.apply(this,arguments)}function G(){G.Segment.apply(this,arguments)}function H(){H.SeparationFunction.apply(this,arguments)}function K(){K.Simplex.apply(this,arguments);this.constructor===K&&this.Simplex.apply(this,arguments)}function y(){y.SimplexCache.apply(this,
arguments)}function O(){O.SimplexVertex.apply(this,arguments)}function F(){F.TimeOfImpact.apply(this,arguments)}function I(){I.TOIInput.apply(this,arguments)}function P(){P.WorldManifold.apply(this,arguments);this.constructor===P&&this.WorldManifold.apply(this,arguments)}function L(){L.ClipVertex.apply(this,arguments)}function a(){a.Features.apply(this,arguments)}function f(){f.CircleShape.apply(this,arguments);this.constructor===f&&this.CircleShape.apply(this,arguments)}function u(){u.EdgeChainDef.apply(this,
arguments);this.constructor===u&&this.EdgeChainDef.apply(this,arguments)}function m(){m.EdgeShape.apply(this,arguments);this.constructor===m&&this.EdgeShape.apply(this,arguments)}function k(){k.MassData.apply(this,arguments)}function C(){C.PolygonShape.apply(this,arguments);this.constructor===C&&this.PolygonShape.apply(this,arguments)}function r(){r.Shape.apply(this,arguments);this.constructor===r&&this.Shape.apply(this,arguments)}function b(){b.Color.apply(this,arguments);this.constructor===b&&this.Color.apply(this,
arguments)}function l(){l.Settings.apply(this,arguments)}function p(){p.Mat22.apply(this,arguments);this.constructor===p&&this.Mat22.apply(this,arguments)}function Q(){Q.Mat33.apply(this,arguments);this.constructor===Q&&this.Mat33.apply(this,arguments)}function Ca(){Ca.Math.apply(this,arguments)}function Da(){Da.Sweep.apply(this,arguments)}function R(){R.Transform.apply(this,arguments);this.constructor===R&&this.Transform.apply(this,arguments)}function S(){S.Vec2.apply(this,arguments);this.constructor===
S&&this.Vec2.apply(this,arguments)}function T(){T.Vec3.apply(this,arguments);this.constructor===T&&this.Vec3.apply(this,arguments)}function U(){U.Body.apply(this,arguments);this.constructor===U&&this.Body.apply(this,arguments)}function V(){V.BodyDef.apply(this,arguments);this.constructor===V&&this.BodyDef.apply(this,arguments)}function Ea(){Ea.ContactFilter.apply(this,arguments)}function Fa(){Fa.ContactImpulse.apply(this,arguments)}function Ga(){Ga.ContactListener.apply(this,arguments)}function W(){W.ContactManager.apply(this,
arguments);this.constructor===W&&this.ContactManager.apply(this,arguments)}function X(){X.DebugDraw.apply(this,arguments);this.constructor===X&&this.DebugDraw.apply(this,arguments)}function Ha(){Ha.DestructionListener.apply(this,arguments)}function Ia(){Ia.FilterData.apply(this,arguments)}function Y(){Y.Fixture.apply(this,arguments);this.constructor===Y&&this.Fixture.apply(this,arguments)}function Z(){Z.FixtureDef.apply(this,arguments);this.constructor===Z&&this.FixtureDef.apply(this,arguments)}function aa(){aa.Island.apply(this,
arguments);this.constructor===aa&&this.Island.apply(this,arguments)}function Ja(){Ja.TimeStep.apply(this,arguments)}function ba(){ba.World.apply(this,arguments);this.constructor===ba&&this.World.apply(this,arguments)}function Ka(){Ka.CircleContact.apply(this,arguments)}function ca(){ca.Contact.apply(this,arguments);this.constructor===ca&&this.Contact.apply(this,arguments)}function da(){da.ContactConstraint.apply(this,arguments);this.constructor===da&&this.ContactConstraint.apply(this,arguments)}function La(){La.ContactConstraintPoint.apply(this,
arguments)}function Ma(){Ma.ContactEdge.apply(this,arguments)}function ea(){ea.ContactFactory.apply(this,arguments);this.constructor===ea&&this.ContactFactory.apply(this,arguments)}function Na(){Na.ContactRegister.apply(this,arguments)}function Oa(){Oa.ContactResult.apply(this,arguments)}function fa(){fa.ContactSolver.apply(this,arguments);this.constructor===fa&&this.ContactSolver.apply(this,arguments)}function Pa(){Pa.EdgeAndCircleContact.apply(this,arguments)}function ga(){ga.NullContact.apply(this,
arguments);this.constructor===ga&&this.NullContact.apply(this,arguments)}function Qa(){Qa.PolyAndCircleContact.apply(this,arguments)}function Ra(){Ra.PolyAndEdgeContact.apply(this,arguments)}function Sa(){Sa.PolygonContact.apply(this,arguments)}function ha(){ha.PositionSolverManifold.apply(this,arguments);this.constructor===ha&&this.PositionSolverManifold.apply(this,arguments)}function Ta(){Ta.BuoyancyController.apply(this,arguments)}function Ua(){Ua.ConstantAccelController.apply(this,arguments)}
function Va(){Va.ConstantForceController.apply(this,arguments)}function Wa(){Wa.Controller.apply(this,arguments)}function Xa(){Xa.ControllerEdge.apply(this,arguments)}function Ya(){Ya.GravityController.apply(this,arguments)}function Za(){Za.TensorDampingController.apply(this,arguments)}function ia(){ia.DistanceJoint.apply(this,arguments);this.constructor===ia&&this.DistanceJoint.apply(this,arguments)}function ja(){ja.DistanceJointDef.apply(this,arguments);this.constructor===ja&&this.DistanceJointDef.apply(this,
arguments)}function ka(){ka.FrictionJoint.apply(this,arguments);this.constructor===ka&&this.FrictionJoint.apply(this,arguments)}function la(){la.FrictionJointDef.apply(this,arguments);this.constructor===la&&this.FrictionJointDef.apply(this,arguments)}function ma(){ma.GearJoint.apply(this,arguments);this.constructor===ma&&this.GearJoint.apply(this,arguments)}function na(){na.GearJointDef.apply(this,arguments);this.constructor===na&&this.GearJointDef.apply(this,arguments)}function $a(){$a.Jacobian.apply(this,
arguments)}function oa(){oa.Joint.apply(this,arguments);this.constructor===oa&&this.Joint.apply(this,arguments)}function pa(){pa.JointDef.apply(this,arguments);this.constructor===pa&&this.JointDef.apply(this,arguments)}function ab(){ab.JointEdge.apply(this,arguments)}function qa(){qa.LineJoint.apply(this,arguments);this.constructor===qa&&this.LineJoint.apply(this,arguments)}function ra(){ra.LineJointDef.apply(this,arguments);this.constructor===ra&&this.LineJointDef.apply(this,arguments)}function sa(){sa.MouseJoint.apply(this,
arguments);this.constructor===sa&&this.MouseJoint.apply(this,arguments)}function ta(){ta.MouseJointDef.apply(this,arguments);this.constructor===ta&&this.MouseJointDef.apply(this,arguments)}function ua(){ua.PrismaticJoint.apply(this,arguments);this.constructor===ua&&this.PrismaticJoint.apply(this,arguments)}function va(){va.PrismaticJointDef.apply(this,arguments);this.constructor===va&&this.PrismaticJointDef.apply(this,arguments)}function wa(){wa.PulleyJoint.apply(this,arguments);this.constructor===
wa&&this.PulleyJoint.apply(this,arguments)}function xa(){xa.PulleyJointDef.apply(this,arguments);this.constructor===xa&&this.PulleyJointDef.apply(this,arguments)}function ya(){ya.RevoluteJoint.apply(this,arguments);this.constructor===ya&&this.RevoluteJoint.apply(this,arguments)}function za(){za.RevoluteJointDef.apply(this,arguments);this.constructor===za&&this.RevoluteJointDef.apply(this,arguments)}function Aa(){Aa.WeldJoint.apply(this,arguments);this.constructor===Aa&&this.WeldJoint.apply(this,arguments)}
function Ba(){Ba.WeldJointDef.apply(this,arguments);this.constructor===Ba&&this.WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.AABB=t;Box2D.Collision.Bound=n;Box2D.Collision.BoundValues=w;Box2D.Collision.Collision=g;Box2D.Collision.ContactID=e;Box2D.Collision.ContactPoint=h;Box2D.Collision.Distance=A;Box2D.Collision.DistanceInput=c;Box2D.Collision.DistanceOutput=v;Box2D.Collision.DistanceProxy=J;Box2D.Collision.DynamicTree=D;Box2D.Collision.DynamicTreeBroadPhase=
z;Box2D.Collision.DynamicTreeNode=B;Box2D.Collision.DynamicTreePair=x;Box2D.Collision.Manifold=M;Box2D.Collision.ManifoldPoint=N;Box2D.Collision.Point=d;Box2D.Collision.RayCastInput=E;Box2D.Collision.RayCastOutput=q;Box2D.Collision.Segment=G;Box2D.Collision.SeparationFunction=H;Box2D.Collision.Simplex=K;Box2D.Collision.SimplexCache=y;Box2D.Collision.SimplexVertex=O;Box2D.Collision.TimeOfImpact=F;Box2D.Collision.TOIInput=I;Box2D.Collision.WorldManifold=P;Box2D.Collision.ClipVertex=L;Box2D.Collision.Features=
a;Box2D.Collision.Shapes.CircleShape=f;Box2D.Collision.Shapes.EdgeChainDef=u;Box2D.Collision.Shapes.EdgeShape=m;Box2D.Collision.Shapes.MassData=k;Box2D.Collision.Shapes.PolygonShape=C;Box2D.Collision.Shapes.Shape=r;Box2D.Common.internal="Box2D.Common.internal";Box2D.Common.Color=b;Box2D.Common.Settings=l;Box2D.Common.Math.Mat22=p;Box2D.Common.Math.Mat33=Q;Box2D.Common.Math.Math=Ca;Box2D.Common.Math.Sweep=Da;Box2D.Common.Math.Transform=R;Box2D.Common.Math.Vec2=S;Box2D.Common.Math.Vec3=T;Box2D.Dynamics.Body=
U;Box2D.Dynamics.BodyDef=V;Box2D.Dynamics.ContactFilter=Ea;Box2D.Dynamics.ContactImpulse=Fa;Box2D.Dynamics.ContactListener=Ga;Box2D.Dynamics.ContactManager=W;Box2D.Dynamics.DebugDraw=X;Box2D.Dynamics.DestructionListener=Ha;Box2D.Dynamics.FilterData=Ia;Box2D.Dynamics.Fixture=Y;Box2D.Dynamics.FixtureDef=Z;Box2D.Dynamics.Island=aa;Box2D.Dynamics.TimeStep=Ja;Box2D.Dynamics.World=ba;Box2D.Dynamics.Contacts.CircleContact=Ka;Box2D.Dynamics.Contacts.Contact=ca;Box2D.Dynamics.Contacts.ContactConstraint=da;
Box2D.Dynamics.Contacts.ContactConstraintPoint=La;Box2D.Dynamics.Contacts.ContactEdge=Ma;Box2D.Dynamics.Contacts.ContactFactory=ea;Box2D.Dynamics.Contacts.ContactRegister=Na;Box2D.Dynamics.Contacts.ContactResult=Oa;Box2D.Dynamics.Contacts.ContactSolver=fa;Box2D.Dynamics.Contacts.EdgeAndCircleContact=Pa;Box2D.Dynamics.Contacts.NullContact=ga;Box2D.Dynamics.Contacts.PolyAndCircleContact=Qa;Box2D.Dynamics.Contacts.PolyAndEdgeContact=Ra;Box2D.Dynamics.Contacts.PolygonContact=Sa;Box2D.Dynamics.Contacts.PositionSolverManifold=
ha;Box2D.Dynamics.Controllers.BuoyancyController=Ta;Box2D.Dynamics.Controllers.ConstantAccelController=Ua;Box2D.Dynamics.Controllers.ConstantForceController=Va;Box2D.Dynamics.Controllers.Controller=Wa;Box2D.Dynamics.Controllers.ControllerEdge=Xa;Box2D.Dynamics.Controllers.GravityController=Ya;Box2D.Dynamics.Controllers.TensorDampingController=Za;Box2D.Dynamics.Joints.DistanceJoint=ia;Box2D.Dynamics.Joints.DistanceJointDef=ja;Box2D.Dynamics.Joints.FrictionJoint=ka;Box2D.Dynamics.Joints.FrictionJointDef=
la;Box2D.Dynamics.Joints.GearJoint=ma;Box2D.Dynamics.Joints.GearJointDef=na;Box2D.Dynamics.Joints.Jacobian=$a;Box2D.Dynamics.Joints.Joint=oa;Box2D.Dynamics.Joints.JointDef=pa;Box2D.Dynamics.Joints.JointEdge=ab;Box2D.Dynamics.Joints.LineJoint=qa;Box2D.Dynamics.Joints.LineJointDef=ra;Box2D.Dynamics.Joints.MouseJoint=sa;Box2D.Dynamics.Joints.MouseJointDef=ta;Box2D.Dynamics.Joints.PrismaticJoint=ua;Box2D.Dynamics.Joints.PrismaticJointDef=va;Box2D.Dynamics.Joints.PulleyJoint=wa;Box2D.Dynamics.Joints.PulleyJointDef=
xa;Box2D.Dynamics.Joints.RevoluteJoint=ya;Box2D.Dynamics.Joints.RevoluteJointDef=za;Box2D.Dynamics.Joints.WeldJoint=Aa;Box2D.Dynamics.Joints.WeldJointDef=Ba})();Box2D.postDefs=[];
(function(){var t=Box2D.Collision.Shapes.CircleShape,n=Box2D.Collision.Shapes.PolygonShape,w=Box2D.Collision.Shapes.Shape,g=Box2D.Common.Settings,e=Box2D.Common.Math.Math,h=Box2D.Common.Math.Sweep,A=Box2D.Common.Math.Transform,c=Box2D.Common.Math.Vec2,v=Box2D.Collision.AABB,J=Box2D.Collision.Bound,D=Box2D.Collision.BoundValues,z=Box2D.Collision.Collision,B=Box2D.Collision.ContactID,x=Box2D.Collision.ContactPoint,M=Box2D.Collision.Distance,N=Box2D.Collision.DistanceInput,d=Box2D.Collision.DistanceOutput,
E=Box2D.Collision.DistanceProxy,q=Box2D.Collision.DynamicTree,G=Box2D.Collision.DynamicTreeBroadPhase,H=Box2D.Collision.DynamicTreeNode,K=Box2D.Collision.DynamicTreePair,y=Box2D.Collision.Manifold,O=Box2D.Collision.ManifoldPoint,F=Box2D.Collision.Point,I=Box2D.Collision.RayCastInput,P=Box2D.Collision.RayCastOutput,L=Box2D.Collision.Segment,a=Box2D.Collision.SeparationFunction,f=Box2D.Collision.Simplex,u=Box2D.Collision.SimplexCache,m=Box2D.Collision.SimplexVertex,k=Box2D.Collision.TimeOfImpact,C=
Box2D.Collision.TOIInput,r=Box2D.Collision.WorldManifold,b=Box2D.Collision.ClipVertex,l=Box2D.Collision.Features,p=Box2D.Collision.IBroadPhase;v.AABB=function(){this.lowerBound=new c;this.upperBound=new c};v.prototype.IsValid=function(){var b=this.upperBound.y-this.lowerBound.y;return 0<=this.upperBound.x-this.lowerBound.x&&0<=b&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};v.prototype.GetCenter=function(){return new c((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/
2)};v.prototype.GetExtents=function(){return new c((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};v.prototype.Contains=function(b){var l;return l=(l=(l=(l=this.lowerBound.x<=b.lowerBound.x)&&this.lowerBound.y<=b.lowerBound.y)&&b.upperBound.x<=this.upperBound.x)&&b.upperBound.y<=this.upperBound.y};v.prototype.RayCast=function(b,l){var a=-Number.MAX_VALUE,p=Number.MAX_VALUE,f=l.p1.x,m=l.p1.y,u=l.p2.x-l.p1.x,d=l.p2.y-l.p1.y,k=e.abs(u),r=e.abs(d),c=b.normal;if(k<Number.MIN_VALUE){if(f<
this.lowerBound.x||this.upperBound.x<f)return!1}else if(k=1/u,u=(this.lowerBound.x-f)*k,f=(this.upperBound.x-f)*k,k=-1,u>f&&(k=u,u=f,f=k,k=1),u>a&&(c.x=k,c.y=0,a=u),p=e.min(p,f),a>p)return!1;if(r<Number.MIN_VALUE){if(m<this.lowerBound.y||this.upperBound.y<m)return!1}else if(k=1/d,u=(this.lowerBound.y-m)*k,f=(this.upperBound.y-m)*k,k=-1,u>f&&(k=u,u=f,f=k,k=1),u>a&&(c.y=k,c.x=0,a=u),p=e.min(p,f),a>p)return!1;b.fraction=a;return!0};v.prototype.TestOverlap=function(b){var l=b.lowerBound.y-this.upperBound.y,
a=this.lowerBound.y-b.upperBound.y;return 0<b.lowerBound.x-this.upperBound.x||0<l||0<this.lowerBound.x-b.upperBound.x||0<a?!1:!0};v.Combine=function(b,l){var a=new v;a.Combine(b,l);return a};v.prototype.Combine=function(b,l){this.lowerBound.x=e.min(b.lowerBound.x,l.lowerBound.x);this.lowerBound.y=e.min(b.lowerBound.y,l.lowerBound.y);this.upperBound.x=e.max(b.upperBound.x,l.upperBound.x);this.upperBound.y=e.max(b.upperBound.y,l.upperBound.y)};J.Bound=function(){};J.prototype.IsLower=function(){return 0==
(this.value&1)};J.prototype.IsUpper=function(){return 1==(this.value&1)};J.prototype.Swap=function(b){var l=this.value,a=this.proxy,p=this.stabbingCount;this.value=b.value;this.proxy=b.proxy;this.stabbingCount=b.stabbingCount;b.value=l;b.proxy=a;b.stabbingCount=p};D.BoundValues=function(){};D.prototype.BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};z.Collision=
function(){};z.ClipSegmentToLine=function(b,l,a,p){void 0===p&&(p=0);var f,m=0;f=l[0];var u=f.v;f=l[1];var d=f.v,k=a.x*u.x+a.y*u.y-p;f=a.x*d.x+a.y*d.y-p;0>=k&&b[m++].Set(l[0]);0>=f&&b[m++].Set(l[1]);0>k*f&&(a=k/(k-f),f=b[m],f=f.v,f.x=u.x+a*(d.x-u.x),f.y=u.y+a*(d.y-u.y),f=b[m],f.id=(0<k?l[0]:l[1]).id,++m);return m};z.EdgeSeparation=function(b,l,a,f,p){void 0===a&&(a=0);parseInt(b.vertexCount);var m=b.vertices,u=b.normals;b=parseInt(f.vertexCount);f=f.vertices;var d,k;d=l.R;k=u[a];var u=d.col1.x*k.x+
d.col2.x*k.y,r=d.col1.y*k.x+d.col2.y*k.y;d=p.R;var c=d.col1.x*u+d.col1.y*r;d=d.col2.x*u+d.col2.y*r;for(var C=0,e=Number.MAX_VALUE,q=0;q<b;++q)k=f[q],k=k.x*c+k.y*d,k<e&&(e=k,C=q);k=m[a];d=l.R;a=l.position.x+(d.col1.x*k.x+d.col2.x*k.y);l=l.position.y+(d.col1.y*k.x+d.col2.y*k.y);k=f[C];d=p.R;return(p.position.x+(d.col1.x*k.x+d.col2.x*k.y)-a)*u+(p.position.y+(d.col1.y*k.x+d.col2.y*k.y)-l)*r};z.FindMaxSeparation=function(b,l,a,f,p){var m=parseInt(l.vertexCount),u=l.normals,d,k;k=p.R;d=f.centroid;var r=
p.position.x+(k.col1.x*d.x+k.col2.x*d.y),c=p.position.y+(k.col1.y*d.x+k.col2.y*d.y);k=a.R;d=l.centroid;r-=a.position.x+(k.col1.x*d.x+k.col2.x*d.y);c-=a.position.y+(k.col1.y*d.x+k.col2.y*d.y);k=r*a.R.col1.x+c*a.R.col1.y;for(var c=r*a.R.col2.x+c*a.R.col2.y,r=0,C=-Number.MAX_VALUE,q=0;q<m;++q)d=u[q],d=d.x*k+d.y*c,d>C&&(C=d,r=q);u=z.EdgeSeparation(l,a,r,f,p);C=parseInt(0<=r-1?r-1:m-1);k=z.EdgeSeparation(l,a,C,f,p);q=parseInt(r+1<m?r+1:0);c=z.EdgeSeparation(l,a,q,f,p);if(k>u&&k>c)d=-1;else if(c>u)d=1,
C=q,k=c;else return b[0]=r,u;for(;;)if(r=-1==d?0<=C-1?C-1:m-1:C+1<m?C+1:0,u=z.EdgeSeparation(l,a,r,f,p),u>k)C=r,k=u;else break;b[0]=C;return k};z.FindIncidentEdge=function(b,l,a,f,p,m){void 0===f&&(f=0);parseInt(l.vertexCount);var d=l.normals,u=parseInt(p.vertexCount);l=p.vertices;p=p.normals;var k;k=a.R;a=d[f];var d=k.col1.x*a.x+k.col2.x*a.y,r=k.col1.y*a.x+k.col2.y*a.y;k=m.R;a=k.col1.x*d+k.col1.y*r;r=k.col2.x*d+k.col2.y*r;d=a;k=0;for(var c=Number.MAX_VALUE,C=0;C<u;++C)a=p[C],a=d*a.x+r*a.y,a<c&&(c=
a,k=C);p=parseInt(k);d=parseInt(p+1<u?p+1:0);u=b[0];a=l[p];k=m.R;u.v.x=m.position.x+(k.col1.x*a.x+k.col2.x*a.y);u.v.y=m.position.y+(k.col1.y*a.x+k.col2.y*a.y);u.id.features.referenceEdge=f;u.id.features.incidentEdge=p;u.id.features.incidentVertex=0;u=b[1];a=l[d];k=m.R;u.v.x=m.position.x+(k.col1.x*a.x+k.col2.x*a.y);u.v.y=m.position.y+(k.col1.y*a.x+k.col2.y*a.y);u.id.features.referenceEdge=f;u.id.features.incidentEdge=d;u.id.features.incidentVertex=1};z.MakeClipPointVector=function(){var Q=new Vector(2);
Q[0]=new b;Q[1]=new b;return Q};z.CollidePolygons=function(b,l,a,p,f){var m;b.pointCount=0;var k=l.radius+p.radius,d;z.s_edgeAO[0]=0;var u=z.FindMaxSeparation(z.s_edgeAO,l,a,p,f);d=z.s_edgeAO[0];if(!(u>k)){z.s_edgeBO[0]=0;var r=z.FindMaxSeparation(z.s_edgeBO,p,f,l,a);m=z.s_edgeBO[0];if(!(r>k)){r>.98*u+.001?(u=p,p=l,l=f,f=m,b.type=y.e_faceB,d=1):(u=l,l=a,a=f,f=d,b.type=y.e_faceA,d=0);m=z.s_incidentEdge;z.FindIncidentEdge(m,u,l,f,p,a);r=parseInt(u.vertexCount);u=u.vertices;p=u[f];var c;c=f+1<r?u[parseInt(f+
1)]:u[0];u=z.s_localTangent;u.Set(c.x-p.x,c.y-p.y);u.Normalize();r=z.s_localNormal;r.x=u.y;r.y=-u.x;var C=z.s_planePoint;C.Set(.5*(p.x+c.x),.5*(p.y+c.y));var q=z.s_tangent;f=l.R;q.x=f.col1.x*u.x+f.col2.x*u.y;q.y=f.col1.y*u.x+f.col2.y*u.y;var e=z.s_tangent2;e.x=-q.x;e.y=-q.y;u=z.s_normal;u.x=q.y;u.y=-q.x;var E=z.s_v11,v=z.s_v12;E.x=l.position.x+(f.col1.x*p.x+f.col2.x*p.y);E.y=l.position.y+(f.col1.y*p.x+f.col2.y*p.y);v.x=l.position.x+(f.col1.x*c.x+f.col2.x*c.y);v.y=l.position.y+(f.col1.y*c.x+f.col2.y*
c.y);l=u.x*E.x+u.y*E.y;f=q.x*v.x+q.y*v.y+k;c=z.s_clipPoints1;p=z.s_clipPoints2;m=z.ClipSegmentToLine(c,m,e,-q.x*E.x-q.y*E.y+k);if(!(2>m||(m=z.ClipSegmentToLine(p,c,q,f),2>m))){b.localPlaneNormal.SetV(r);b.localPoint.SetV(C);for(C=r=0;C<g._maxManifoldPoints;++C)m=p[C],u.x*m.v.x+u.y*m.v.y-l<=k&&(q=b.points[r],f=a.R,e=m.v.x-a.position.x,E=m.v.y-a.position.y,q.localPoint.x=e*f.col1.x+E*f.col1.y,q.localPoint.y=e*f.col2.x+E*f.col2.y,q.id.Set(m.id),q.id.features.flip=d,++r);b.pointCount=r}}}};z.CollideCircles=
function(b,l,a,f,p){b.pointCount=0;var m,u;m=a.R;u=l.p;var k=a.position.x+(m.col1.x*u.x+m.col2.x*u.y);a=a.position.y+(m.col1.y*u.x+m.col2.y*u.y);m=p.R;u=f.p;k=p.position.x+(m.col1.x*u.x+m.col2.x*u.y)-k;p=p.position.y+(m.col1.y*u.x+m.col2.y*u.y)-a;m=l.radius+f.radius;k*k+p*p>m*m||(b.type=y.e_circles,b.localPoint.SetV(l.p),b.localPlaneNormal.SetZero(),b.pointCount=1,b.points[0].localPoint.SetV(f.p),b.points[0].id.key=0)};z.CollidePolygonAndCircle=function(b,l,a,f,p){b.pointCount=0;var m,u,k,d;d=p.R;
k=f.p;var r=p.position.y+(d.col1.y*k.x+d.col2.y*k.y);m=p.position.x+(d.col1.x*k.x+d.col2.x*k.y)-a.position.x;u=r-a.position.y;d=a.R;a=m*d.col1.x+u*d.col1.y;d=m*d.col2.x+u*d.col2.y;var c=0;p=-Number.MAX_VALUE;var r=l.radius+f.radius,C=parseInt(l.vertexCount),q=l.vertices;l=l.normals;for(var e=0;e<C;++e){k=q[e];m=a-k.x;u=d-k.y;k=l[e];k=k.x*m+k.y*u;if(k>r)return;k>p&&(p=k,c=e)}k=parseInt(c);u=parseInt(k+1<C?k+1:0);m=q[k];q=q[u];p<Number.MIN_VALUE?(b.pointCount=1,b.type=y.e_faceA,b.localPlaneNormal.SetV(l[c]),
b.localPoint.x=.5*(m.x+q.x),b.localPoint.y=.5*(m.y+q.y),b.points[0].localPoint.SetV(f.p),b.points[0].id.key=0):(p=(a-q.x)*(m.x-q.x)+(d-q.y)*(m.y-q.y),0>=(a-m.x)*(q.x-m.x)+(d-m.y)*(q.y-m.y)?(a-m.x)*(a-m.x)+(d-m.y)*(d-m.y)>r*r||(b.pointCount=1,b.type=y.e_faceA,b.localPlaneNormal.x=a-m.x,b.localPlaneNormal.y=d-m.y,b.localPlaneNormal.Normalize(),b.localPoint.SetV(m),b.points[0].localPoint.SetV(f.p),b.points[0].id.key=0):0>=p?(a-q.x)*(a-q.x)+(d-q.y)*(d-q.y)>r*r||(b.pointCount=1,b.type=y.e_faceA,b.localPlaneNormal.x=
a-q.x,b.localPlaneNormal.y=d-q.y,b.localPlaneNormal.Normalize(),b.localPoint.SetV(q),b.points[0].localPoint.SetV(f.p),b.points[0].id.key=0):(c=.5*(m.x+q.x),q=.5*(m.y+q.y),p=(a-c)*l[k].x+(d-q)*l[k].y,p>r||(b.pointCount=1,b.type=y.e_faceA,b.localPlaneNormal.x=l[k].x,b.localPlaneNormal.y=l[k].y,b.localPlaneNormal.Normalize(),b.localPoint.Set(c,q),b.points[0].localPoint.SetV(f.p),b.points[0].id.key=0)))};z.TestOverlap=function(b,l){var a=l.lowerBound,f=b.upperBound,p=a.x-f.x,m=a.y-f.y,a=b.lowerBound,
f=l.upperBound,u=a.y-f.y;return 0<p||0<m||0<a.x-f.x||0<u?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.Collision.s_incidentEdge=z.MakeClipPointVector();Box2D.Collision.Collision.s_clipPoints1=z.MakeClipPointVector();Box2D.Collision.Collision.s_clipPoints2=z.MakeClipPointVector();Box2D.Collision.Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.Collision.s_localTangent=new c;Box2D.Collision.Collision.s_localNormal=new c;
Box2D.Collision.Collision.s_planePoint=new c;Box2D.Collision.Collision.s_normal=new c;Box2D.Collision.Collision.s_tangent=new c;Box2D.Collision.Collision.s_tangent2=new c;Box2D.Collision.Collision.s_v11=new c;Box2D.Collision.Collision.s_v12=new c;Box2D.Collision.Collision.CollidePolyTempVec=new c;Box2D.Collision.Collision._nullFeature=255});B.ContactID=function(){this.features=new l};B.prototype.ContactID=function(){this.features._id=this};B.prototype.Set=function(b){this.key=b._key};B.prototype.Copy=
function(){var b=new B;b.key=this.key;return b};Object.defineProperty(B.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(B.prototype,"key",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._key=b;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});x.ContactPoint=function(){this.position=
new c;this.velocity=new c;this.normal=new c;this.id=new B};M.Distance=function(){};M.Distance=function(b,l,a){++M._gjkCalls;var f=a.proxyA,p=a.proxyB,m=a.transformA,u=a.transformB,k=M.s_simplex;k.ReadCache(l,f,m,p,u);var d=k.vertices,r=M.s_saveA,C=M.s_saveB,q;k.GetClosestPoint().LengthSquared();for(var E,v,h=0;20>h;){q=k.count;for(E=0;E<q;E++)r[E]=d[E].indexA,C[E]=d[E].indexB;switch(k.count){case 1:break;case 2:k.Solve2();break;case 3:k.Solve3();break;default:g.Assert(!1)}if(3==k.count)break;v=k.GetClosestPoint();
v.LengthSquared();E=k.GetSearchDirection();if(E.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;v=d[k.count];v.indexA=f.GetSupport(e.MulTMV(m.R,E.GetNegative()));v.wA=e.MulX(m,f.GetVertex(v.indexA));v.indexB=p.GetSupport(e.MulTMV(u.R,E));v.wB=e.MulX(u,p.GetVertex(v.indexB));v.w=e.SubtractVV(v.wB,v.wA);++h;++M._gjkIters;var G=!1;for(E=0;E<q;E++)if(v.indexA==r[E]&&v.indexB==C[E]){G=!0;break}if(G)break;++k.count}M._gjkMaxIters=e.Max(M._gjkMaxIters,h);k.GetWitnessPoints(b.pointA,b.pointB);b.distance=
e.SubtractVV(b.pointA,b.pointB).Length();b.iterations=h;k.WriteCache(l);a.useRadii&&(l=f.radius,p=p.radius,b.distance>l+p&&b.distance>Number.MIN_VALUE?(b.distance-=l+p,a=e.SubtractVV(b.pointB,b.pointA),a.Normalize(),b.pointA.x+=l*a.x,b.pointA.y+=l*a.y,b.pointB.x-=p*a.x,b.pointB.y-=p*a.y):(v=new c,v.x=.5*(b.pointA.x+b.pointB.x),v.y=.5*(b.pointA.y+b.pointB.y),b.pointA.x=b.pointB.x=v.x,b.pointA.y=b.pointB.y=v.y,b.distance=0))};Box2D.postDefs.push(function(){Box2D.Collision.Distance.s_simplex=new f;Box2D.Collision.Distance.s_saveA=
new Vector_a2j_Number(3);Box2D.Collision.Distance.s_saveB=new Vector_a2j_Number(3)});N.DistanceInput=function(){};d.DistanceOutput=function(){this.pointA=new c;this.pointB=new c};E.DistanceProxy=function(){};E.prototype.Set=function(b){switch(b.GetType()){case w.e_circleShape:b=b instanceof t?b:null;this.vertices=new Vector(1,!0);this.vertices[0]=b.p;this.count=1;this.radius=b.radius;break;case w.e_polygonShape:b=b instanceof n?b:null;this.vertices=b.vertices;this.count=b.vertexCount;this.radius=
b.radius;break;default:g.Assert(!1)}};E.prototype.GetSupport=function(b){for(var a=0,l=this.vertices[0].x*b.x+this.vertices[0].y*b.y,f=1;f<this.count;++f){var p=this.vertices[f].x*b.x+this.vertices[f].y*b.y;p>l&&(a=f,l=p)}return a};E.prototype.GetSupportVertex=function(b){for(var a=0,l=this.vertices[0].x*b.x+this.vertices[0].y*b.y,f=1;f<this.count;++f){var p=this.vertices[f].x*b.x+this.vertices[f].y*b.y;p>l&&(a=f,l=p)}return this.vertices[a]};E.prototype.GetVertexCount=function(){return this.count};
E.prototype.GetVertex=function(b){void 0===b&&(b=0);g.Assert(0<=b&&b<this.count);return this.vertices[b]};q.DynamicTree=function(){};q.prototype.DynamicTree=function(){this.freeList=this.root=null;this.insertionCount=this.path=0};q.prototype.CreateProxy=function(b,a){var l=this.AllocateNode(),f=g._aabbExtension,p=g._aabbExtension;l.aabb.lowerBound.x=b.lowerBound.x-f;l.aabb.lowerBound.y=b.lowerBound.y-p;l.aabb.upperBound.x=b.upperBound.x+f;l.aabb.upperBound.y=b.upperBound.y+p;l.userData=a;this.InsertLeaf(l);
return l};q.prototype.DestroyProxy=function(b){this.RemoveLeaf(b);this.FreeNode(b)};q.prototype.MoveProxy=function(b,l,a){g.Assert(b.IsLeaf());if(b.aabb.Contains(l))return!1;this.RemoveLeaf(b);var f=g._aabbExtension+g._aabbMultiplier*(0<a.x?a.x:-a.x);a=g._aabbExtension+g._aabbMultiplier*(0<a.y?a.y:-a.y);b.aabb.lowerBound.x=l.lowerBound.x-f;b.aabb.lowerBound.y=l.lowerBound.y-a;b.aabb.upperBound.x=l.upperBound.x+f;b.aabb.upperBound.y=l.upperBound.y+a;this.InsertLeaf(b);return!0};q.prototype.Rebalance=
function(b){void 0===b&&(b=0);if(null!=this.root)for(var a=0;a<b;a++){for(var l=this.root,f=0;0==l.IsLeaf();)l=this.path>>f&1?l.child2:l.child1,f=f+1&31;++this.path;this.RemoveLeaf(l);this.InsertLeaf(l)}};q.prototype.GetFatAABB=function(b){return b.aabb};q.prototype.GetUserData=function(b){return b.userData};q.prototype.Query=function(b,l){if(null!=this.root){var a=new Vector,f=0;for(a[f++]=this.root;0<f;){var p=a[--f];if(p.aabb.TestOverlap(l))if(p.IsLeaf()){if(!b(p))break}else a[f++]=p.child1,a[f++]=
p.child2}}};q.prototype.RayCast=function(b,a){if(null!=this.root){var l=a.p1,f=a.p2,p=e.SubtractVV(l,f);p.Normalize();var p=e.CrossFV(1,p),m=e.AbsV(p),k=a.maxFraction,u=new v,d;d=l.x+k*(f.x-l.x);k=l.y+k*(f.y-l.y);u.lowerBound.x=e.min(l.x,d);u.lowerBound.y=e.min(l.y,k);u.upperBound.x=e.max(l.x,d);u.upperBound.y=e.max(l.y,k);var r=new Vector,c=0;for(r[c++]=this.root;0<c;)if(d=r[--c],0!=d.aabb.TestOverlap(u)){var k=d.aabb.GetCenter(),C=d.aabb.GetExtents();if(!(0<e.abs(p.x*(l.x-k.x)+p.y*(l.y-k.y))-m.x*
C.x-m.y*C.y))if(d.IsLeaf()){k=new I;k.p1=a.p1;k.p2=a.p2;k.maxFraction=a.maxFraction;k=b(k,d);if(0==k)break;0<k&&(d=l.x+k*(f.x-l.x),k=l.y+k*(f.y-l.y),u.lowerBound.x=e.min(l.x,d),u.lowerBound.y=e.min(l.y,k),u.upperBound.x=e.max(l.x,d),u.upperBound.y=e.max(l.y,k))}else r[c++]=d.child1,r[c++]=d.child2}}};q.prototype.AllocateNode=function(){if(this.freeList){var b=this.freeList;this.freeList=b.parent;b.parent=null;b.child1=null;b.child2=null;return b}return new H};q.prototype.FreeNode=function(b){b.parent=
this.freeList;this.freeList=b};q.prototype.InsertLeaf=function(b){++this.insertionCount;if(null==this.root)this.root=b,this.root.parent=null;else{var l=b.aabb.GetCenter(),a=this.root;if(0==a.IsLeaf()){do var f=a.child1,a=a.child2,p=e.abs((f.aabb.lowerBound.x+f.aabb.upperBound.x)/2-l.x)+e.abs((f.aabb.lowerBound.y+f.aabb.upperBound.y)/2-l.y),m=e.abs((a.aabb.lowerBound.x+a.aabb.upperBound.x)/2-l.x)+e.abs((a.aabb.lowerBound.y+a.aabb.upperBound.y)/2-l.y),a=p<m?f:a;while(0==a.IsLeaf())}l=a.parent;f=this.AllocateNode();
f.parent=l;f.userData=null;f.aabb.Combine(b.aabb,a.aabb);if(l){a.parent.child1==a?l.child1=f:l.child2=f;f.child1=a;f.child2=b;a.parent=f;b.parent=f;do{if(l.aabb.Contains(f.aabb))break;l.aabb.Combine(l.child1.aabb,l.child2.aabb);f=l;l=l.parent}while(l)}else f.child1=a,f.child2=b,a.parent=f,this.root=b.parent=f}};q.prototype.RemoveLeaf=function(b){if(b==this.root)this.root=null;else{var l=b.parent,a=l.parent;b=l.child1==b?l.child2:l.child1;if(a)for(a.child1==l?a.child1=b:a.child2=b,b.parent=a,this.FreeNode(l);a;){l=
a.aabb;a.aabb=v.Combine(a.child1.aabb,a.child2.aabb);if(l.Contains(a.aabb))break;a=a.parent}else this.root=b,b.parent=null,this.FreeNode(l)}};G.DynamicTreeBroadPhase=function(){this.tree=new q;this.moveBuffer=new Vector;this.pairBuffer=new Vector;this.pairCount=0};G.prototype.CreateProxy=function(b,l){var a=this.tree.CreateProxy(b,l);++this.proxyCount;this.BufferMove(a);return a};G.prototype.DestroyProxy=function(b){this.UnBufferMove(b);--this.proxyCount;this.tree.DestroyProxy(b)};G.prototype.MoveProxy=
function(b,l,a){this.tree.MoveProxy(b,l,a)&&this.BufferMove(b)};G.prototype.TestOverlap=function(b,l){var a=this.tree.GetFatAABB(b),f=this.tree.GetFatAABB(l);return a.TestOverlap(f)};G.prototype.GetUserData=function(b){return this.tree.GetUserData(b)};G.prototype.GetFatAABB=function(b){return this.tree.GetFatAABB(b)};G.prototype.GetProxyCount=function(){return this.proxyCount};G.prototype.UpdatePairs=function(b){for(var l=this,a=l.pairCount=0,f,a=0;a<l.moveBuffer.length;++a){f=l.moveBuffer[a];var p=
l.tree.GetFatAABB(f);l.tree.Query(function(b){if(b==f)return!0;l.pairCount==l.pairBuffer.length&&(l.pairBuffer[l.pairCount]=new K);var a=l.pairBuffer[l.pairCount];a.proxyA=b<f?b:f;a.proxyB=b>=f?b:f;++l.pairCount;return!0},p)}for(a=l.moveBuffer.length=0;a<l.pairCount;){var p=l.pairBuffer[a],m=l.tree.GetUserData(p.proxyA),k=l.tree.GetUserData(p.proxyB);b(m,k);for(++a;a<l.pairCount;){m=l.pairBuffer[a];if(m.proxyA!=p.proxyA||m.proxyB!=p.proxyB)break;++a}}};G.prototype.Query=function(b,l){this.tree.Query(b,
l)};G.prototype.RayCast=function(b,l){this.tree.RayCast(b,l)};G.prototype.Validate=function(){};G.prototype.Rebalance=function(b){void 0===b&&(b=0);this.tree.Rebalance(b)};G.prototype.BufferMove=function(b){this.moveBuffer[this.moveBuffer.length]=b};G.prototype.UnBufferMove=function(b){b=parseInt(this.moveBuffer.indexOf(b));this.moveBuffer.splice(b,1)};G.prototype.ComparePairs=function(b,l){return 0};G.__implements={};G.__implements[p]=!0;H.DynamicTreeNode=function(){this.aabb=new v};H.prototype.IsLeaf=
function(){return null==this.child1};K.DynamicTreePair=function(){};y.Manifold=function(){this.pointCount=0};y.prototype.Manifold=function(){this.points=new Vector(g._maxManifoldPoints);for(var b=0;b<g._maxManifoldPoints;b++)this.points[b]=new O;this.localPlaneNormal=new c;this.localPoint=new c};y.prototype.Reset=function(){for(var b=0;b<g._maxManifoldPoints;b++)(this.points[b]instanceof O?this.points[b]:null).Reset();this.localPlaneNormal.SetZero();this.localPoint.SetZero();this.pointCount=this.type=
0};y.prototype.Set=function(b){this.pointCount=b.pointCount;for(var l=0;l<g._maxManifoldPoints;l++)(this.points[l]instanceof O?this.points[l]:null).Set(b.points[l]);this.localPlaneNormal.SetV(b.localPlaneNormal);this.localPoint.SetV(b.localPoint);this.type=b.type};y.prototype.Copy=function(){var b=new y;b.Set(this);return b};Box2D.postDefs.push(function(){Box2D.Collision.Manifold.e_circles=1;Box2D.Collision.Manifold.e_faceA=2;Box2D.Collision.Manifold.e_faceB=4});O.ManifoldPoint=function(){this.localPoint=
new c;this.id=new B};O.prototype.ManifoldPoint=function(){this.Reset()};O.prototype.Reset=function(){this.localPoint.SetZero();this.tangentImpulse=this.normalImpulse=0;this.id.key=0};O.prototype.Set=function(b){this.localPoint.SetV(b.localPoint);this.normalImpulse=b.normalImpulse;this.tangentImpulse=b.tangentImpulse;this.id.Set(b.id)};F.Point=function(){this.p=new c};F.prototype.Support=function(b,l,a){return this.p};F.prototype.GetFirstVertex=function(b){return this.p};I.RayCastInput=function(){this.p1=
new c;this.p2=new c};I.prototype.RayCastInput=function(b,l,a){void 0===b&&(b=null);void 0===l&&(l=null);void 0===a&&(a=1);b&&this.p1.SetV(b);l&&this.p2.SetV(l);this.maxFraction=a};P.RayCastOutput=function(){this.normal=new c};L.Segment=function(){this.p1=new c;this.p2=new c};L.prototype.TestSegment=function(b,l,a,f){void 0===f&&(f=0);var p=a.p1,m=a.p2.x-p.x,k=a.p2.y-p.y;a=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),d=100*Number.MIN_VALUE,r=-(m*a+k*u);if(r>d){var c=p.x-this.p1.x,C=p.y-this.p1.y,
p=c*a+C*u;if(0<=p&&p<=f*r&&(f=-m*C+k*c,-d*r<=f&&f<=r*(1+d)))return p/=r,f=e.sqrt(a*a+u*u),b[0]=p,l.Set(a/f,u/f),!0}return!1};L.prototype.Extend=function(b){this.ExtendForward(b);this.ExtendBackward(b)};L.prototype.ExtendForward=function(b){var l=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y;b=e.min(0<l?(b.upperBound.x-this.p1.x)/l:0>l?(b.lowerBound.x-this.p1.x)/l:Number.POSITIVE_INFINITY,0<a?(b.upperBound.y-this.p1.y)/a:0>a?(b.lowerBound.y-this.p1.y)/a:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+l*
b;this.p2.y=this.p1.y+a*b};L.prototype.ExtendBackward=function(b){var l=-this.p2.x+this.p1.x,a=-this.p2.y+this.p1.y;b=e.min(0<l?(b.upperBound.x-this.p2.x)/l:0>l?(b.lowerBound.x-this.p2.x)/l:Number.POSITIVE_INFINITY,0<a?(b.upperBound.y-this.p2.y)/a:0>a?(b.lowerBound.y-this.p2.y)/a:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+l*b;this.p1.y=this.p2.y+a*b};a.SeparationFunction=function(){this.localPoint=new c;this.axis=new c};a.prototype.Initialize=function(b,l,f,p,m){this.proxyA=l;this.proxyB=p;l=parseInt(b.count);
g.Assert(0<l&&3>l);var k,u,d,r;if(1==l)this.type=a.e_points,k=this.proxyA.GetVertex(b.indexA[0]),u=this.proxyB.GetVertex(b.indexB[0]),r=k,d=f.R,k=f.position.x+(d.col1.x*r.x+d.col2.x*r.y),f=f.position.y+(d.col1.y*r.x+d.col2.y*r.y),r=u,d=m.R,u=m.position.x+(d.col1.x*r.x+d.col2.x*r.y),m=m.position.y+(d.col1.y*r.x+d.col2.y*r.y),this.axis.x=u-k,this.axis.y=m-f,this.axis.Normalize();else if(b.indexB[0]==b.indexB[1])this.type=a.e_faceA,l=this.proxyA.GetVertex(b.indexA[0]),p=this.proxyA.GetVertex(b.indexA[1]),
u=this.proxyB.GetVertex(b.indexB[0]),this.localPoint.x=.5*(l.x+p.x),this.localPoint.y=.5*(l.y+p.y),this.axis=e.CrossVF(e.SubtractVV(p,l),1),this.axis.Normalize(),r=this.axis,d=f.R,l=d.col1.x*r.x+d.col2.x*r.y,p=d.col1.y*r.x+d.col2.y*r.y,r=this.localPoint,d=f.R,k=f.position.x+(d.col1.x*r.x+d.col2.x*r.y),f=f.position.y+(d.col1.y*r.x+d.col2.y*r.y),r=u,d=m.R,u=m.position.x+(d.col1.x*r.x+d.col2.x*r.y),m=m.position.y+(d.col1.y*r.x+d.col2.y*r.y),0>(u-k)*l+(m-f)*p&&this.axis.NegativeSelf();else if(b.indexA[0]==
b.indexA[0])this.type=a.e_faceB,d=this.proxyB.GetVertex(b.indexB[0]),r=this.proxyB.GetVertex(b.indexB[1]),k=this.proxyA.GetVertex(b.indexA[0]),this.localPoint.x=.5*(d.x+r.x),this.localPoint.y=.5*(d.y+r.y),this.axis=e.CrossVF(e.SubtractVV(r,d),1),this.axis.Normalize(),r=this.axis,d=m.R,l=d.col1.x*r.x+d.col2.x*r.y,p=d.col1.y*r.x+d.col2.y*r.y,r=this.localPoint,d=m.R,u=m.position.x+(d.col1.x*r.x+d.col2.x*r.y),m=m.position.y+(d.col1.y*r.x+d.col2.y*r.y),r=k,d=f.R,k=f.position.x+(d.col1.x*r.x+d.col2.x*r.y),
f=f.position.y+(d.col1.y*r.x+d.col2.y*r.y),0>(k-u)*l+(f-m)*p&&this.axis.NegativeSelf();else{l=this.proxyA.GetVertex(b.indexA[0]);p=this.proxyA.GetVertex(b.indexA[1]);d=this.proxyB.GetVertex(b.indexB[0]);r=this.proxyB.GetVertex(b.indexB[1]);e.MulX(f,k);k=e.MulMV(f.R,e.SubtractVV(p,l));e.MulX(m,u);b=e.MulMV(m.R,e.SubtractVV(r,d));m=k.x*k.x+k.y*k.y;u=b.x*b.x+b.y*b.y;var C=e.SubtractVV(b,k);f=k.x*C.x+k.y*C.y;C=b.x*C.x+b.y*C.y;k=k.x*b.x+k.y*b.y;var q=m*u-k*k;b=0;0!=q&&(b=e.Clamp((k*C-f*u)/q,0,1));0>(k*
b+C)/u&&(b=e.Clamp((k-f)/m,0,1));k=new c;k.x=l.x+b*(p.x-l.x);k.y=l.y+b*(p.y-l.y);u=new c;u.x=d.x+b*(r.x-d.x);u.y=d.y+b*(r.y-d.y);0==b||1==b?(this.type=a.e_faceB,this.axis=e.CrossVF(e.SubtractVV(r,d),1),this.axis.Normalize(),this.localPoint=u):(this.type=a.e_faceA,this.axis=e.CrossVF(e.SubtractVV(p,l),1),this.localPoint=k);0>b&&this.axis.NegativeSelf()}};a.prototype.Evaluate=function(b,l){var f,p,m;switch(this.type){case a.e_points:return f=e.MulTMV(b.R,this.axis),p=e.MulTMV(l.R,this.axis.GetNegative()),
f=this.proxyA.GetSupportVertex(f),p=this.proxyB.GetSupportVertex(p),f=e.MulX(b,f),p=e.MulX(l,p),m=(p.x-f.x)*this.axis.x+(p.y-f.y)*this.axis.y;case a.e_faceA:return m=e.MulMV(b.R,this.axis),f=e.MulX(b,this.localPoint),p=e.MulTMV(l.R,m.GetNegative()),p=this.proxyB.GetSupportVertex(p),p=e.MulX(l,p),m=(p.x-f.x)*m.x+(p.y-f.y)*m.y;case a.e_faceB:return m=e.MulMV(l.R,this.axis),p=e.MulX(l,this.localPoint),f=e.MulTMV(b.R,m.GetNegative()),f=this.proxyA.GetSupportVertex(f),f=e.MulX(b,f),m=(f.x-p.x)*m.x+(f.y-
p.y)*m.y;default:return g.Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.SeparationFunction.e_points=1;Box2D.Collision.SeparationFunction.e_faceA=2;Box2D.Collision.SeparationFunction.e_faceB=4});f.Simplex=function(){this.v1=new m;this.v2=new m;this.v3=new m;this.vertices=new Vector(3)};f.prototype.Simplex=function(){this.vertices[0]=this.v1;this.vertices[1]=this.v2;this.vertices[2]=this.v3};f.prototype.ReadCache=function(b,l,a,f,p){g.Assert(0<=b.count&&3>=b.count);var m,k;this.count=
b.count;for(var d=this.vertices,u=0;u<this.count;u++){var r=d[u];r.indexA=b.indexA[u];r.indexB=b.indexB[u];m=l.GetVertex(r.indexA);k=f.GetVertex(r.indexB);r.wA=e.MulX(a,m);r.wB=e.MulX(p,k);r.w=e.SubtractVV(r.wB,r.wA);r.a=0}1<this.count&&(b=b.metric,m=this.GetMetric(),m<.5*b||2*b<m||m<Number.MIN_VALUE)&&(this.count=0);0==this.count&&(r=d[0],r.indexA=0,r.indexB=0,m=l.GetVertex(0),k=f.GetVertex(0),r.wA=e.MulX(a,m),r.wB=e.MulX(p,k),r.w=e.SubtractVV(r.wB,r.wA),this.count=1)};f.prototype.WriteCache=function(b){b.metric=
this.GetMetric();b.count=Box2D.parseUInt(this.count);for(var l=this.vertices,a=0;a<this.count;a++)b.indexA[a]=Box2D.parseUInt(l[a].indexA),b.indexB[a]=Box2D.parseUInt(l[a].indexB)};f.prototype.GetSearchDirection=function(){switch(this.count){case 1:return this.v1.w.GetNegative();case 2:var b=e.SubtractVV(this.v2.w,this.v1.w);return 0<e.CrossVV(b,this.v1.w.GetNegative())?e.CrossFV(1,b):e.CrossVF(b,1);default:return g.Assert(!1),new c}};f.prototype.GetClosestPoint=function(){switch(this.count){case 0:return g.Assert(!1),
new c;case 1:return this.v1.w;case 2:return new c(this.v1.a*this.v1.w.x+this.v2.a*this.v2.w.x,this.v1.a*this.v1.w.y+this.v2.a*this.v2.w.y);default:return g.Assert(!1),new c}};f.prototype.GetWitnessPoints=function(b,l){switch(this.count){case 0:g.Assert(!1);break;case 1:b.SetV(this.v1.wA);l.SetV(this.v1.wB);break;case 2:b.x=this.v1.a*this.v1.wA.x+this.v2.a*this.v2.wA.x;b.y=this.v1.a*this.v1.wA.y+this.v2.a*this.v2.wA.y;l.x=this.v1.a*this.v1.wB.x+this.v2.a*this.v2.wB.x;l.y=this.v1.a*this.v1.wB.y+this.v2.a*
this.v2.wB.y;break;case 3:l.x=b.x=this.v1.a*this.v1.wA.x+this.v2.a*this.v2.wA.x+this.v3.a*this.v3.wA.x;l.y=b.y=this.v1.a*this.v1.wA.y+this.v2.a*this.v2.wA.y+this.v3.a*this.v3.wA.y;break;default:g.Assert(!1)}};f.prototype.GetMetric=function(){switch(this.count){case 0:return g.Assert(!1),0;case 1:return 0;case 2:return e.SubtractVV(this.v1.w,this.v2.w).Length();case 3:return e.CrossVV(e.SubtractVV(this.v2.w,this.v1.w),e.SubtractVV(this.v3.w,this.v1.w));default:return g.Assert(!1),0}};f.prototype.Solve2=
function(){var b=this.v1.w,l=this.v2.w,a=e.SubtractVV(l,b),b=-(b.x*a.x+b.y*a.y);0>=b?this.count=this.v1.a=1:(l=l.x*a.x+l.y*a.y,0>=l?(this.count=this.v2.a=1,this.v1.Set(this.v2)):(a=1/(l+b),this.v1.a=l*a,this.v2.a=b*a,this.count=2))};f.prototype.Solve3=function(){var b=this.v1.w,l=this.v2.w,a=this.v3.w,f=e.SubtractVV(l,b),p=e.Dot(b,f),m=e.Dot(l,f),p=-p,k=e.SubtractVV(a,b),d=e.Dot(b,k),u=e.Dot(a,k),d=-d,r=e.SubtractVV(a,l),c=e.Dot(l,r),r=e.Dot(a,r),c=-c,k=e.CrossVV(f,k),f=k*e.CrossVV(l,a),a=k*e.CrossVV(a,
b),b=k*e.CrossVV(b,l);0>=p&&0>=d?this.count=this.v1.a=1:0<m&&0<p&&0>=b?(u=1/(m+p),this.v1.a=m*u,this.v2.a=p*u,this.count=2):0<u&&0<d&&0>=a?(m=1/(u+d),this.v1.a=u*m,this.v3.a=d*m,this.count=2,this.v2.Set(this.v3)):0>=m&&0>=c?(this.count=this.v2.a=1,this.v1.Set(this.v2)):0>=u&&0>=r?(this.count=this.v3.a=1,this.v1.Set(this.v3)):0<r&&0<c&&0>=f?(m=1/(r+c),this.v2.a=r*m,this.v3.a=c*m,this.count=2,this.v1.Set(this.v3)):(m=1/(f+a+b),this.v1.a=f*m,this.v2.a=a*m,this.v3.a=b*m,this.count=3)};u.SimplexCache=
function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};m.SimplexVertex=function(){};m.prototype.Set=function(b){this.wA.SetV(b.wA);this.wB.SetV(b.wB);this.w.SetV(b.w);this.a=b.a;this.indexA=b.indexA;this.indexB=b.indexB};k.TimeOfImpact=function(){};k.TimeOfImpact=function(b){++k._toiCalls;var l=b.proxyA,a=b.proxyB,f=b.sweepA,p=b.sweepB;g.Assert(f.t0==p.t0);g.Assert(1-f.t0>Number.MIN_VALUE);var m=l.radius+a.radius;b=b.tolerance;var d=0,u=0,r=0;k.s_cache.count=0;for(k.s_distanceInput.useRadii=
!1;;){f.GetTransform(k.s_xfA,d);p.GetTransform(k.s_xfB,d);k.s_distanceInput.proxyA=l;k.s_distanceInput.proxyB=a;k.s_distanceInput.transformA=k.s_xfA;k.s_distanceInput.transformB=k.s_xfB;M.Distance(k.s_distanceOutput,k.s_cache,k.s_distanceInput);if(0>=k.s_distanceOutput.distance){d=1;break}k.s_fcn.Initialize(k.s_cache,l,k.s_xfA,a,k.s_xfB);var c=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(0>=c){d=1;break}0==u&&(r=c>m?e.Max(m-b,.75*m):e.Max(c-b,.02*m));if(c-r<.5*b){if(0==u){d=1;break}break}var C=d,q=d,E=1;
f.GetTransform(k.s_xfA,E);p.GetTransform(k.s_xfB,E);var v=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(v>=r){d=1;break}for(var h=0;;){var G;G=h&1?q+(r-c)*(E-q)/(v-c):.5*(q+E);f.GetTransform(k.s_xfA,G);p.GetTransform(k.s_xfB,G);var y=k.s_fcn.Evaluate(k.s_xfA,k.s_xfB);if(e.Abs(y-r)<.025*b){C=G;break}y>r?(q=G,c=y):(E=G,v=y);++h;++k._toiRootIters;if(50==h)break}k._toiMaxRootIters=e.Max(k._toiMaxRootIters,h);if(C<(1+100*Number.MIN_VALUE)*d)break;d=C;u++;++k._toiIters;if(1E3==u)break}k._toiMaxIters=e.Max(k._toiMaxIters,
u);return d};Box2D.postDefs.push(function(){Box2D.Collision.TimeOfImpact._toiCalls=0;Box2D.Collision.TimeOfImpact._toiIters=0;Box2D.Collision.TimeOfImpact._toiMaxIters=0;Box2D.Collision.TimeOfImpact._toiRootIters=0;Box2D.Collision.TimeOfImpact._toiMaxRootIters=0;Box2D.Collision.TimeOfImpact.s_cache=new u;Box2D.Collision.TimeOfImpact.s_distanceInput=new N;Box2D.Collision.TimeOfImpact.s_xfA=new A;Box2D.Collision.TimeOfImpact.s_xfB=new A;Box2D.Collision.TimeOfImpact.s_fcn=new a;Box2D.Collision.TimeOfImpact.s_distanceOutput=
new d});C.TOIInput=function(){this.proxyA=new E;this.proxyB=new E;this.sweepA=new h;this.sweepB=new h};r.WorldManifold=function(){this.normal=new c};r.prototype.WorldManifold=function(){this.points=new Vector(g._maxManifoldPoints);for(var b=0;b<g._maxManifoldPoints;b++)this.points[b]=new c};r.prototype.Initialize=function(b,l,a,f,p){void 0===a&&(a=0);void 0===p&&(p=0);if(0!=b.pointCount){var m,k,d,u,r,c,C,q;switch(b.type){case y.e_circles:d=l.R;k=b.localPoint;m=l.position.x+d.col1.x*k.x+d.col2.x*
k.y;l=l.position.y+d.col1.y*k.x+d.col2.y*k.y;d=f.R;k=b.points[0].localPoint;b=f.position.x+d.col1.x*k.x+d.col2.x*k.y;f=f.position.y+d.col1.y*k.x+d.col2.y*k.y;k=b-m;d=f-l;u=k*k+d*d;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=e.sqrt(u),this.normal.x=k/u,this.normal.y=d/u):(this.normal.x=1,this.normal.y=0);k=l+a*this.normal.y;f-=p*this.normal.y;this.points[0].x=.5*(m+a*this.normal.x+(b-p*this.normal.x));this.points[0].y=.5*(k+f);break;case y.e_faceA:d=l.R;k=b.localPlaneNormal;u=d.col1.x*k.x+d.col2.x*k.y;
r=d.col1.y*k.x+d.col2.y*k.y;d=l.R;k=b.localPoint;c=l.position.x+d.col1.x*k.x+d.col2.x*k.y;C=l.position.y+d.col1.y*k.x+d.col2.y*k.y;this.normal.x=u;this.normal.y=r;for(m=0;m<b.pointCount;m++)d=f.R,k=b.points[m].localPoint,q=f.position.x+d.col1.x*k.x+d.col2.x*k.y,k=f.position.y+d.col1.y*k.x+d.col2.y*k.y,this.points[m].x=q+.5*(a-(q-c)*u-(k-C)*r-p)*u,this.points[m].y=k+.5*(a-(q-c)*u-(k-C)*r-p)*r;break;case y.e_faceB:for(d=f.R,k=b.localPlaneNormal,u=d.col1.x*k.x+d.col2.x*k.y,r=d.col1.y*k.x+d.col2.y*k.y,
d=f.R,k=b.localPoint,c=f.position.x+d.col1.x*k.x+d.col2.x*k.y,C=f.position.y+d.col1.y*k.x+d.col2.y*k.y,this.normal.x=-u,this.normal.y=-r,m=0;m<b.pointCount;m++)d=l.R,k=b.points[m].localPoint,q=l.position.x+d.col1.x*k.x+d.col2.x*k.y,k=l.position.y+d.col1.y*k.x+d.col2.y*k.y,this.points[m].x=q+.5*(p-(q-c)*u-(k-C)*r-a)*u,this.points[m].y=k+.5*(p-(q-c)*u-(k-C)*r-a)*r}}};b.ClipVertex=function(){this.v=new c;this.id=new B};b.prototype.Set=function(b){this.v.SetV(b.v);this.id.Set(b.id)};l.Features=function(){};
Object.defineProperty(l.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(l.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._referenceEdge=b;this._id._key=this._id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(l.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(l.prototype,"incidentEdge",
{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._incidentEdge=b;this._id._key=this._id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(l.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(l.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._incidentVertex=b;this._id._key=this._id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(l.prototype,
"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(l.prototype,"flip",{enumerable:!1,configurable:!0,set:function(b){void 0===b&&(b=0);this._flip=b;this._id._key=this._id._key&16777215|this._flip<<24&4278190080}})})();
(function(){var t=Box2D.Common.Settings,n=Box2D.Collision.Shapes.CircleShape,w=Box2D.Collision.Shapes.EdgeChainDef,g=Box2D.Collision.Shapes.EdgeShape,e=Box2D.Collision.Shapes.MassData,h=Box2D.Collision.Shapes.PolygonShape,A=Box2D.Collision.Shapes.Shape,c=Box2D.Common.Math.Mat22,v=Box2D.Common.Math.Math,J=Box2D.Common.Math.Transform,D=Box2D.Common.Math.Vec2,z=Box2D.Collision.Distance,B=Box2D.Collision.DistanceInput,x=Box2D.Collision.DistanceOutput,M=Box2D.Collision.DistanceProxy,N=Box2D.Collision.SimplexCache;
Box2D.inherit(n,Box2D.Collision.Shapes.Shape);n.prototype.__super=Box2D.Collision.Shapes.Shape.prototype;n.CircleShape=function(){Box2D.Collision.Shapes.Shape.Shape.apply(this,arguments);this.p=new D};n.prototype.Copy=function(){var d=new n;d.Set(this);return d};n.prototype.Set=function(d){this.__super.Set.call(this,d);Box2D.is(d,n)&&this.p.SetV((d instanceof n?d:null).p)};n.prototype.TestPoint=function(d,c){var q=d.R,e=d.position.x+(q.col1.x*this.p.x+q.col2.x*this.p.y),q=d.position.y+(q.col1.y*this.p.x+
q.col2.y*this.p.y),e=c.x-e,q=c.y-q;return e*e+q*q<=this.radius*this.radius};n.prototype.RayCast=function(d,c,q){var e=q.R,g=c.p1.x-(q.position.x+(e.col1.x*this.p.x+e.col2.x*this.p.y));q=c.p1.y-(q.position.y+(e.col1.y*this.p.x+e.col2.y*this.p.y));var e=c.p2.x-c.p1.x,h=c.p2.y-c.p1.y,y=g*e+q*h,t=e*e+h*h,n=y*y-t*(g*g+q*q-this.radius*this.radius);if(0>n||t<Number.MIN_VALUE)return!1;y=-(y+v.sqrt(n));return 0<=y&&y<=c.maxFraction*t?(y/=t,d.fraction=y,d.normal.x=g+y*e,d.normal.y=q+y*h,d.normal.Normalize(),
!0):!1};n.prototype.ComputeAABB=function(d,c){var q=c.R,e=c.position.x+(q.col1.x*this.p.x+q.col2.x*this.p.y),q=c.position.y+(q.col1.y*this.p.x+q.col2.y*this.p.y);d.lowerBound.Set(e-this.radius,q-this.radius);d.upperBound.Set(e+this.radius,q+this.radius)};n.prototype.ComputeMass=function(d,c){void 0===c&&(c=0);d.mass=c*t._pi*this.radius*this.radius;d.center.SetV(this.p);d.I=d.mass*(.5*this.radius*this.radius+(this.p.x*this.p.x+this.p.y*this.p.y))};n.prototype.ComputeSubmergedArea=function(d,c,q,e){void 0===
c&&(c=0);q=v.MulX(q,this.p);var g=-(v.Dot(d,q)-c);if(g<-this.radius+Number.MIN_VALUE)return 0;if(g>this.radius)return e.SetV(q),v.PI*this.radius*this.radius;c=this.radius*this.radius;var h=g*g,g=c*(v.asin(g/this.radius)+v.PI/2)+g*v.sqrt(c-h);c=-2/3*v.pow(c-h,1.5)/g;e.x=q.x+d.x*c;e.y=q.y+d.y*c;return g};n.prototype.GetLocalPosition=function(){return this.p};n.prototype.SetLocalPosition=function(d){this.p.SetV(d)};n.prototype.GetRadius=function(){return this.radius};n.prototype.SetRadius=function(d){void 0===
d&&(d=0);this.radius=d};n.prototype.CircleShape=function(d){void 0===d&&(d=0);this.__super.Shape.call(this);this.type=A.e_circleShape;this.radius=d};w.EdgeChainDef=function(){};w.prototype.EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(g,Box2D.Collision.Shapes.Shape);g.prototype.__super=Box2D.Collision.Shapes.Shape.prototype;g.EdgeShape=function(){Box2D.Collision.Shapes.Shape.Shape.apply(this,arguments);this.s_supportVec=new D;this.v1=new D;this.v2=new D;
this.coreV1=new D;this.coreV2=new D;this.normal=new D;this.direction=new D;this.cornerDir1=new D;this.cornerDir2=new D};g.prototype.TestPoint=function(d,c){return!1};g.prototype.RayCast=function(d,c,q){var e,g=c.p2.x-c.p1.x,h=c.p2.y-c.p1.y;e=q.R;var y=q.position.x+(e.col1.x*this.v1.x+e.col2.x*this.v1.y),t=q.position.y+(e.col1.y*this.v1.x+e.col2.y*this.v1.y),n=q.position.y+(e.col1.y*this.v2.x+e.col2.y*this.v2.y)-t;q=-(q.position.x+(e.col1.x*this.v2.x+e.col2.x*this.v2.y)-y);e=100*Number.MIN_VALUE;var x=
-(g*n+h*q);if(x>e){var y=c.p1.x-y,w=c.p1.y-t,t=y*n+w*q;if(0<=t&&t<=c.maxFraction*x&&(c=-g*w+h*y,-e*x<=c&&c<=x*(1+e)))return d.fraction=t/x,c=v.sqrt(n*n+q*q),d.normal.x=n/c,d.normal.y=q/c,!0}return!1};g.prototype.ComputeAABB=function(d,c){var q=c.R,e=c.position.x+(q.col1.x*this.v1.x+q.col2.x*this.v1.y),g=c.position.y+(q.col1.y*this.v1.x+q.col2.y*this.v1.y),v=c.position.x+(q.col1.x*this.v2.x+q.col2.x*this.v2.y),q=c.position.y+(q.col1.y*this.v2.x+q.col2.y*this.v2.y);e<v?(d.lowerBound.x=e,d.upperBound.x=
v):(d.lowerBound.x=v,d.upperBound.x=e);g<q?(d.lowerBound.y=g,d.upperBound.y=q):(d.lowerBound.y=q,d.upperBound.y=g)};g.prototype.ComputeMass=function(d,c){d.mass=0;d.center.SetV(this.v1);d.I=0};g.prototype.ComputeSubmergedArea=function(d,c,q,e){void 0===c&&(c=0);var g=new D(d.x*c,d.y*c),h=v.MulX(q,this.v1);q=v.MulX(q,this.v2);var t=v.Dot(d,h)-c;d=v.Dot(d,q)-c;if(0<t){if(0<d)return 0;h.x=-d/(t-d)*h.x+t/(t-d)*q.x;h.y=-d/(t-d)*h.y+t/(t-d)*q.y}else 0<d&&(q.x=-d/(t-d)*h.x+t/(t-d)*q.x,q.y=-d/(t-d)*h.y+t/
(t-d)*q.y);e.x=(g.x+h.x+q.x)/3;e.y=(g.y+h.y+q.y)/3;return.5*((h.x-g.x)*(q.y-g.y)-(h.y-g.y)*(q.x-g.x))};g.prototype.GetLength=function(){return this.length};g.prototype.GetVertex1=function(){return this.v1};g.prototype.GetVertex2=function(){return this.v2};g.prototype.GetCoreVertex1=function(){return this.coreV1};g.prototype.GetCoreVertex2=function(){return this.coreV2};g.prototype.GetNormalVector=function(){return this.normal};g.prototype.GetDirectionVector=function(){return this.direction};g.prototype.GetCorner1Vector=
function(){return this.cornerDir1};g.prototype.GetCorner2Vector=function(){return this.cornerDir2};g.prototype.Corner1IsConvex=function(){return this.cornerConvex1};g.prototype.Corner2IsConvex=function(){return this.cornerConvex2};g.prototype.GetFirstVertex=function(d){var c=d.R;return new D(d.position.x+(c.col1.x*this.coreV1.x+c.col2.x*this.coreV1.y),d.position.y+(c.col1.y*this.coreV1.x+c.col2.y*this.coreV1.y))};g.prototype.GetNextEdge=function(){return this.nextEdge};g.prototype.GetPrevEdge=function(){return this.prevEdge};
g.prototype.Support=function(d,c,q){void 0===c&&(c=0);void 0===q&&(q=0);var e=d.R,g=d.position.x+(e.col1.x*this.coreV1.x+e.col2.x*this.coreV1.y),v=d.position.y+(e.col1.y*this.coreV1.x+e.col2.y*this.coreV1.y),h=d.position.x+(e.col1.x*this.coreV2.x+e.col2.x*this.coreV2.y);d=d.position.y+(e.col1.y*this.coreV2.x+e.col2.y*this.coreV2.y);g*c+v*q>h*c+d*q?(this.s_supportVec.x=g,this.s_supportVec.y=v):(this.s_supportVec.x=h,this.s_supportVec.y=d);return this.s_supportVec};g.prototype.EdgeShape=function(d,
c){this.__super.Shape.call(this);this.type=A.e_edgeShape;this.nextEdge=this.prevEdge=null;this.v1=d;this.v2=c;this.direction.Set(this.v2.x-this.v1.x,this.v2.y-this.v1.y);this.length=this.direction.Normalize();this.normal.Set(this.direction.y,-this.direction.x);this.coreV1.Set(-t._toiSlop*(this.normal.x-this.direction.x)+this.v1.x,-t._toiSlop*(this.normal.y-this.direction.y)+this.v1.y);this.coreV2.Set(-t._toiSlop*(this.normal.x+this.direction.x)+this.v2.x,-t._toiSlop*(this.normal.y+this.direction.y)+
this.v2.y);this.cornerDir1=this.normal;this.cornerDir2.Set(-this.normal.x,-this.normal.y)};g.prototype.SetPrevEdge=function(d,c,q,e){this.prevEdge=d;this.coreV1=c;this.cornerDir1=q;this.cornerConvex1=e};g.prototype.SetNextEdge=function(d,c,q,e){this.nextEdge=d;this.coreV2=c;this.cornerDir2=q;this.cornerConvex2=e};e.MassData=function(){this.mass=0;this.center=new D(0,0);this.I=0};Box2D.inherit(h,Box2D.Collision.Shapes.Shape);h.prototype.__super=Box2D.Collision.Shapes.Shape.prototype;h.PolygonShape=
function(){Box2D.Collision.Shapes.Shape.Shape.apply(this,arguments)};h.prototype.Copy=function(){var d=new h;d.Set(this);return d};h.prototype.Set=function(d){this.__super.Set.call(this,d);if(Box2D.is(d,h)){d=d instanceof h?d:null;this.centroid.SetV(d.centroid);this.vertexCount=d.vertexCount;this.Reserve(this.vertexCount);for(var c=0;c<this.vertexCount;c++)this.vertices[c].SetV(d.vertices[c]),this.normals[c].SetV(d.normals[c])}};h.prototype.SetAsArray=function(d,c){void 0===c&&(c=0);var q=new Vector,
e,g;for(e=0;e<d.length;++e)g=d[e],q.push(g);this.SetAsVector(q,c)};h.AsArray=function(d,c){void 0===c&&(c=0);var e=new h;e.SetAsArray(d,c);return e};h.prototype.SetAsVector=function(d,c){void 0===c&&(c=0);0==c&&(c=d.length);t.Assert(2<=c);this.vertexCount=c;this.Reserve(c);var e;for(e=0;e<this.vertexCount;e++)this.vertices[e].SetV(d[e]);for(e=0;e<this.vertexCount;++e){var g=parseInt(e),n=parseInt(e+1<this.vertexCount?e+1:0),g=v.SubtractVV(this.vertices[n],this.vertices[g]);t.Assert(g.LengthSquared()>
Number.MIN_VALUE);this.normals[e].SetV(v.CrossVF(g,1));this.normals[e].Normalize()}this.centroid=h.ComputeCentroid(this.vertices,this.vertexCount)};h.AsVector=function(d,c){void 0===c&&(c=0);var e=new h;e.SetAsVector(d,c);return e};h.prototype.SetAsBox=function(d,c){void 0===d&&(d=0);void 0===c&&(c=0);this.vertexCount=4;this.Reserve(4);this.vertices[0].Set(-d,-c);this.vertices[1].Set(d,-c);this.vertices[2].Set(d,c);this.vertices[3].Set(-d,c);this.normals[0].Set(0,-1);this.normals[1].Set(1,0);this.normals[2].Set(0,
1);this.normals[3].Set(-1,0);this.centroid.SetZero()};h.AsBox=function(d,c){void 0===d&&(d=0);void 0===c&&(c=0);var e=new h;e.SetAsBox(d,c);return e};h.prototype.SetAsOrientedBox=function(d,c,e,g){void 0===d&&(d=0);void 0===c&&(c=0);void 0===e&&(e=null);void 0===g&&(g=0);this.vertexCount=4;this.Reserve(4);this.vertices[0].Set(-d,-c);this.vertices[1].Set(d,-c);this.vertices[2].Set(d,c);this.vertices[3].Set(-d,c);this.normals[0].Set(0,-1);this.normals[1].Set(1,0);this.normals[2].Set(0,1);this.normals[3].Set(-1,
0);this.centroid=e;d=new J;d.position=e;d.R.Set(g);for(e=0;e<this.vertexCount;++e)this.vertices[e]=v.MulX(d,this.vertices[e]),this.normals[e]=v.MulMV(d.R,this.normals[e])};h.AsOrientedBox=function(d,c,e,g){void 0===d&&(d=0);void 0===c&&(c=0);void 0===e&&(e=null);void 0===g&&(g=0);var v=new h;v.SetAsOrientedBox(d,c,e,g);return v};h.prototype.SetAsEdge=function(d,c){this.vertexCount=2;this.Reserve(2);this.vertices[0].SetV(d);this.vertices[1].SetV(c);this.centroid.x=.5*(d.x+c.x);this.centroid.y=.5*(d.y+
c.y);this.normals[0]=v.CrossVF(v.SubtractVV(c,d),1);this.normals[0].Normalize();this.normals[1].x=-this.normals[0].x;this.normals[1].y=-this.normals[0].y};h.AsEdge=function(d,c){var e=new h;e.SetAsEdge(d,c);return e};h.prototype.TestPoint=function(d,c){var e;e=d.R;for(var g=c.x-d.position.x,v=c.y-d.position.y,h=g*e.col1.x+v*e.col1.y,t=g*e.col2.x+v*e.col2.y,n=0;n<this.vertexCount;++n)if(e=this.vertices[n],g=h-e.x,v=t-e.y,e=this.normals[n],0<e.x*g+e.y*v)return!1;return!0};h.prototype.RayCast=function(d,
c,e){var g=0,v=c.maxFraction,h,t,n,x;h=c.p1.x-e.position.x;t=c.p1.y-e.position.y;n=e.R;var w=h*n.col1.x+t*n.col1.y,B=h*n.col2.x+t*n.col2.y;h=c.p2.x-e.position.x;t=c.p2.y-e.position.y;n=e.R;c=h*n.col1.x+t*n.col1.y-w;n=h*n.col2.x+t*n.col2.y-B;for(var z=-1,a=0;a<this.vertexCount;++a){x=this.vertices[a];h=x.x-w;t=x.y-B;x=this.normals[a];h=x.x*h+x.y*t;t=x.x*c+x.y*n;if(0==t){if(0>h)return!1}else 0>t&&h<g*t?(g=h/t,z=a):0<t&&h<v*t&&(v=h/t);if(v<g-Number.MIN_VALUE)return!1}return 0<=z?(d.fraction=g,n=e.R,
x=this.normals[z],d.normal.x=n.col1.x*x.x+n.col2.x*x.y,d.normal.y=n.col1.y*x.x+n.col2.y*x.y,!0):!1};h.prototype.ComputeAABB=function(d,c){for(var e=c.R,g=this.vertices[0],h=c.position.x+(e.col1.x*g.x+e.col2.x*g.y),v=c.position.y+(e.col1.y*g.x+e.col2.y*g.y),t=h,n=v,x=1;x<this.vertexCount;++x)var g=this.vertices[x],w=c.position.x+(e.col1.x*g.x+e.col2.x*g.y),g=c.position.y+(e.col1.y*g.x+e.col2.y*g.y),h=h<w?h:w,v=v<g?v:g,t=t>w?t:w,n=n>g?n:g;d.lowerBound.x=h-this.radius;d.lowerBound.y=v-this.radius;d.upperBound.x=
t+this.radius;d.upperBound.y=n+this.radius};h.prototype.ComputeMass=function(d,c){void 0===c&&(c=0);if(2==this.vertexCount)d.center.x=.5*(this.vertices[0].x+this.vertices[1].x),d.center.y=.5*(this.vertices[0].y+this.vertices[1].y),d.mass=0,d.I=0;else{for(var e=0,g=0,h=0,v=0,t=1/3,n=0;n<this.vertexCount;++n)var x=this.vertices[n],w=n+1<this.vertexCount?this.vertices[parseInt(n+1)]:this.vertices[0],B=x.x-0,z=x.y-0,a=w.x-0,f=w.y-0,u=B*f-z*a,m=.5*u,h=h+m,e=e+m*t*(0+x.x+w.x),g=g+m*t*(0+x.y+w.y),x=B,v=
v+u*(t*(.25*(x*x+a*x+a*a)+(0*x+0*a))+0+(t*(.25*(z*z+f*z+f*f)+(0*z+0*f))+0));d.mass=c*h;d.center.Set(1/h*e,1/h*g);d.I=c*v}};h.prototype.ComputeSubmergedArea=function(d,c,g,h){void 0===c&&(c=0);var t=v.MulTMV(g.R,d),n=c-v.Dot(d,g.position),x=new Vector_a2j_Number,w=0,B=-1;c=-1;var z=!1;for(d=0;d<this.vertexCount;++d){x[d]=v.Dot(t,this.vertices[d])-n;var J=x[d]<-Number.MIN_VALUE;0<d&&(J?z||(B=d-1,w++):z&&(c=d-1,w++));z=J}switch(w){case 0:return z?(d=new e,this.ComputeMass(d,1),h.SetV(v.MulX(g,d.center)),
d.mass):0;case 1:-1==B?B=this.vertexCount-1:c=this.vertexCount-1}d=parseInt((B+1)%this.vertexCount);t=parseInt((c+1)%this.vertexCount);n=(0-x[B])/(x[d]-x[B]);x=(0-x[c])/(x[t]-x[c]);B=new D(this.vertices[B].x*(1-n)+this.vertices[d].x*n,this.vertices[B].y*(1-n)+this.vertices[d].y*n);c=new D(this.vertices[c].x*(1-x)+this.vertices[t].x*x,this.vertices[c].y*(1-x)+this.vertices[t].y*x);x=0;n=new D;for(w=this.vertices[d];d!=t;)d=(d+1)%this.vertexCount,z=d==t?c:this.vertices[d],J=.5*((w.x-B.x)*(z.y-B.y)-
(w.y-B.y)*(z.x-B.x)),x+=J,n.x+=J*(B.x+w.x+z.x)/3,n.y+=J*(B.y+w.y+z.y)/3,w=z;n.Multiply(1/x);h.SetV(v.MulX(g,n));return x};h.prototype.GetVertexCount=function(){return this.vertexCount};h.prototype.GetVertices=function(){return this.vertices};h.prototype.GetNormals=function(){return this.normals};h.prototype.GetSupport=function(d){for(var c=0,e=this.vertices[0].x*d.x+this.vertices[0].y*d.y,g=1;g<this.vertexCount;++g){var h=this.vertices[g].x*d.x+this.vertices[g].y*d.y;h>e&&(c=g,e=h)}return c};h.prototype.GetSupportVertex=
function(d){for(var c=0,e=this.vertices[0].x*d.x+this.vertices[0].y*d.y,g=1;g<this.vertexCount;++g){var h=this.vertices[g].x*d.x+this.vertices[g].y*d.y;h>e&&(c=g,e=h)}return this.vertices[c]};h.prototype.Validate=function(){return!1};h.prototype.PolygonShape=function(){this.__super.Shape.call(this);this.type=A.e_polygonShape;this.centroid=new D;this.vertices=new Vector;this.normals=new Vector};h.prototype.Reserve=function(d){void 0===d&&(d=0);for(var c=parseInt(this.vertices.length);c<d;c++)this.vertices[c]=
new D,this.normals[c]=new D};h.ComputeCentroid=function(d,c){void 0===c&&(c=0);for(var e=new D,g=0,h=1/3,v=0;v<c;++v){var t=d[v],n=v+1<c?d[parseInt(v+1)]:d[0],x=.5*((t.x-0)*(n.y-0)-(t.y-0)*(n.x-0)),g=g+x;e.x+=x*h*(0+t.x+n.x);e.y+=x*h*(0+t.y+n.y)}e.x*=1/g;e.y*=1/g;return e};h.ComputeOBB=function(d,c,e){void 0===e&&(e=0);var g,h=new Vector(e+1);for(g=0;g<e;++g)h[g]=c[g];h[e]=h[0];c=Number.MAX_VALUE;for(g=1;g<=e;++g){for(var t=h[parseInt(g-1)],n=h[g].x-t.x,x=h[g].y-t.y,w=v.sqrt(n*n+x*x),n=n/w,x=x/w,
B=-x,z=n,J=w=Number.MAX_VALUE,a=-Number.MAX_VALUE,f=-Number.MAX_VALUE,u=0;u<e;++u){var m=h[u].x-t.x,k=h[u].y-t.y,C=n*m+x*k,m=B*m+z*k;C<w&&(w=C);m<J&&(J=m);C>a&&(a=C);m>f&&(f=m)}u=(a-w)*(f-J);u<.95*c&&(c=u,d.R.col1.x=n,d.R.col1.y=x,d.R.col2.x=B,d.R.col2.y=z,n=.5*(w+a),x=.5*(J+f),B=d.R,d.center.x=t.x+(B.col1.x*n+B.col2.x*x),d.center.y=t.y+(B.col1.y*n+B.col2.y*x),d.extents.x=.5*(a-w),d.extents.y=.5*(f-J))}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.PolygonShape.s_mat=new c});A.Shape=function(){};
A.prototype.Copy=function(){return null};A.prototype.Set=function(d){this.radius=d.radius};A.prototype.GetType=function(){return this.type};A.prototype.TestPoint=function(d,c){return!1};A.prototype.RayCast=function(d,c,e){return!1};A.prototype.ComputeAABB=function(d,c){};A.prototype.ComputeMass=function(d,c){};A.prototype.ComputeSubmergedArea=function(d,c,e,g){return 0};A.TestOverlap=function(d,c,e,g){var h=new B;h.proxyA=new M;h.proxyA.Set(d);h.proxyB=new M;h.proxyB.Set(e);h.transformA=c;h.transformB=
g;h.useRadii=!0;d=new N;d.count=0;c=new x;z.Distance(c,d,h);return c.distance<10*Number.MIN_VALUE};A.prototype.Shape=function(){this.type=A.e_unknownShape;this.radius=t._linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.Shape.e_unknownShape=-1;Box2D.Collision.Shapes.Shape.e_circleShape=0;Box2D.Collision.Shapes.Shape.e_polygonShape=1;Box2D.Collision.Shapes.Shape.e_edgeShape=2;Box2D.Collision.Shapes.Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.Shape.e_hitCollide=1;Box2D.Collision.Shapes.Shape.e_missCollide=
0;Box2D.Collision.Shapes.Shape.e_startsInsideCollide=-1})})();
(function(){var t=Box2D.Common.Color,n=Box2D.Common.Settings,w=Box2D.Common.Math.Math;t.Color=function(){this._b=this._g=this._r=0};t.prototype.Color=function(g,e,h){void 0===g&&(g=0);void 0===e&&(e=0);void 0===h&&(h=0);this._r=Box2D.parseUInt(255*w.Clamp(g,0,1));this._g=Box2D.parseUInt(255*w.Clamp(e,0,1));this._b=Box2D.parseUInt(255*w.Clamp(h,0,1))};t.prototype.Set=function(g,e,h){void 0===g&&(g=0);void 0===e&&(e=0);void 0===h&&(h=0);this._r=Box2D.parseUInt(255*w.Clamp(g,0,1));this._g=Box2D.parseUInt(255*
w.Clamp(e,0,1));this._b=Box2D.parseUInt(255*w.Clamp(h,0,1))};Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(g){void 0===g&&(g=0);this._r=Box2D.parseUInt(255*w.Clamp(g,0,1))}});Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(g){void 0===g&&(g=0);this._g=Box2D.parseUInt(255*w.Clamp(g,0,1))}});Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(g){void 0===g&&(g=0);this._b=Box2D.parseUInt(255*w.Clamp(g,
0,1))}});Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});n.Settings=function(){};n.MixFriction=function(g,e){void 0===g&&(g=0);void 0===e&&(e=0);return w.sqrt(g*e)};n.MixRestitution=function(g,e){void 0===g&&(g=0);void 0===e&&(e=0);return g>e?g:e};n.Assert=function(g){if(!g)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.Settings.VERSION="2.1alpha";Box2D.Common.Settings.USHRT_MAX=65535;Box2D.Common.Settings._pi=
w.PI;Box2D.Common.Settings._maxManifoldPoints=2;Box2D.Common.Settings._aabbExtension=.1;Box2D.Common.Settings._aabbMultiplier=2;Box2D.Common.Settings._polygonRadius=2*n._linearSlop;Box2D.Common.Settings._linearSlop=.005;Box2D.Common.Settings._angularSlop=2/180*n._pi;Box2D.Common.Settings._toiSlop=8*n._linearSlop;Box2D.Common.Settings._maxTOIContactsPerIsland=32;Box2D.Common.Settings._maxTOIJointsPerIsland=32;Box2D.Common.Settings._velocityThreshold=1;Box2D.Common.Settings._maxLinearCorrection=.2;
Box2D.Common.Settings._maxAngularCorrection=8/180*n._pi;Box2D.Common.Settings._maxTranslation=2;Box2D.Common.Settings._maxTranslationSquared=n._maxTranslation*n._maxTranslation;Box2D.Common.Settings._maxRotation=.5*n._pi;Box2D.Common.Settings._maxRotationSquared=n._maxRotation*n._maxRotation;Box2D.Common.Settings._contactBaumgarte=.2;Box2D.Common.Settings._timeToSleep=.5;Box2D.Common.Settings._linearSleepTolerance=.01;Box2D.Common.Settings._angularSleepTolerance=2/180*n._pi})})();
(function(){var t=Box2D.Common.Math.Mat22,n=Box2D.Common.Math.Mat33,w=Box2D.Common.Math.Math,g=Box2D.Common.Math.Sweep,e=Box2D.Common.Math.Transform,h=Box2D.Common.Math.Vec2,A=Box2D.Common.Math.Vec3;t.Mat22=function(){this.col1=new h;this.col2=new h};t.prototype.Mat22=function(){this.SetIdentity()};t.FromAngle=function(c){void 0===c&&(c=0);var e=new t;e.Set(c);return e};t.FromVV=function(c,e){var g=new t;g.SetVV(c,e);return g};t.prototype.Set=function(c){void 0===c&&(c=0);var e=w.cos(c);c=w.sin(c);
this.col1.x=e;this.col2.x=-c;this.col1.y=c;this.col2.y=e};t.prototype.SetVV=function(c,e){this.col1.SetV(c);this.col2.SetV(e)};t.prototype.Copy=function(){var c=new t;c.SetM(this);return c};t.prototype.SetM=function(c){this.col1.SetV(c.col1);this.col2.SetV(c.col2)};t.prototype.AddM=function(c){this.col1.x+=c.col1.x;this.col1.y+=c.col1.y;this.col2.x+=c.col2.x;this.col2.y+=c.col2.y};t.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};t.prototype.SetZero=function(){this.col1.x=
0;this.col2.x=0;this.col1.y=0;this.col2.y=0};t.prototype.GetAngle=function(){return w.atan2(this.col1.y,this.col1.x)};t.prototype.GetInverse=function(c){var e=this.col1.x,g=this.col2.x,h=this.col1.y,t=this.col2.y,n=e*t-g*h;0!=n&&(n=1/n);c.col1.x=n*t;c.col2.x=-n*g;c.col1.y=-n*h;c.col2.y=n*e;return c};t.prototype.Solve=function(c,e,g){void 0===e&&(e=0);void 0===g&&(g=0);var h=this.col1.x,t=this.col2.x,n=this.col1.y,x=this.col2.y,w=h*x-t*n;0!=w&&(w=1/w);c.x=w*(x*e-t*g);c.y=w*(h*g-n*e);return c};t.prototype.Abs=
function(){this.col1.Abs();this.col2.Abs()};n.Mat33=function(){this.col1=new A;this.col2=new A;this.col3=new A};n.prototype.Mat33=function(c,e,g){void 0===c&&(c=null);void 0===e&&(e=null);void 0===g&&(g=null);c||e||g?(this.col1.SetV(c),this.col2.SetV(e),this.col3.SetV(g)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())};n.prototype.SetVVV=function(c,e,g){this.col1.SetV(c);this.col2.SetV(e);this.col3.SetV(g)};n.prototype.Copy=function(){return new n(this.col1,this.col2,this.col3)};n.prototype.SetM=
function(c){this.col1.SetV(c.col1);this.col2.SetV(c.col2);this.col3.SetV(c.col3)};n.prototype.AddM=function(c){this.col1.x+=c.col1.x;this.col1.y+=c.col1.y;this.col1.z+=c.col1.z;this.col2.x+=c.col2.x;this.col2.y+=c.col2.y;this.col2.z+=c.col2.z;this.col3.x+=c.col3.x;this.col3.y+=c.col3.y;this.col3.z+=c.col3.z};n.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};n.prototype.SetZero=function(){this.col1.x=
0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};n.prototype.Solve22=function(c,e,g){void 0===e&&(e=0);void 0===g&&(g=0);var h=this.col1.x,t=this.col2.x,n=this.col1.y,x=this.col2.y,w=h*x-t*n;0!=w&&(w=1/w);c.x=w*(x*e-t*g);c.y=w*(h*g-n*e);return c};n.prototype.Solve33=function(c,e,g,h){void 0===e&&(e=0);void 0===g&&(g=0);void 0===h&&(h=0);var t=this.col1.x,n=this.col1.y,x=this.col1.z,w=this.col2.x,A=this.col2.y,d=this.col2.z,E=this.col3.x,
q=this.col3.y,G=this.col3.z,H=t*(A*G-d*q)+n*(d*E-w*G)+x*(w*q-A*E);0!=H&&(H=1/H);c.x=H*(e*(A*G-d*q)+g*(d*E-w*G)+h*(w*q-A*E));c.y=H*(t*(g*G-h*q)+n*(h*E-e*G)+x*(e*q-g*E));c.z=H*(t*(A*h-d*g)+n*(d*e-w*h)+x*(w*g-A*e));return c};w.Math=function(){};w.IsValid=function(c){void 0===c&&(c=0);return isFinite(c)};w.Dot=function(c,e){return c.x*e.x+c.y*e.y};w.CrossVV=function(c,e){return c.x*e.y-c.y*e.x};w.CrossVF=function(c,e){void 0===e&&(e=0);return new h(e*c.y,-e*c.x)};w.CrossFV=function(c,e){void 0===c&&(c=
0);return new h(-c*e.y,c*e.x)};w.MulMV=function(c,e){return new h(c.col1.x*e.x+c.col2.x*e.y,c.col1.y*e.x+c.col2.y*e.y)};w.MulTMV=function(c,e){return new h(w.Dot(e,c.col1),w.Dot(e,c.col2))};w.MulX=function(c,e){var g=w.MulMV(c.R,e);g.x+=c.position.x;g.y+=c.position.y;return g};w.MulXT=function(c,e){var g=w.SubtractVV(e,c.position),h=g.x*c.R.col1.x+g.y*c.R.col1.y;g.y=g.x*c.R.col2.x+g.y*c.R.col2.y;g.x=h;return g};w.AddVV=function(c,e){return new h(c.x+e.x,c.y+e.y)};w.SubtractVV=function(c,e){return new h(c.x-
e.x,c.y-e.y)};w.Distance=function(c,e){var g=c.x-e.x,h=c.y-e.y;return w.sqrt(g*g+h*h)};w.DistanceSquared=function(c,e){var g=c.x-e.x,h=c.y-e.y;return g*g+h*h};w.MulFV=function(c,e){void 0===c&&(c=0);return new h(c*e.x,c*e.y)};w.AddMM=function(c,e){return t.FromVV(w.AddVV(c.col1,e.col1),w.AddVV(c.col2,e.col2))};w.MulMM=function(c,e){return t.FromVV(w.MulMV(c,e.col1),w.MulMV(c,e.col2))};w.MulTMM=function(c,e){var g=new h(w.Dot(c.col1,e.col1),w.Dot(c.col2,e.col1)),n=new h(w.Dot(c.col1,e.col2),w.Dot(c.col2,
e.col2));return t.FromVV(g,n)};w.Abs=function(c){void 0===c&&(c=0);return 0<c?c:-c};w.AbsV=function(c){return new h(w.Abs(c.x),w.Abs(c.y))};w.AbsM=function(c){return t.FromVV(w.AbsV(c.col1),w.AbsV(c.col2))};w.Min=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);return c<e?c:e};w.MinV=function(c,e){return new h(w.Min(c.x,e.x),w.Min(c.y,e.y))};w.Max=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);return c>e?c:e};w.MaxV=function(c,e){return new h(w.Max(c.x,e.x),w.Max(c.y,e.y))};w.Clamp=function(c,
e,g){void 0===c&&(c=0);void 0===e&&(e=0);void 0===g&&(g=0);return c<e?e:c>g?g:c};w.ClampV=function(c,e,g){return w.MaxV(e,w.MinV(c,g))};w.Swap=function(c,e){var g=c[0];c[0]=e[0];e[0]=g};w.Random=function(){return 2*w.random()-1};w.RandomRange=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);var g=w.random();return(e-c)*g+c};w.NextPowerOfTwo=function(c){void 0===c&&(c=0);c|=c>>1&2147483647;c|=c>>2&1073741823;c|=c>>4&268435455;c|=c>>8&16777215;return(c|c>>16&65535)+1};w.IsPowerOfTwo=function(c){void 0===
c&&(c=0);return 0<c&&0==(c&c-1)};Box2D.postDefs.push(function(){Box2D.Common.Math.Math.Vec2_zero=new h(0,0);Box2D.Common.Math.Math.Mat22_identity=t.FromVV(new h(1,0),new h(0,1));Box2D.Common.Math.Math.Transforidentity=new e(w.Vec2_zero,w.Mat22_identity)});g.Sweep=function(){this.localCenter=new h;this.c0=new h;this.c=new h};g.prototype.Set=function(c){this.localCenter.SetV(c.localCenter);this.c0.SetV(c.c0);this.c.SetV(c.c);this.a0=c.a0;this.a=c.a;this.t0=c.t0};g.prototype.Copy=function(){var c=new g;
c.localCenter.SetV(this.localCenter);c.c0.SetV(this.c0);c.c.SetV(this.c);c.a0=this.a0;c.a=this.a;c.t0=this.t0;return c};g.prototype.GetTransform=function(c,e){void 0===e&&(e=0);c.position.x=(1-e)*this.c0.x+e*this.c.x;c.position.y=(1-e)*this.c0.y+e*this.c.y;c.R.Set((1-e)*this.a0+e*this.a);var g=c.R;c.position.x-=g.col1.x*this.localCenter.x+g.col2.x*this.localCenter.y;c.position.y-=g.col1.y*this.localCenter.x+g.col2.y*this.localCenter.y};g.prototype.Advance=function(c){void 0===c&&(c=0);if(this.t0<
c&&1-this.t0>Number.MIN_VALUE){var e=(c-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x;this.c0.y=(1-e)*this.c0.y+e*this.c.y;this.a0=(1-e)*this.a0+e*this.a;this.t0=c}};e.Transform=function(){this.position=new h;this.R=new t};e.prototype.Transform=function(c,e){void 0===c&&(c=null);void 0===e&&(e=null);c&&(this.position.SetV(c),this.R.SetM(e))};e.prototype.Initialize=function(c,e){this.position.SetV(c);this.R.SetM(e)};e.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};
e.prototype.Set=function(c){this.position.SetV(c.position);this.R.SetM(c.R)};e.prototype.GetAngle=function(){return w.atan2(this.R.col1.y,this.R.col1.x)};h.Vec2=function(){};h.prototype.Vec2=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.x=c;this.y=e};h.prototype.SetZero=function(){this.y=this.x=0};h.prototype.Set=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.x=c;this.y=e};h.prototype.SetV=function(c){this.x=c.x;this.y=c.y};h.prototype.GetNegative=function(){return new h(-this.x,
-this.y)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};h.Make=function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);return new h(c,e)};h.prototype.Copy=function(){return new h(this.x,this.y)};h.prototype.Add=function(c){this.x+=c.x;this.y+=c.y};h.prototype.Subtract=function(c){this.x-=c.x;this.y-=c.y};h.prototype.Multiply=function(c){void 0===c&&(c=0);this.x*=c;this.y*=c};h.prototype.MulM=function(c){var e=this.x;this.x=c.col1.x*e+c.col2.x*this.y;this.y=c.col1.y*e+c.col2.y*this.y};
h.prototype.MulTM=function(c){var e=w.Dot(this,c.col1);this.y=w.Dot(this,c.col2);this.x=e};h.prototype.CrossVF=function(c){void 0===c&&(c=0);var e=this.x;this.x=c*this.y;this.y=-c*e};h.prototype.CrossFV=function(c){void 0===c&&(c=0);var e=this.x;this.x=-c*this.y;this.y=c*e};h.prototype.MinV=function(c){this.x=this.x<c.x?this.x:c.x;this.y=this.y<c.y?this.y:c.y};h.prototype.MaxV=function(c){this.x=this.x>c.x?this.x:c.x;this.y=this.y>c.y?this.y:c.y};h.prototype.Abs=function(){0>this.x&&(this.x=-this.x);
0>this.y&&(this.y=-this.y)};h.prototype.Length=function(){return w.sqrt(this.x*this.x+this.y*this.y)};h.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};h.prototype.Normalize=function(){var c=w.sqrt(this.x*this.x+this.y*this.y);if(c<Number.MIN_VALUE)return 0;var e=1/c;this.x*=e;this.y*=e;return c};h.prototype.IsValid=function(){return w.IsValid(this.x)&&w.IsValid(this.y)};A.Vec3=function(){};A.prototype.Vec3=function(c,e,g){void 0===c&&(c=0);void 0===e&&(e=0);void 0===g&&(g=
0);this.x=c;this.y=e;this.z=g};A.prototype.SetZero=function(){this.x=this.y=this.z=0};A.prototype.Set=function(c,e,g){void 0===c&&(c=0);void 0===e&&(e=0);void 0===g&&(g=0);this.x=c;this.y=e;this.z=g};A.prototype.SetV=function(c){this.x=c.x;this.y=c.y;this.z=c.z};A.prototype.GetNegative=function(){return new A(-this.x,-this.y,-this.z)};A.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};A.prototype.Copy=function(){return new A(this.x,this.y,this.z)};A.prototype.Add=function(c){this.x+=
c.x;this.y+=c.y;this.z+=c.z};A.prototype.Subtract=function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z};A.prototype.Multiply=function(c){void 0===c&&(c=0);this.x*=c;this.y*=c;this.z*=c}})();
(function(){var t=Box2D.Common.Math.Math,n=Box2D.Common.Math.Sweep,w=Box2D.Common.Math.Transform,g=Box2D.Common.Math.Vec2,e=Box2D.Common.Color,h=Box2D.Common.Settings,A=Box2D.Collision.AABB,c=Box2D.Collision.ContactPoint,v=Box2D.Collision.DynamicTreeBroadPhase,J=Box2D.Collision.RayCastInput,D=Box2D.Collision.RayCastOutput,z=Box2D.Collision.Shapes.CircleShape,B=Box2D.Collision.Shapes.EdgeShape,x=Box2D.Collision.Shapes.MassData,M=Box2D.Collision.Shapes.PolygonShape,N=Box2D.Collision.Shapes.Shape,d=
Box2D.Dynamics.Body,E=Box2D.Dynamics.BodyDef,q=Box2D.Dynamics.ContactFilter,G=Box2D.Dynamics.ContactImpulse,H=Box2D.Dynamics.ContactListener,K=Box2D.Dynamics.ContactManager,y=Box2D.Dynamics.DebugDraw,O=Box2D.Dynamics.DestructionListener,F=Box2D.Dynamics.FilterData,I=Box2D.Dynamics.Fixture,P=Box2D.Dynamics.FixtureDef,L=Box2D.Dynamics.Island,a=Box2D.Dynamics.TimeStep,f=Box2D.Dynamics.World,u=Box2D.Dynamics.Contacts.Contact,m=Box2D.Dynamics.Contacts.ContactFactory,k=Box2D.Dynamics.Contacts.ContactSolver,
C=Box2D.Dynamics.Joints.Joint,r=Box2D.Dynamics.Joints.PulleyJoint;d.Body=function(){this.xf=new w;this.sweep=new n;this.linearVelocity=new g;this.force=new g};d.prototype.connectEdges=function(b,l,a){void 0===a&&(a=0);var f=t.atan2(l.GetDirectionVector().y,l.GetDirectionVector().x);a=t.tan(.5*(f-a));a=t.MulFV(a,l.GetDirectionVector());a=t.SubtractVV(a,l.GetNormalVector());a=t.MulFV(h._toiSlop,a);a=t.AddVV(a,l.GetVertex1());var m=t.AddVV(b.GetDirectionVector(),l.GetDirectionVector());m.Normalize();
var k=0<t.Dot(b.GetDirectionVector(),l.GetNormalVector());b.SetNextEdge(l,a,m,k);l.SetPrevEdge(b,a,m,k);return f};d.prototype.CreateFixture=function(b){if(1==this.world.IsLocked())return null;var l=new I;l.Create(this,this.xf,b);this.flags&d.e_activeFlag&&l.CreateProxy(this.world.contactManager.broadPhase,this.xf);l.next=this.fixtureList;this.fixtureList=l;++this.fixtureCount;l.body=this;0<l.density&&this.ResetMassData();this.world.flags|=f.e_newFixture;return l};d.prototype.CreateFixture2=function(b,
l){void 0===l&&(l=0);var a=new P;a.shape=b;a.density=l;return this.CreateFixture(a)};d.prototype.DestroyFixture=function(b){if(1!=this.world.IsLocked()){for(var l=this.fixtureList,a=null;null!=l;){if(l==b){a?a.next=b.next:this.fixtureList=b.next;break}a=l;l=l.next}for(l=this.contactList;l;){var a=l.contact,l=l.next,f=a.GetFixtureA(),m=a.GetFixtureB();b!=f&&b!=m||this.world.contactManager.Destroy(a)}this.flags&d.e_activeFlag&&b.DestroyProxy(this.world.contactManager.broadPhase);b.Destroy();b.body=
null;b.next=null;--this.fixtureCount;this.ResetMassData()}};d.prototype.SetPositionAndAngle=function(b,l){void 0===l&&(l=0);var a;if(1!=this.world.IsLocked()){this.xf.R.Set(l);this.xf.position.SetV(b);a=this.xf.R;var f=this.sweep.localCenter;this.sweep.c.x=a.col1.x*f.x+a.col2.x*f.y;this.sweep.c.y=a.col1.y*f.x+a.col2.y*f.y;this.sweep.c.x+=this.xf.position.x;this.sweep.c.y+=this.xf.position.y;this.sweep.c0.SetV(this.sweep.c);this.sweep.a0=this.sweep.a=l;f=this.world.contactManager.broadPhase;for(a=
this.fixtureList;a;a=a.next)a.Synchronize(f,this.xf,this.xf);this.world.contactManager.FindNewContacts()}};d.prototype.SetTransform=function(b){this.SetPositionAndAngle(b.position,b.GetAngle())};d.prototype.GetTransform=function(){return this.xf};d.prototype.GetPosition=function(){return this.xf.position};d.prototype.SetPosition=function(b){this.SetPositionAndAngle(b,this.GetAngle())};d.prototype.GetAngle=function(){return this.sweep.a};d.prototype.SetAngle=function(b){void 0===b&&(b=0);this.SetPositionAndAngle(this.GetPosition(),
b)};d.prototype.GetWorldCenter=function(){return this.sweep.c};d.prototype.GetLocalCenter=function(){return this.sweep.localCenter};d.prototype.SetLinearVelocity=function(b){this.type!=d._staticBody&&this.linearVelocity.SetV(b)};d.prototype.GetLinearVelocity=function(){return this.linearVelocity};d.prototype.SetAngularVelocity=function(b){void 0===b&&(b=0);this.type!=d._staticBody&&(this.angularVelocity=b)};d.prototype.GetAngularVelocity=function(){return this.angularVelocity};d.prototype.GetDefinition=
function(){var b=new E;b.type=this.GetType();b.allowSleep=(this.flags&d.e_allowSleepFlag)==d.e_allowSleepFlag;b.angle=this.GetAngle();b.angularDamping=this.angularDamping;b.angularVelocity=this.angularVelocity;b.fixedRotation=(this.flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag;b.bullet=(this.flags&d.e_bulletFlag)==d.e_bulletFlag;b.awake=(this.flags&d.e_awakeFlag)==d.e_awakeFlag;b.linearDamping=this.linearDamping;b.linearVelocity.SetV(this.GetLinearVelocity());b.position=this.GetPosition();b.userData=
this.GetUserData();return b};d.prototype.ApplyForce=function(b,l){this.type==d._dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.force.x+=b.x,this.force.y+=b.y,this.torque+=(l.x-this.sweep.c.x)*b.y-(l.y-this.sweep.c.y)*b.x)};d.prototype.ApplyTorque=function(b){void 0===b&&(b=0);this.type==d._dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.torque+=b)};d.prototype.ApplyImpulse=function(b,l){this.type==d._dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.linearVelocity.x+=this.invMass*
b.x,this.linearVelocity.y+=this.invMass*b.y,this.angularVelocity+=this.invI*((l.x-this.sweep.c.x)*b.y-(l.y-this.sweep.c.y)*b.x))};d.prototype.Split=function(b){for(var l=this.GetLinearVelocity().Copy(),a=this.GetAngularVelocity(),f=this.GetWorldCenter(),m=this.world.CreateBody(this.GetDefinition()),k,d=this.fixtureList;d;)if(b(d)){var c=d.next;k?k.next=c:this.fixtureList=c;this.fixtureCount--;d.next=m.fixtureList;m.fixtureList=d;m.fixtureCount++;d.body=m;d=c}else k=d,d=d.next;this.ResetMassData();
m.ResetMassData();k=this.GetWorldCenter();b=m.GetWorldCenter();k=t.AddVV(l,t.CrossFV(a,t.SubtractVV(k,f)));l=t.AddVV(l,t.CrossFV(a,t.SubtractVV(b,f)));this.SetLinearVelocity(k);m.SetLinearVelocity(l);this.SetAngularVelocity(a);m.SetAngularVelocity(a);this.SynchronizeFixtures();m.SynchronizeFixtures();return m};d.prototype.Merge=function(b){var l;for(l=b.fixtureList;l;){var a=l.next;b.fixtureCount--;l.next=this.fixtureList;this.fixtureList=l;this.fixtureCount++;l.body=m;l=a}f.fixtureCount=0;var f=
this,m=b;f.GetWorldCenter();m.GetWorldCenter();f.GetLinearVelocity().Copy();m.GetLinearVelocity().Copy();f.GetAngularVelocity();m.GetAngularVelocity();f.ResetMassData();this.SynchronizeFixtures()};d.prototype.GetMass=function(){return this.mass};d.prototype.GetInertia=function(){return this.I};d.prototype.GetMassData=function(b){b.mass=this.mass;b.I=this.I;b.center.SetV(this.sweep.localCenter)};d.prototype.SetMassData=function(b){h.Assert(0==this.world.IsLocked());if(1!=this.world.IsLocked()&&this.type==
d._dynamicBody){this.invI=this.I=this.invMass=0;this.mass=b.mass;0>=this.mass&&(this.mass=1);this.invMass=1/this.mass;0<b.I&&0==(this.flags&d.e_fixedRotationFlag)&&(this.I=b.I-this.mass*(b.center.x*b.center.x+b.center.y*b.center.y),this.invI=1/this.I);var l=this.sweep.c.Copy();this.sweep.localCenter.SetV(b.center);this.sweep.c0.SetV(t.MulX(this.xf,this.sweep.localCenter));this.sweep.c.SetV(this.sweep.c0);this.linearVelocity.x+=this.angularVelocity*-(this.sweep.c.y-l.y);this.linearVelocity.y+=this.angularVelocity*
+(this.sweep.c.x-l.x)}};d.prototype.ResetMassData=function(){this.invI=this.I=this.invMass=this.mass=0;this.sweep.localCenter.SetZero();if(this.type!=d._staticBody&&this.type!=d._kinematicBody){for(var b=g.Make(0,0),l=this.fixtureList;l;l=l.next)if(0!=l.density){var a=l.GetMassData();this.mass+=a.mass;b.x+=a.center.x*a.mass;b.y+=a.center.y*a.mass;this.I+=a.I}0<this.mass?(this.invMass=1/this.mass,b.x*=this.invMass,b.y*=this.invMass):this.invMass=this.mass=1;0<this.I&&0==(this.flags&d.e_fixedRotationFlag)?
(this.I-=this.mass*(b.x*b.x+b.y*b.y),this.I*=this.inertiaScale,h.Assert(0<this.I),this.invI=1/this.I):this.invI=this.I=0;l=this.sweep.c.Copy();this.sweep.localCenter.SetV(b);this.sweep.c0.SetV(t.MulX(this.xf,this.sweep.localCenter));this.sweep.c.SetV(this.sweep.c0);this.linearVelocity.x+=this.angularVelocity*-(this.sweep.c.y-l.y);this.linearVelocity.y+=this.angularVelocity*+(this.sweep.c.x-l.x)}};d.prototype.GetWorldPoint=function(b){var a=this.xf.R;b=new g(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+
a.col2.y*b.y);b.x+=this.xf.position.x;b.y+=this.xf.position.y;return b};d.prototype.GetWorldVector=function(b){return t.MulMV(this.xf.R,b)};d.prototype.GetLocalPoint=function(b){return t.MulXT(this.xf,b)};d.prototype.GetLocalVector=function(b){return t.MulTMV(this.xf.R,b)};d.prototype.GetLinearVelocityFromWorldPoint=function(b){return new g(this.linearVelocity.x-this.angularVelocity*(b.y-this.sweep.c.y),this.linearVelocity.y+this.angularVelocity*(b.x-this.sweep.c.x))};d.prototype.GetLinearVelocityFromLocalPoint=
function(b){var a=this.xf.R;b=new g(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);b.x+=this.xf.position.x;b.y+=this.xf.position.y;return new g(this.linearVelocity.x-this.angularVelocity*(b.y-this.sweep.c.y),this.linearVelocity.y+this.angularVelocity*(b.x-this.sweep.c.x))};d.prototype.GetLinearDamping=function(){return this.linearDamping};d.prototype.SetLinearDamping=function(b){void 0===b&&(b=0);this.linearDamping=b};d.prototype.GetAngularDamping=function(){return this.angularDamping};d.prototype.SetAngularDamping=
function(b){void 0===b&&(b=0);this.angularDamping=b};d.prototype.SetType=function(b){void 0===b&&(b=0);if(this.type!=b)for(this.type=b,this.ResetMassData(),this.type==d._staticBody&&(this.linearVelocity.SetZero(),this.angularVelocity=0),this.SetAwake(!0),this.force.SetZero(),this.torque=0,b=this.contactList;b;b=b.next)b.contact.FlagForFiltering()};d.prototype.GetType=function(){return this.type};d.prototype.SetBullet=function(b){this.flags=b?this.flags|d.e_bulletFlag:this.flags&~d.e_bulletFlag};d.prototype.IsBullet=
function(){return(this.flags&d.e_bulletFlag)==d.e_bulletFlag};d.prototype.SetSleepingAllowed=function(b){b?this.flags|=d.e_allowSleepFlag:(this.flags&=~d.e_allowSleepFlag,this.SetAwake(!0))};d.prototype.SetAwake=function(b){b?(this.flags|=d.e_awakeFlag,this.sleepTime=0):(this.flags&=~d.e_awakeFlag,this.sleepTime=0,this.linearVelocity.SetZero(),this.angularVelocity=0,this.force.SetZero(),this.torque=0)};d.prototype.IsAwake=function(){return(this.flags&d.e_awakeFlag)==d.e_awakeFlag};d.prototype.SetFixedRotation=
function(b){this.flags=b?this.flags|d.e_fixedRotationFlag:this.flags&~d.e_fixedRotationFlag;this.ResetMassData()};d.prototype.IsFixedRotation=function(){return(this.flags&d.e_fixedRotationFlag)==d.e_fixedRotationFlag};d.prototype.SetActive=function(b){if(b!=this.IsActive()){var a;if(b)for(this.flags|=d.e_activeFlag,b=this.world.contactManager.broadPhase,a=this.fixtureList;a;a=a.next)a.CreateProxy(b,this.xf);else{this.flags&=~d.e_activeFlag;b=this.world.contactManager.broadPhase;for(a=this.fixtureList;a;a=
a.next)a.DestroyProxy(b);for(b=this.contactList;b;)a=b,b=b.next,this.world.contactManager.Destroy(a.contact);this.contactList=null}}};d.prototype.IsActive=function(){return(this.flags&d.e_activeFlag)==d.e_activeFlag};d.prototype.IsSleepingAllowed=function(){return(this.flags&d.e_allowSleepFlag)==d.e_allowSleepFlag};d.prototype.GetFixtureList=function(){return this.fixtureList};d.prototype.GetJointList=function(){return this.jointList};d.prototype.GetControllerList=function(){return this.controllerList};
d.prototype.GetContactList=function(){return this.contactList};d.prototype.GetNext=function(){return this.next};d.prototype.GetUserData=function(){return this.userData};d.prototype.SetUserData=function(b){this.userData=b};d.prototype.GetWorld=function(){return this.world};d.prototype.Body=function(b,a){this.flags=0;b.bullet&&(this.flags|=d.e_bulletFlag);b.fixedRotation&&(this.flags|=d.e_fixedRotationFlag);b.allowSleep&&(this.flags|=d.e_allowSleepFlag);b.awake&&(this.flags|=d.e_awakeFlag);b.active&&
(this.flags|=d.e_activeFlag);this.world=a;this.xf.position.SetV(b.position);this.xf.R.Set(b.angle);this.sweep.localCenter.SetZero();this.sweep.t0=1;this.sweep.a0=this.sweep.a=b.angle;var f=this.xf.R,m=this.sweep.localCenter;this.sweep.c.x=f.col1.x*m.x+f.col2.x*m.y;this.sweep.c.y=f.col1.y*m.x+f.col2.y*m.y;this.sweep.c.x+=this.xf.position.x;this.sweep.c.y+=this.xf.position.y;this.sweep.c0.SetV(this.sweep.c);this.contactList=this.controllerList=this.jointList=null;this.controllerCount=0;this.next=this.prev=
null;this.linearVelocity.SetV(b.linearVelocity);this.angularVelocity=b.angularVelocity;this.linearDamping=b.linearDamping;this.angularDamping=b.angularDamping;this.force.Set(0,0);this.sleepTime=this.torque=0;this.type=b.type;this.invMass=this.type==d._dynamicBody?this.mass=1:this.mass=0;this.invI=this.I=0;this.inertiaScale=b.inertiaScale;this.userData=b.userData;this.fixtureList=null;this.fixtureCount=0};d.prototype.SynchronizeFixtures=function(){var b=d.s_xf1;b.R.Set(this.sweep.a0);var a=b.R,f=this.sweep.localCenter;
b.position.x=this.sweep.c0.x-(a.col1.x*f.x+a.col2.x*f.y);b.position.y=this.sweep.c0.y-(a.col1.y*f.x+a.col2.y*f.y);f=this.world.contactManager.broadPhase;for(a=this.fixtureList;a;a=a.next)a.Synchronize(f,b,this.xf)};d.prototype.SynchronizeTransform=function(){this.xf.R.Set(this.sweep.a);var b=this.xf.R,a=this.sweep.localCenter;this.xf.position.x=this.sweep.c.x-(b.col1.x*a.x+b.col2.x*a.y);this.xf.position.y=this.sweep.c.y-(b.col1.y*a.x+b.col2.y*a.y)};d.prototype.ShouldCollide=function(b){if(this.type!=
d._dynamicBody&&b.type!=d._dynamicBody)return!1;for(var a=this.jointList;a;a=a.next)if(a.other==b&&0==a.joint.collideConnected)return!1;return!0};d.prototype.Advance=function(b){void 0===b&&(b=0);this.sweep.Advance(b);this.sweep.c.SetV(this.sweep.c0);this.sweep.a=this.sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.Body.s_xf1=new w;Box2D.Dynamics.Body.e_islandFlag=1;Box2D.Dynamics.Body.e_awakeFlag=2;Box2D.Dynamics.Body.e_allowSleepFlag=4;Box2D.Dynamics.Body.e_bulletFlag=
8;Box2D.Dynamics.Body.e_fixedRotationFlag=16;Box2D.Dynamics.Body.e_activeFlag=32;Box2D.Dynamics.Body._staticBody=0;Box2D.Dynamics.Body._kinematicBody=1;Box2D.Dynamics.Body._dynamicBody=2});E.BodyDef=function(){this.position=new g;this.linearVelocity=new g};E.prototype.BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=
d._staticBody;this.active=!0;this.inertiaScale=1};q.ContactFilter=function(){};q.prototype.ShouldCollide=function(b,a){var f=b.GetFilterData(),m=a.GetFilterData();return f.groupIndex==m.groupIndex&&0!=f.groupIndex?0<f.groupIndex:0!=(f.maskBits&m.categoryBits)&&0!=(f.categoryBits&m.maskBits)};q.prototype.RayCollide=function(b,a){return b?this.ShouldCollide(b instanceof I?b:null,a):!0};Box2D.postDefs.push(function(){Box2D.Dynamics.ContactFilter._defaultFilter=new q});G.ContactImpulse=function(){this.normalImpulses=
new Vector_a2j_Number(h._maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(h._maxManifoldPoints)};H.ContactListener=function(){};H.prototype.BeginContact=function(b){};H.prototype.EndContact=function(b){};H.prototype.PreSolve=function(b,a){};H.prototype.PostSolve=function(b,a){};Box2D.postDefs.push(function(){Box2D.Dynamics.ContactListener._defaultListener=new H});K.ContactManager=function(){};K.prototype.ContactManager=function(){this.world=null;this.contactCount=0;this.contactFilter=
q._defaultFilter;this.contactListener=H._defaultListener;this.contactFactory=new m(this.allocator);this.broadPhase=new v};K.prototype.AddPair=function(b,a){var f=b instanceof I?b:null,m=a instanceof I?a:null,k=f.GetBody(),d=m.GetBody();if(k!=d){for(var c=d.GetContactList();c;){if(c.other==k){var u=c.contact.GetFixtureA(),e=c.contact.GetFixtureB();if(u==f&&e==m||u==m&&e==f)return}c=c.next}0!=d.ShouldCollide(k)&&0!=this.contactFilter.ShouldCollide(f,m)&&(c=this.contactFactory.Create(f,m),f=c.GetFixtureA(),
m=c.GetFixtureB(),k=f.body,d=m.body,c.prev=null,c.next=this.world.contactList,null!=this.world.contactList&&(this.world.contactList.prev=c),this.world.contactList=c,c.nodeA.contact=c,c.nodeA.other=d,c.nodeA.prev=null,c.nodeA.next=k.contactList,null!=k.contactList&&(k.contactList.prev=c.nodeA),k.contactList=c.nodeA,c.nodeB.contact=c,c.nodeB.other=k,c.nodeB.prev=null,c.nodeB.next=d.contactList,null!=d.contactList&&(d.contactList.prev=c.nodeB),d.contactList=c.nodeB,++this.world.contactCount)}};K.prototype.FindNewContacts=
function(){this.broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};K.prototype.Destroy=function(b){var a=b.GetFixtureA(),f=b.GetFixtureB(),a=a.GetBody(),f=f.GetBody();b.IsTouching()&&this.contactListener.EndContact(b);b.prev&&(b.prev.next=b.next);b.next&&(b.next.prev=b.prev);b==this.world.contactList&&(this.world.contactList=b.next);b.nodeA.prev&&(b.nodeA.prev.next=b.nodeA.next);b.nodeA.next&&(b.nodeA.next.prev=b.nodeA.prev);b.nodeA==a.contactList&&(a.contactList=b.nodeA.next);b.nodeB.prev&&
(b.nodeB.prev.next=b.nodeB.next);b.nodeB.next&&(b.nodeB.next.prev=b.nodeB.prev);b.nodeB==f.contactList&&(f.contactList=b.nodeB.next);this.contactFactory.Destroy(b);--this.contactCount};K.prototype.Collide=function(){for(var b=this.world.contactList;b;){var a=b.GetFixtureA(),f=b.GetFixtureB(),m=a.GetBody(),k=f.GetBody();if(0==m.IsAwake()&&0==k.IsAwake())b=b.GetNext();else{if(b.flags&u.e_filterFlag){if(0==k.ShouldCollide(m)){a=b;b=a.GetNext();this.Destroy(a);continue}if(0==this.contactFilter.ShouldCollide(a,
f)){a=b;b=a.GetNext();this.Destroy(a);continue}b.flags&=~u.e_filterFlag}0==this.broadPhase.TestOverlap(a.proxy,f.proxy)?(a=b,b=a.GetNext(),this.Destroy(a)):(b.Update(this.contactListener),b=b.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.ContactManager.s_evalCP=new c});y.DebugDraw=function(){};y.prototype.DebugDraw=function(){};y.prototype.SetFlags=function(b){};y.prototype.GetFlags=function(){};y.prototype.AppendFlags=function(b){};y.prototype.ClearFlags=function(b){};y.prototype.SetSprite=
function(b){};y.prototype.GetSprite=function(){};y.prototype.SetDrawScale=function(b){};y.prototype.GetDrawScale=function(){};y.prototype.SetLineThickness=function(b){};y.prototype.GetLineThickness=function(){};y.prototype.SetAlpha=function(b){};y.prototype.GetAlpha=function(){};y.prototype.SetFillAlpha=function(b){};y.prototype.GetFillAlpha=function(){};y.prototype.SetXFormScale=function(b){};y.prototype.GetXFormScale=function(){};y.prototype.DrawPolygon=function(b,a,f){};y.prototype.DrawSolidPolygon=
function(b,a,f){};y.prototype.DrawCircle=function(b,a,f){};y.prototype.DrawSolidCircle=function(b,a,f,m){};y.prototype.DrawSegment=function(b,a,f){};y.prototype.DrawTransform=function(b){};Box2D.postDefs.push(function(){Box2D.Dynamics.DebugDraw.e_shapeBit=1;Box2D.Dynamics.DebugDraw.e_jointBit=2;Box2D.Dynamics.DebugDraw.e_aabbBit=4;Box2D.Dynamics.DebugDraw.e_pairBit=8;Box2D.Dynamics.DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.DebugDraw.e_controllerBit=32});O.DestructionListener=function(){};O.prototype.SayGoodbyeJoint=
function(b){};O.prototype.SayGoodbyeFixture=function(b){};F.FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};F.prototype.Copy=function(){var b=new F;b.categoryBits=this.categoryBits;b.maskBits=this.maskBits;b.groupIndex=this.groupIndex;return b};I.Fixture=function(){this.filter=new F};I.prototype.GetType=function(){return this.shape.GetType()};I.prototype.GetShape=function(){return this.shape};I.prototype.SetSensor=function(b){if(this.isSensor!=b&&(this.isSensor=b,
null!=this.body))for(b=this.body.GetContactList();b;){var a=b.contact,f=a.GetFixtureA(),m=a.GetFixtureB();f!=this&&m!=this||a.SetSensor(f.IsSensor()||m.IsSensor());b=b.next}};I.prototype.IsSensor=function(){return this.isSensor};I.prototype.SetFilterData=function(b){this.filter=b.Copy();if(!this.body)for(b=this.body.GetContactList();b;){var a=b.contact,f=a.GetFixtureA(),m=a.GetFixtureB();f!=this&&m!=this||a.FlagForFiltering();b=b.next}};I.prototype.GetFilterData=function(){return this.filter.Copy()};
I.prototype.GetBody=function(){return this.body};I.prototype.GetNext=function(){return this.next};I.prototype.GetUserData=function(){return this.userData};I.prototype.SetUserData=function(b){this.userData=b};I.prototype.TestPoint=function(b){return this.shape.TestPoint(this.body.GetTransform(),b)};I.prototype.RayCast=function(b,a){return this.shape.RayCast(b,a,this.body.GetTransform())};I.prototype.GetMassData=function(b){void 0===b&&(b=null);null==b&&(b=new x);this.shape.ComputeMass(b,this.density);
return b};I.prototype.SetDensity=function(b){void 0===b&&(b=0);this.density=b};I.prototype.GetDensity=function(){return this.density};I.prototype.GetFriction=function(){return this.friction};I.prototype.SetFriction=function(b){void 0===b&&(b=0);this.friction=b};I.prototype.GetRestitution=function(){return this.restitution};I.prototype.SetRestitution=function(b){void 0===b&&(b=0);this.restitution=b};I.prototype.GetAABB=function(){return this.aabb};I.prototype.Fixture=function(){this.aabb=new A;this.shape=
this.next=this.body=this.userData=null;this.restitution=this.friction=this.density=0};I.prototype.Create=function(b,a,f){this.userData=f.userData;this.friction=f.friction;this.restitution=f.restitution;this.body=b;this.next=null;this.filter=f.filter.Copy();this.isSensor=f.isSensor;this.shape=f.shape.Copy();this.density=f.density};I.prototype.Destroy=function(){this.shape=null};I.prototype.CreateProxy=function(b,a){this.shape.ComputeAABB(this.aabb,a);this.proxy=b.CreateProxy(this.aabb,this)};I.prototype.DestroyProxy=
function(b){null!=this.proxy&&(b.DestroyProxy(this.proxy),this.proxy=null)};I.prototype.Synchronize=function(b,a,f){if(this.proxy){var m=new A,k=new A;this.shape.ComputeAABB(m,a);this.shape.ComputeAABB(k,f);this.aabb.Combine(m,k);a=t.SubtractVV(f.position,a.position);b.MoveProxy(this.proxy,this.aabb,a)}};P.FixtureDef=function(){this.filter=new F};P.prototype.FixtureDef=function(){this.userData=this.shape=null;this.friction=.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=
65535;this.filter.groupIndex=0;this.isSensor=!1};L.Island=function(){};L.prototype.Island=function(){this.bodies=new Vector;this.contacts=new Vector;this.joints=new Vector};L.prototype.Initialize=function(b,a,f,m,k,d){void 0===b&&(b=0);void 0===a&&(a=0);void 0===f&&(f=0);this.bodyCapacity=b;this.contactCapacity=a;this.jointCapacity=f;this.jointCount=this.contactCount=this.bodyCount=0;this.allocator=m;this.listener=k;this.contactSolver=d;for(m=this.bodies.length;m<b;m++)this.bodies[m]=null;for(m=this.contacts.length;m<
a;m++)this.contacts[m]=null;for(m=this.joints.length;m<f;m++)this.joints[m]=null};L.prototype.Clear=function(){this.jointCount=this.contactCount=this.bodyCount=0};L.prototype.Solve=function(b,a,f){var m,k,c;for(m=0;m<this.bodyCount;++m)k=this.bodies[m],k.GetType()==d._dynamicBody&&(k.linearVelocity.x+=b.dt*(a.x+k.invMass*k.force.x),k.linearVelocity.y+=b.dt*(a.y+k.invMass*k.force.y),k.angularVelocity+=b.dt*k.invI*k.torque,k.linearVelocity.Multiply(t.Clamp(1-b.dt*k.linearDamping,0,1)),k.angularVelocity*=
t.Clamp(1-b.dt*k.angularDamping,0,1));this.contactSolver.Initialize(b,this.contacts,this.contactCount,this.allocator);a=this.contactSolver;a.InitVelocityConstraints(b);for(m=0;m<this.jointCount;++m)c=this.joints[m],c.InitVelocityConstraints(b);for(m=0;m<b.velocityIterations;++m){for(k=0;k<this.jointCount;++k)c=this.joints[k],c.SolveVelocityConstraints(b);a.SolveVelocityConstraints()}for(m=0;m<this.jointCount;++m)c=this.joints[m],c.FinalizeVelocityConstraints();a.FinalizeVelocityConstraints();for(m=
0;m<this.bodyCount;++m)if(k=this.bodies[m],k.GetType()!=d._staticBody){var u=b.dt*k.linearVelocity.x,e=b.dt*k.linearVelocity.y;u*u+e*e>h._maxTranslationSquared&&(k.linearVelocity.Normalize(),k.linearVelocity.x=k.linearVelocity.x*h._maxTranslation*b.inv_dt,k.linearVelocity.y=k.linearVelocity.y*h._maxTranslation*b.inv_dt);u=b.dt*k.angularVelocity;u*u>h._maxRotationSquared&&(k.angularVelocity=0>k.angularVelocity?-h._maxRotation*b.inv_dt:h._maxRotation*b.inv_dt);k.sweep.c0.SetV(k.sweep.c);k.sweep.a0=
k.sweep.a;k.sweep.c.x+=b.dt*k.linearVelocity.x;k.sweep.c.y+=b.dt*k.linearVelocity.y;k.sweep.a+=b.dt*k.angularVelocity;k.SynchronizeTransform()}for(m=0;m<b.positionIterations;++m){u=a.SolvePositionConstraints(h._contactBaumgarte);e=!0;for(k=0;k<this.jointCount;++k)c=this.joints[k],c=c.SolvePositionConstraints(h._contactBaumgarte),e=e&&c;if(u&&e)break}this.Report(a.constraints);if(f){f=Number.MAX_VALUE;a=h._linearSleepTolerance*h._linearSleepTolerance;u=h._angularSleepTolerance*h._angularSleepTolerance;
for(m=0;m<this.bodyCount;++m)k=this.bodies[m],k.GetType()!=d._staticBody&&(0==(k.flags&d.e_allowSleepFlag)&&(f=k.sleepTime=0),0==(k.flags&d.e_allowSleepFlag)||k.angularVelocity*k.angularVelocity>u||t.Dot(k.linearVelocity,k.linearVelocity)>a?f=k.sleepTime=0:(k.sleepTime+=b.dt,f=t.Min(f,k.sleepTime)));if(f>=h._timeToSleep)for(m=0;m<this.bodyCount;++m)k=this.bodies[m],k.SetAwake(!1)}};L.prototype.SolveTOI=function(b){var a,f;this.contactSolver.Initialize(b,this.contacts,this.contactCount,this.allocator);
var m=this.contactSolver;for(a=0;a<this.jointCount;++a)this.joints[a].InitVelocityConstraints(b);for(a=0;a<b.velocityIterations;++a)for(m.SolveVelocityConstraints(),f=0;f<this.jointCount;++f)this.joints[f].SolveVelocityConstraints(b);for(a=0;a<this.bodyCount;++a)if(f=this.bodies[a],f.GetType()!=d._staticBody){var k=b.dt*f.linearVelocity.x,c=b.dt*f.linearVelocity.y;k*k+c*c>h._maxTranslationSquared&&(f.linearVelocity.Normalize(),f.linearVelocity.x=f.linearVelocity.x*h._maxTranslation*b.inv_dt,f.linearVelocity.y=
f.linearVelocity.y*h._maxTranslation*b.inv_dt);k=b.dt*f.angularVelocity;k*k>h._maxRotationSquared&&(f.angularVelocity=0>f.angularVelocity?-h._maxRotation*b.inv_dt:h._maxRotation*b.inv_dt);f.sweep.c0.SetV(f.sweep.c);f.sweep.a0=f.sweep.a;f.sweep.c.x+=b.dt*f.linearVelocity.x;f.sweep.c.y+=b.dt*f.linearVelocity.y;f.sweep.a+=b.dt*f.angularVelocity;f.SynchronizeTransform()}for(a=0;a<b.positionIterations;++a){k=m.SolvePositionConstraints(.75);c=!0;for(f=0;f<this.jointCount;++f)var u=this.joints[f].SolvePositionConstraints(h._contactBaumgarte),
c=c&&u;if(k&&c)break}this.Report(m.constraints)};L.prototype.Report=function(b){if(null!=this.listener)for(var a=0;a<this.contactCount;++a){for(var f=this.contacts[a],m=b[a],k=0;k<m.pointCount;++k)L.s_impulse.normalImpulses[k]=m.points[k].normalImpulse,L.s_impulse.tangentImpulses[k]=m.points[k].tangentImpulse;this.listener.PostSolve(f,L.s_impulse)}};L.prototype.AddBody=function(b){b.islandIndex=this.bodyCount;this.bodies[this.bodyCount++]=b};L.prototype.AddContact=function(b){this.contacts[this.contactCount++]=
b};L.prototype.AddJoint=function(b){this.joints[this.jointCount++]=b};Box2D.postDefs.push(function(){Box2D.Dynamics.Island.s_impulse=new G});a.TimeStep=function(){};a.prototype.Set=function(b){this.dt=b.dt;this.inv_dt=b.inv_dt;this.positionIterations=b.positionIterations;this.velocityIterations=b.velocityIterations;this.warmStarting=b.warmStarting};f.World=function(){this.s_stack=new Vector;this.contactManager=new K;this.contactSolver=new k;this.island=new L};f.prototype.World=function(b,a){this.controllerList=
this.jointList=this.contactList=this.bodyList=this.debugDraw=this.destructionListener=null;this.controllerCount=this.jointCount=this.contactCount=this.bodyCount=0;f.warmStarting=!0;f.continuousPhysics=!0;this.allowSleep=a;this.gravity=b;this.inv_dt0=0;this.contactManager.world=this;var m=new E;this.groundBody=this.CreateBody(m)};f.prototype.SetDestructionListener=function(b){this.destructionListener=b};f.prototype.SetContactFilter=function(b){this.contactManager.contactFilter=b};f.prototype.SetContactListener=
function(b){this.contactManager.contactListener=b};f.prototype.SetDebugDraw=function(b){this.debugDraw=b};f.prototype.SetBroadPhase=function(b){var a=this.contactManager.broadPhase;this.contactManager.broadPhase=b;for(var f=this.bodyList;f;f=f.next)for(var m=f.fixtureList;m;m=m.next)m.proxy=b.CreateProxy(a.GetFatAABB(m.proxy),m)};f.prototype.Validate=function(){this.contactManager.broadPhase.Validate()};f.prototype.GetProxyCount=function(){return this.contactManager.broadPhase.GetProxyCount()};f.prototype.CreateBody=
function(b){if(1==this.IsLocked())return null;b=new d(b,this);b.prev=null;if(b.next=this.bodyList)this.bodyList.prev=b;this.bodyList=b;++this.bodyCount;return b};f.prototype.DestroyBody=function(b){if(1!=this.IsLocked()){for(var a=b.jointList;a;){var f=a,a=a.next;this.destructionListener&&this.destructionListener.SayGoodbyeJoint(f.joint);this.DestroyJoint(f.joint)}for(a=b.controllerList;a;)f=a,a=a.nextController,f.controller.RemoveBody(b);for(a=b.contactList;a;)f=a,a=a.next,this.contactManager.Destroy(f.contact);
b.contactList=null;for(a=b.fixtureList;a;)f=a,a=a.next,this.destructionListener&&this.destructionListener.SayGoodbyeFixture(f),f.DestroyProxy(this.contactManager.broadPhase),f.Destroy();b.fixtureList=null;b.fixtureCount=0;b.prev&&(b.prev.next=b.next);b.next&&(b.next.prev=b.prev);b==this.bodyList&&(this.bodyList=b.next);--this.bodyCount}};f.prototype.CreateJoint=function(b){var a=C.Create(b,null);a.prev=null;if(a.next=this.jointList)this.jointList.prev=a;this.jointList=a;++this.jointCount;a.edgeA.joint=
a;a.edgeA.other=a.bodyB;a.edgeA.prev=null;if(a.edgeA.next=a.bodyA.jointList)a.bodyA.jointList.prev=a.edgeA;a.bodyA.jointList=a.edgeA;a.edgeB.joint=a;a.edgeB.other=a.bodyA;a.edgeB.prev=null;if(a.edgeB.next=a.bodyB.jointList)a.bodyB.jointList.prev=a.edgeB;a.bodyB.jointList=a.edgeB;var f=b.bodyA,m=b.bodyB;if(0==b.collideConnected)for(b=m.GetContactList();b;)b.other==f&&b.contact.FlagForFiltering(),b=b.next;return a};f.prototype.DestroyJoint=function(b){var a=b.collideConnected;b.prev&&(b.prev.next=b.next);
b.next&&(b.next.prev=b.prev);b==this.jointList&&(this.jointList=b.next);var f=b.bodyA,m=b.bodyB;f.SetAwake(!0);m.SetAwake(!0);b.edgeA.prev&&(b.edgeA.prev.next=b.edgeA.next);b.edgeA.next&&(b.edgeA.next.prev=b.edgeA.prev);b.edgeA==f.jointList&&(f.jointList=b.edgeA.next);b.edgeA.prev=null;b.edgeA.next=null;b.edgeB.prev&&(b.edgeB.prev.next=b.edgeB.next);b.edgeB.next&&(b.edgeB.next.prev=b.edgeB.prev);b.edgeB==m.jointList&&(m.jointList=b.edgeB.next);b.edgeB.prev=null;b.edgeB.next=null;C.Destroy(b,null);
--this.jointCount;if(0==a)for(b=m.GetContactList();b;)b.other==f&&b.contact.FlagForFiltering(),b=b.next};f.prototype.AddController=function(b){b.next=this.controllerList;b.prev=null;this.controllerList=b;b.world=this;this.controllerCount++;return b};f.prototype.RemoveController=function(b){b.prev&&(b.prev.next=b.next);b.next&&(b.next.prev=b.prev);this.controllerList==b&&(this.controllerList=b.next);this.controllerCount--};f.prototype.CreateController=function(b){if(b.world!=this)throw Error("Controller can only be a member of one world");
b.next=this.controllerList;b.prev=null;this.controllerList&&(this.controllerList.prev=b);this.controllerList=b;++this.controllerCount;b.world=this;return b};f.prototype.DestroyController=function(b){b.Clear();b.next&&(b.next.prev=b.prev);b.prev&&(b.prev.next=b.next);b==this.controllerList&&(this.controllerList=b.next);--this.controllerCount};f.prototype.SetWarmStarting=function(b){f.warmStarting=b};f.prototype.SetContinuousPhysics=function(b){f.continuousPhysics=b};f.prototype.GetBodyCount=function(){return this.bodyCount};
f.prototype.GetJointCount=function(){return this.jointCount};f.prototype.GetContactCount=function(){return this.contactCount};f.prototype.SetGravity=function(b){this.gravity=b};f.prototype.GetGravity=function(){return this.gravity};f.prototype.GetGroundBody=function(){return this.groundBody};f.prototype.Step=function(b,a,m){void 0===b&&(b=0);void 0===a&&(a=0);void 0===m&&(m=0);this.flags&f.e_newFixture&&(this.contactManager.FindNewContacts(),this.flags&=~f.e_newFixture);this.flags|=f.e_locked;var k=
f.s_timestep2;k.dt=b;k.velocityIterations=a;k.positionIterations=m;k.inv_dt=0<b?1/b:0;k.dtRatio=this.inv_dt0*b;k.warmStarting=f.warmStarting;this.contactManager.Collide();0<k.dt&&this.Solve(k);f.continuousPhysics&&0<k.dt&&this.SolveTOI(k);0<k.dt&&(this.inv_dt0=k.inv_dt);this.flags&=~f.e_locked};f.prototype.ClearForces=function(){for(var b=this.bodyList;b;b=b.next)b.force.SetZero(),b.torque=0};f.prototype.DrawDebugData=function(){if(null!=this.debugDraw){this.debugDraw.sprite.graphics.clear();var b=
this.debugDraw.GetFlags(),a,m,k;new g;new g;new g;var c;new A;new A;new g;new g;new g;new g;var u=new e(0,0,0);if(b&y.e_shapeBit)for(a=this.bodyList;a;a=a.next)for(c=a.xf,m=a.GetFixtureList();m;m=m.next)k=m.GetShape(),0==a.IsActive()?u.Set(.5,.5,.3):a.GetType()==d._staticBody?u.Set(.5,.9,.5):a.GetType()==d._kinematicBody?u.Set(.5,.5,.9):0==a.IsAwake()?u.Set(.6,.6,.6):u.Set(.9,.7,.7),this.DrawShape(k,c,u);if(b&y.e_jointBit)for(a=this.jointList;a;a=a.next)this.DrawJoint(a);if(b&y.e_controllerBit)for(a=
this.controllerList;a;a=a.next)a.Draw(this.debugDraw);if(b&y.e_pairBit)for(u.Set(.3,.9,.9),a=this.contactManager.contactList;a;a=a.GetNext())k=a.GetFixtureA(),m=a.GetFixtureB(),k=k.GetAABB().GetCenter(),m=m.GetAABB().GetCenter(),this.debugDraw.DrawSegment(k,m,u);if(b&y.e_aabbBit)for(k=this.contactManager.broadPhase,c=[new g,new g,new g,new g],a=this.bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(m=a.GetFixtureList();m;m=m.GetNext()){var r=k.GetFatAABB(m.proxy);c[0].Set(r.lowerBound.x,r.lowerBound.y);
c[1].Set(r.upperBound.x,r.lowerBound.y);c[2].Set(r.upperBound.x,r.upperBound.y);c[3].Set(r.lowerBound.x,r.upperBound.y);this.debugDraw.DrawPolygon(c,4,u)}if(b&y.e_centerOfMassBit)for(a=this.bodyList;a;a=a.next)c=f.s_xf,c.R=a.xf.R,c.position=a.GetWorldCenter(),this.debugDraw.DrawTransform(c)}};f.prototype.QueryAABB=function(b,a){var f=this.contactManager.broadPhase;f.Query(function(a){return b(f.GetUserData(a))},a)};f.prototype.QueryShape=function(b,a,f){void 0===f&&(f=null);null==f&&(f=new w,f.SetIdentity());
var m=this.contactManager.broadPhase,k=new A;a.ComputeAABB(k,f);m.Query(function(k){k=m.GetUserData(k)instanceof I?m.GetUserData(k):null;return N.TestOverlap(a,f,k.GetShape(),k.GetBody().GetTransform())?b(k):!0},k)};f.prototype.QueryPoint=function(b,a){var f=this.contactManager.broadPhase,m=new A;m.lowerBound.Set(a.x-h._linearSlop,a.y-h._linearSlop);m.upperBound.Set(a.x+h._linearSlop,a.y+h._linearSlop);f.Query(function(m){m=f.GetUserData(m)instanceof I?f.GetUserData(m):null;return m.TestPoint(a)?
b(m):!0},m)};f.prototype.RayCast=function(b,a,f){var m=this.contactManager.broadPhase,k=new D,c=new J(a,f);m.RayCast(function(c,d){var u=m.GetUserData(d),u=u instanceof I?u:null;if(u.RayCast(k,c)){var e=k.fraction,r=new g((1-e)*a.x+e*f.x,(1-e)*a.y+e*f.y);return b(u,r,k.normal,e)}return c.maxFraction},c)};f.prototype.RayCastOne=function(b,a){var f;this.RayCast(function(b,a,m,k){void 0===k&&(k=0);f=b;return k},b,a);return f};f.prototype.RayCastAll=function(b,a){var f=new Vector;this.RayCast(function(b,
a,m,k){f[f.length]=b;return 1},b,a);return f};f.prototype.GetBodyList=function(){return this.bodyList};f.prototype.GetJointList=function(){return this.jointList};f.prototype.GetContactList=function(){return this.contactList};f.prototype.IsLocked=function(){return 0<(this.flags&f.e_locked)};f.prototype.Solve=function(b){for(var a,f=this.controllerList;f;f=f.next)f.Step(b);f=this.island;f.Initialize(this.bodyCount,this.contactCount,this.jointCount,null,this.contactManager.contactListener,this.contactSolver);
for(a=this.bodyList;a;a=a.next)a.flags&=~d.e_islandFlag;for(var m=this.contactList;m;m=m.next)m.flags&=~u.e_islandFlag;for(m=this.jointList;m;m=m.next)m.islandFlag=!1;parseInt(this.bodyCount);for(var m=this.s_stack,k=this.bodyList;k;k=k.next)if(!(k.flags&d.e_islandFlag)&&0!=k.IsAwake()&&0!=k.IsActive()&&k.GetType()!=d._staticBody){f.Clear();var c=0;m[c++]=k;for(k.flags|=d.e_islandFlag;0<c;)if(a=m[--c],f.AddBody(a),0==a.IsAwake()&&a.SetAwake(!0),a.GetType()!=d._staticBody){for(var e,r=a.contactList;r;r=
r.next)r.contact.flags&u.e_islandFlag||1==r.contact.IsSensor()||0==r.contact.IsEnabled()||0==r.contact.IsTouching()||(f.AddContact(r.contact),r.contact.flags|=u.e_islandFlag,e=r.other,e.flags&d.e_islandFlag||(m[c++]=e,e.flags|=d.e_islandFlag));for(a=a.jointList;a;a=a.next)1!=a.joint.islandFlag&&(e=a.other,0!=e.IsActive()&&(f.AddJoint(a.joint),a.joint.islandFlag=!0,e.flags&d.e_islandFlag||(m[c++]=e,e.flags|=d.e_islandFlag)))}f.Solve(b,this.gravity,this.allowSleep);for(c=0;c<f.bodyCount;++c)a=f.bodies[c],
a.GetType()==d._staticBody&&(a.flags&=~d.e_islandFlag)}for(c=0;c<m.length&&m[c];++c)m[c]=null;for(a=this.bodyList;a;a=a.next)0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=d._staticBody&&a.SynchronizeFixtures();this.contactManager.FindNewContacts()};f.prototype.SolveTOI=function(b){var a,m,k,c=this.island;c.Initialize(this.bodyCount,h._maxTOIContactsPerIsland,h._maxTOIJointsPerIsland,null,this.contactManager.contactListener,this.contactSolver);var e=f.s_queue;for(a=this.bodyList;a;a=a.next)a.flags&=
~d.e_islandFlag,a.sweep.t0=0;for(k=this.contactList;k;k=k.next)k.flags&=~(u.e_toiFlag|u.e_islandFlag);for(k=this.jointList;k;k=k.next)k.islandFlag=!1;for(;;){var r=null,g=1;for(k=this.contactList;k;k=k.next)if(1!=k.IsSensor()&&0!=k.IsEnabled()&&0!=k.IsContinuous()){if(k.flags&u.e_toiFlag)a=k.toi;else{a=k.fixtureA;m=k.fixtureB;a=a.body;m=m.body;if(!(a.GetType()==d._dynamicBody&&0!=a.IsAwake()||m.GetType()==d._dynamicBody&&0!=m.IsAwake()))continue;var C=a.sweep.t0;a.sweep.t0<m.sweep.t0?(C=m.sweep.t0,
a.sweep.Advance(C)):m.sweep.t0<a.sweep.t0&&(C=a.sweep.t0,m.sweep.Advance(C));a=k.ComputeTOI(a.sweep,m.sweep);h.Assert(0<=a&&1>=a);0<a&&1>a&&(a=(1-a)*C+a,1<a&&(a=1));k.toi=a;k.flags|=u.e_toiFlag}Number.MIN_VALUE<a&&a<g&&(r=k,g=a)}if(null==r||1-100*Number.MIN_VALUE<g)break;a=r.fixtureA;m=r.fixtureB;a=a.body;m=m.body;f.s_backupA.Set(a.sweep);f.s_backupB.Set(m.sweep);a.Advance(g);m.Advance(g);r.Update(this.contactManager.contactListener);r.flags&=~u.e_toiFlag;if(1==r.IsSensor()||0==r.IsEnabled())a.sweep.Set(f.s_backupA),
m.sweep.Set(f.s_backupB),a.SynchronizeTransform(),m.SynchronizeTransform();else if(0!=r.IsTouching()){a.GetType()!=d._dynamicBody&&(a=m);c.Clear();r=k=0;e[k+r++]=a;for(a.flags|=d.e_islandFlag;0<r;)if(a=e[k++],--r,c.AddBody(a),0==a.IsAwake()&&a.SetAwake(!0),a.GetType()==d._dynamicBody){for(m=a.contactList;m&&c.contactCount!=c.contactCapacity;m=m.next)m.contact.flags&u.e_islandFlag||1==m.contact.IsSensor()||0==m.contact.IsEnabled()||0==m.contact.IsTouching()||(c.AddContact(m.contact),m.contact.flags|=
u.e_islandFlag,C=m.other,C.flags&d.e_islandFlag||(C.GetType()!=d._staticBody&&(C.Advance(g),C.SetAwake(!0)),e[k+r]=C,++r,C.flags|=d.e_islandFlag));for(a=a.jointList;a;a=a.next)c.jointCount!=c.jointCapacity&&1!=a.joint.islandFlag&&(C=a.other,0!=C.IsActive()&&(c.AddJoint(a.joint),a.joint.islandFlag=!0,C.flags&d.e_islandFlag||(C.GetType()!=d._staticBody&&(C.Advance(g),C.SetAwake(!0)),e[k+r]=C,++r,C.flags|=d.e_islandFlag)))}k=f.s_timestep;k.warmStarting=!1;k.dt=(1-g)*b.dt;k.inv_dt=1/k.dt;k.dtRatio=0;
k.velocityIterations=b.velocityIterations;k.positionIterations=b.positionIterations;c.SolveTOI(k);for(g=0;g<c.bodyCount;++g)if(a=c.bodies[g],a.flags&=~d.e_islandFlag,0!=a.IsAwake()&&a.GetType()==d._dynamicBody)for(a.SynchronizeFixtures(),m=a.contactList;m;m=m.next)m.contact.flags&=~u.e_toiFlag;for(g=0;g<c.contactCount;++g)k=c.contacts[g],k.flags&=~(u.e_toiFlag|u.e_islandFlag);for(g=0;g<c.jointCount;++g)k=c.joints[g],k.islandFlag=!1;this.contactManager.FindNewContacts()}}};f.prototype.DrawJoint=function(b){var a=
b.GetBodyA(),m=b.GetBodyB(),k=a.xf.position,c=m.xf.position,d=b.GetAnchorA(),u=b.GetAnchorB(),e=f.s_jointColor;switch(b.type){case C.e_distanceJoint:this.debugDraw.DrawSegment(d,u,e);break;case C.e_pulleyJoint:a=b instanceof r?b:null;b=a.GetGroundAnchorA();a=a.GetGroundAnchorB();this.debugDraw.DrawSegment(b,d,e);this.debugDraw.DrawSegment(a,u,e);this.debugDraw.DrawSegment(b,a,e);break;case C.e_mouseJoint:this.debugDraw.DrawSegment(d,u,e);break;default:a!=this.groundBody&&this.debugDraw.DrawSegment(k,
d,e),this.debugDraw.DrawSegment(d,u,e),m!=this.groundBody&&this.debugDraw.DrawSegment(c,u,e)}};f.prototype.DrawShape=function(b,a,f){switch(b.type){case N.e_circleShape:b=b instanceof z?b:null;var m=t.MulX(a,b.p);this.debugDraw.DrawSolidCircle(m,b.radius,a.R.col1,f);break;case N.e_polygonShape:m=b instanceof M?b:null;b=parseInt(m.GetVertexCount());for(var k=m.GetVertices(),c=new Vector(b),m=0;m<b;++m)c[m]=t.MulX(a,k[m]);this.debugDraw.DrawSolidPolygon(c,b,f);break;case N.e_edgeShape:b=b instanceof
B?b:null,this.debugDraw.DrawSegment(t.MulX(a,b.GetVertex1()),t.MulX(a,b.GetVertex2()),f)}};Box2D.postDefs.push(function(){Box2D.Dynamics.World.s_timestep2=new a;Box2D.Dynamics.World.s_xf=new w;Box2D.Dynamics.World.s_backupA=new n;Box2D.Dynamics.World.s_backupB=new n;Box2D.Dynamics.World.s_timestep=new a;Box2D.Dynamics.World.s_queue=new Vector;Box2D.Dynamics.World.s_jointColor=new e(.5,.8,.8);Box2D.Dynamics.World.e_newFixture=1;Box2D.Dynamics.World.e_locked=2})})();
(function(){var t=Box2D.Collision.Shapes.CircleShape,n=Box2D.Collision.Shapes.EdgeShape,w=Box2D.Collision.Shapes.PolygonShape,g=Box2D.Collision.Shapes.Shape,e=Box2D.Dynamics.Contacts.CircleContact,h=Box2D.Dynamics.Contacts.Contact,A=Box2D.Dynamics.Contacts.ContactConstraint,c=Box2D.Dynamics.Contacts.ContactConstraintPoint,v=Box2D.Dynamics.Contacts.ContactEdge,J=Box2D.Dynamics.Contacts.ContactFactory,D=Box2D.Dynamics.Contacts.ContactRegister,z=Box2D.Dynamics.Contacts.ContactResult,B=Box2D.Dynamics.Contacts.ContactSolver,
x=Box2D.Dynamics.Contacts.EdgeAndCircleContact,M=Box2D.Dynamics.Contacts.NullContact,N=Box2D.Dynamics.Contacts.PolyAndCircleContact,d=Box2D.Dynamics.Contacts.PolyAndEdgeContact,E=Box2D.Dynamics.Contacts.PolygonContact,q=Box2D.Dynamics.Contacts.PositionSolverManifold,G=Box2D.Dynamics.Body,H=Box2D.Dynamics.TimeStep,K=Box2D.Common.Settings,y=Box2D.Common.Math.Mat22,O=Box2D.Common.Math.Math,F=Box2D.Common.Math.Vec2,I=Box2D.Collision.Collision,P=Box2D.Collision.ContactID,L=Box2D.Collision.Manifold,a=Box2D.Collision.TimeOfImpact,
f=Box2D.Collision.TOIInput,u=Box2D.Collision.WorldManifold;Box2D.inherit(e,Box2D.Dynamics.Contacts.Contact);e.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;e.CircleContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};e.Create=function(a){return new e};e.Destroy=function(a,f){};e.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f)};e.prototype.Evaluate=function(){var a=this.fixtureA.GetBody(),f=this.fixtureB.GetBody();I.CollideCircles(this.manifold,
this.fixtureA.GetShape()instanceof t?this.fixtureA.GetShape():null,a.xf,this.fixtureB.GetShape()instanceof t?this.fixtureB.GetShape():null,f.xf)};h.Contact=function(){this.nodeA=new v;this.nodeB=new v;this.manifold=new L;this.oldManifold=new L};h.prototype.GetManifold=function(){return this.manifold};h.prototype.GetWorldManifold=function(a){var f=this.fixtureA.GetBody(),c=this.fixtureB.GetBody(),d=this.fixtureA.GetShape(),b=this.fixtureB.GetShape();a.Initialize(this.manifold,f.GetTransform(),d.radius,
c.GetTransform(),b.radius)};h.prototype.IsTouching=function(){return(this.flags&h.e_touchingFlag)==h.e_touchingFlag};h.prototype.IsContinuous=function(){return(this.flags&h.e_continuousFlag)==h.e_continuousFlag};h.prototype.SetSensor=function(a){this.flags=a?this.flags|h.e_sensorFlag:this.flags&~h.e_sensorFlag};h.prototype.IsSensor=function(){return(this.flags&h.e_sensorFlag)==h.e_sensorFlag};h.prototype.SetEnabled=function(a){this.flags=a?this.flags|h.e_enabledFlag:this.flags&~h.e_enabledFlag};h.prototype.IsEnabled=
function(){return(this.flags&h.e_enabledFlag)==h.e_enabledFlag};h.prototype.GetNext=function(){return this.next};h.prototype.GetFixtureA=function(){return this.fixtureA};h.prototype.GetFixtureB=function(){return this.fixtureB};h.prototype.FlagForFiltering=function(){this.flags|=h.e_filterFlag};h.prototype.Contact=function(){};h.prototype.Reset=function(a,f){void 0===a&&(a=null);void 0===f&&(f=null);this.flags=h.e_enabledFlag;if(a&&f){if(a.IsSensor()||f.IsSensor())this.flags|=h.e_sensorFlag;var c=
a.GetBody(),d=f.GetBody();if(c.GetType()!=G._dynamicBody||c.IsBullet()||d.GetType()!=G._dynamicBody||d.IsBullet())this.flags|=h.e_continuousFlag;this.fixtureA=a;this.fixtureB=f;this.manifold.pointCount=0;this.next=this.prev=null;this.nodeA.contact=null;this.nodeA.prev=null;this.nodeA.next=null;this.nodeA.other=null;this.nodeB.contact=null;this.nodeB.prev=null;this.nodeB.next=null;this.nodeB.other=null}else this.fixtureB=this.fixtureA=null};h.prototype.Update=function(a){var f=this.oldManifold;this.oldManifold=
this.manifold;this.manifold=f;this.flags|=h.e_enabledFlag;var c=!1,f=(this.flags&h.e_touchingFlag)==h.e_touchingFlag,d=this.fixtureA.body,b=this.fixtureB.body,l=this.fixtureA.aabb.TestOverlap(this.fixtureB.aabb);if(this.flags&h.e_sensorFlag)l&&(c=this.fixtureA.GetShape(),l=this.fixtureB.GetShape(),d=d.GetTransform(),b=b.GetTransform(),c=g.TestOverlap(c,d,l,b)),this.manifold.pointCount=0;else{d.GetType()!=G._dynamicBody||d.IsBullet()||b.GetType()!=G._dynamicBody||b.IsBullet()?this.flags|=h.e_continuousFlag:
this.flags&=~h.e_continuousFlag;if(l)for(this.Evaluate(),c=0<this.manifold.pointCount,l=0;l<this.manifold.pointCount;++l){var u=this.manifold.points[l];u.normalImpulse=0;u.tangentImpulse=0;for(var e=u.id,n=0;n<this.oldManifold.pointCount;++n){var t=this.oldManifold.points[n];if(t.id.key==e.key){u.normalImpulse=t.normalImpulse;u.tangentImpulse=t.tangentImpulse;break}}}else this.manifold.pointCount=0;c!=f&&(d.SetAwake(!0),b.SetAwake(!0))}this.flags=c?this.flags|h.e_touchingFlag:this.flags&~h.e_touchingFlag;
0==f&&1==c&&a.BeginContact(this);1==f&&0==c&&a.EndContact(this);0==(this.flags&h.e_sensorFlag)&&a.PreSolve(this,this.oldManifold)};h.prototype.Evaluate=function(){};h.prototype.ComputeTOI=function(f,k){h.s_input.proxyA.Set(this.fixtureA.GetShape());h.s_input.proxyB.Set(this.fixtureB.GetShape());h.s_input.sweepA=f;h.s_input.sweepB=k;h.s_input.tolerance=K._linearSlop;return a.TimeOfImpact(h.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.Contact.e_continuousFlag=
2;Box2D.Dynamics.Contacts.Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.Contact.s_input=new f});A.ContactConstraint=function(){this.localPlaneNormal=new F;this.localPoint=new F;this.normal=new F;this.normalMass=new y;this.K=new y};A.prototype.ContactConstraint=function(){this.points=new Vector(K._maxManifoldPoints);
for(var a=0;a<K._maxManifoldPoints;a++)this.points[a]=new c};c.ContactConstraintPoint=function(){this.localPoint=new F;this.rA=new F;this.rB=new F};v.ContactEdge=function(){};J.ContactFactory=function(){};J.prototype.ContactFactory=function(a){this.allocator=a;this.InitializeRegisters()};J.prototype.AddType=function(a,f,c,d){void 0===c&&(c=0);void 0===d&&(d=0);this.registers[c][d].createFcn=a;this.registers[c][d].destroyFcn=f;this.registers[c][d].primary=!0;c!=d&&(this.registers[d][c].createFcn=a,
this.registers[d][c].destroyFcn=f,this.registers[d][c].primary=!1)};J.prototype.InitializeRegisters=function(){this.registers=new Vector(g.e_shapeTypeCount);for(var a=0;a<g.e_shapeTypeCount;a++){this.registers[a]=new Vector(g.e_shapeTypeCount);for(var f=0;f<g.e_shapeTypeCount;f++)this.registers[a][f]=new D}this.AddType(e.Create,e.Destroy,g.e_circleShape,g.e_circleShape);this.AddType(N.Create,N.Destroy,g.e_polygonShape,g.e_circleShape);this.AddType(E.Create,E.Destroy,g.e_polygonShape,g.e_polygonShape);
this.AddType(x.Create,x.Destroy,g.e_edgeShape,g.e_circleShape);this.AddType(d.Create,d.Destroy,g.e_polygonShape,g.e_edgeShape)};J.prototype.Create=function(a,f){var c=parseInt(a.GetType()),d=parseInt(f.GetType()),c=this.registers[c][d];if(c.pool)return d=c.pool,c.pool=d.next,c.poolCount--,d.Reset(a,f),d;d=c.createFcn;return null!=d?(c.primary?(d=d(this.allocator),d.Reset(a,f)):(d=d(this.allocator),d.Reset(f,a)),d):null};J.prototype.Destroy=function(a){0<a.manifold.pointCount&&(a.fixtureA.body.SetAwake(!0),
a.fixtureB.body.SetAwake(!0));var f=parseInt(a.fixtureA.GetType()),c=parseInt(a.fixtureB.GetType()),f=this.registers[f][c];f.poolCount++;a.next=f.pool;f.pool=a;f=f.destroyFcn;f(a,this.allocator)};D.ContactRegister=function(){};z.ContactResult=function(){this.position=new F;this.normal=new F;this.id=new P};B.ContactSolver=function(){this.step=new H;this.constraints=new Vector};B.prototype.ContactSolver=function(){};B.prototype.Initialize=function(a,f,c,d){void 0===c&&(c=0);var b;this.step.Set(a);this.allocator=
d;for(this.constraintCount=c;this.constraints.length<this.constraintCount;)this.constraints[this.constraints.length]=new A;for(a=0;a<c;++a){b=f[a];d=b.fixtureA;var l=b.fixtureB,u=d.shape.radius,e=l.shape.radius,g=d.body,h=l.body,n=b.GetManifold(),t=K.MixFriction(d.GetFriction(),l.GetFriction()),q=K.MixRestitution(d.GetRestitution(),l.GetRestitution()),x=g.linearVelocity.x,w=g.linearVelocity.y,z=h.linearVelocity.x,v=h.linearVelocity.y,y=g.angularVelocity,E=h.angularVelocity;K.Assert(0<n.pointCount);
B.s_worldManifold.Initialize(n,g.xf,u,h.xf,e);l=B.s_worldManifold.normal.x;b=B.s_worldManifold.normal.y;d=this.constraints[a];d.bodyA=g;d.bodyB=h;d.manifold=n;d.normal.x=l;d.normal.y=b;d.pointCount=n.pointCount;d.friction=t;d.restitution=q;d.localPlaneNormal.x=n.localPlaneNormal.x;d.localPlaneNormal.y=n.localPlaneNormal.y;d.localPoint.x=n.localPoint.x;d.localPoint.y=n.localPoint.y;d.radius=u+e;d.type=n.type;for(u=0;u<d.pointCount;++u){t=n.points[u];e=d.points[u];e.normalImpulse=t.normalImpulse;e.tangentImpulse=
t.tangentImpulse;e.localPoint.SetV(t.localPoint);var t=e.rA.x=B.s_worldManifold.points[u].x-g.sweep.c.x,q=e.rA.y=B.s_worldManifold.points[u].y-g.sweep.c.y,G=e.rB.x=B.s_worldManifold.points[u].x-h.sweep.c.x,H=e.rB.y=B.s_worldManifold.points[u].y-h.sweep.c.y,F=t*b-q*l,D=G*b-H*l,F=F*F,D=D*D;e.normalMass=1/(g.invMass+h.invMass+g.invI*F+h.invI*D);var M=g.mass*g.invMass+h.mass*h.invMass,M=M+(g.mass*g.invI*F+h.mass*h.invI*D);e.equalizedMass=1/M;D=b;M=-l;F=t*M-q*D;D=G*M-H*D;F*=F;D*=D;e.tangentMass=1/(g.invMass+
h.invMass+g.invI*F+h.invI*D);e.velocityBias=0;t=d.normal.x*(z+-E*H-x- -y*q)+d.normal.y*(v+E*G-w-y*t);t<-K._velocityThreshold&&(e.velocityBias+=-d.restitution*t)}2==d.pointCount&&(v=d.points[0],z=d.points[1],n=g.invMass,g=g.invI,x=h.invMass,h=h.invI,w=v.rA.x*b-v.rA.y*l,v=v.rB.x*b-v.rB.y*l,y=z.rA.x*b-z.rA.y*l,z=z.rB.x*b-z.rB.y*l,l=n+x+g*w*w+h*v*v,b=n+x+g*y*y+h*z*z,h=n+x+g*w*y+h*v*z,l*l<100*(l*b-h*h)?(d.K.col1.Set(l,h),d.K.col2.Set(h,b),d.K.GetInverse(d.normalMass)):d.pointCount=1)}};B.prototype.InitVelocityConstraints=
function(a){for(var f=0;f<this.constraintCount;++f){var c=this.constraints[f],d=c.bodyA,b=c.bodyB,u=d.invMass,e=d.invI,g=b.invMass,h=b.invI,n=c.normal.x,t=c.normal.y,q=t,x=-n,w,B;if(a.warmStarting)for(B=c.pointCount,w=0;w<B;++w){var z=c.points[w];z.normalImpulse*=a.dtRatio;z.tangentImpulse*=a.dtRatio;var v=z.normalImpulse*n+z.tangentImpulse*q,y=z.normalImpulse*t+z.tangentImpulse*x;d.angularVelocity-=e*(z.rA.x*y-z.rA.y*v);d.linearVelocity.x-=u*v;d.linearVelocity.y-=u*y;b.angularVelocity+=h*(z.rB.x*
y-z.rB.y*v);b.linearVelocity.x+=g*v;b.linearVelocity.y+=g*y}else for(B=c.pointCount,w=0;w<B;++w)d=c.points[w],d.normalImpulse=0,d.tangentImpulse=0}};B.prototype.SolveVelocityConstraints=function(){for(var a,f,c,d,b,u,e,g,h,n,t=0;t<this.constraintCount;++t){b=this.constraints[t];var q=b.bodyA,x=b.bodyB,w=q.angularVelocity,z=x.angularVelocity,B=q.linearVelocity,v=x.linearVelocity,y=q.invMass,E=q.invI,A=x.invMass,G=x.invI;g=b.normal.x;var D=h=b.normal.y;n=-g;e=b.friction;for(a=0;a<b.pointCount;a++)f=
b.points[a],c=v.x-z*f.rB.y-B.x+w*f.rA.y,d=v.y+z*f.rB.x-B.y-w*f.rA.x,c=c*D+d*n,c=f.tangentMass*-c,d=e*f.normalImpulse,d=O.Clamp(f.tangentImpulse+c,-d,d),c=d-f.tangentImpulse,u=c*D,c*=n,B.x-=y*u,B.y-=y*c,w-=E*(f.rA.x*c-f.rA.y*u),v.x+=A*u,v.y+=A*c,z+=G*(f.rB.x*c-f.rB.y*u),f.tangentImpulse=d;parseInt(b.pointCount);if(1==b.pointCount)f=b.points[0],c=v.x+-z*f.rB.y-B.x- -w*f.rA.y,d=v.y+z*f.rB.x-B.y-w*f.rA.x,b=c*g+d*h,c=-f.normalMass*(b-f.velocityBias),d=f.normalImpulse+c,d=0<d?d:0,c=d-f.normalImpulse,u=
c*g,c*=h,B.x-=y*u,B.y-=y*c,w-=E*(f.rA.x*c-f.rA.y*u),v.x+=A*u,v.y+=A*c,z+=G*(f.rB.x*c-f.rB.y*u),f.normalImpulse=d;else{f=b.points[0];a=b.points[1];c=f.normalImpulse;e=a.normalImpulse;var F=(v.x-z*f.rB.y-B.x+w*f.rA.y)*g+(v.y+z*f.rB.x-B.y-w*f.rA.x)*h,H=(v.x-z*a.rB.y-B.x+w*a.rA.y)*g+(v.y+z*a.rB.x-B.y-w*a.rA.x)*h;d=F-f.velocityBias;u=H-a.velocityBias;n=b.K;d-=n.col1.x*c+n.col2.x*e;for(u-=n.col1.y*c+n.col2.y*e;;){n=b.normalMass;D=-(n.col1.x*d+n.col2.x*u);n=-(n.col1.y*d+n.col2.y*u);if(0<=D&&0<=n){c=D-c;
e=n-e;b=c*g;c*=h;g*=e;h*=e;B.x-=y*(b+g);B.y-=y*(c+h);w-=E*(f.rA.x*c-f.rA.y*b+a.rA.x*h-a.rA.y*g);v.x+=A*(b+g);v.y+=A*(c+h);z+=G*(f.rB.x*c-f.rB.y*b+a.rB.x*h-a.rB.y*g);f.normalImpulse=D;a.normalImpulse=n;break}D=-f.normalMass*d;n=0;H=b.K.col1.y*D+u;if(0<=D&&0<=H){c=D-c;e=n-e;b=c*g;c*=h;g*=e;h*=e;B.x-=y*(b+g);B.y-=y*(c+h);w-=E*(f.rA.x*c-f.rA.y*b+a.rA.x*h-a.rA.y*g);v.x+=A*(b+g);v.y+=A*(c+h);z+=G*(f.rB.x*c-f.rB.y*b+a.rB.x*h-a.rB.y*g);f.normalImpulse=D;a.normalImpulse=n;break}D=0;n=-a.normalMass*u;F=b.K.col2.x*
n+d;if(0<=n&&0<=F){c=D-c;e=n-e;b=c*g;c*=h;g*=e;h*=e;B.x-=y*(b+g);B.y-=y*(c+h);w-=E*(f.rA.x*c-f.rA.y*b+a.rA.x*h-a.rA.y*g);v.x+=A*(b+g);v.y+=A*(c+h);z+=G*(f.rB.x*c-f.rB.y*b+a.rB.x*h-a.rB.y*g);f.normalImpulse=D;a.normalImpulse=n;break}n=D=0;F=d;H=u;if(0<=F&&0<=H){c=D-c;e=n-e;b=c*g;c*=h;g*=e;h*=e;B.x-=y*(b+g);B.y-=y*(c+h);w-=E*(f.rA.x*c-f.rA.y*b+a.rA.x*h-a.rA.y*g);v.x+=A*(b+g);v.y+=A*(c+h);z+=G*(f.rB.x*c-f.rB.y*b+a.rB.x*h-a.rB.y*g);f.normalImpulse=D;a.normalImpulse=n;break}break}}q.angularVelocity=w;
x.angularVelocity=z}};B.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.constraintCount;++a)for(var f=this.constraints[a],c=f.manifold,d=0;d<f.pointCount;++d){var b=c.points[d],u=f.points[d];b.normalImpulse=u.normalImpulse;b.tangentImpulse=u.tangentImpulse}};B.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var f=0,c=0;c<this.constraintCount;c++){var d=this.constraints[c],b=d.bodyA,u=d.bodyB,e=b.mass*b.invMass,g=b.mass*b.invI,h=u.mass*u.invMass,n=u.mass*u.invI;
B.s_psm.Initialize(d);for(var t=B.s_psm.normal,q=0;q<d.pointCount;q++){var x=d.points[q],w=B.s_psm.points[q],v=B.s_psm.separations[q],z=w.x-b.sweep.c.x,y=w.y-b.sweep.c.y,A=w.x-u.sweep.c.x,w=w.y-u.sweep.c.y,f=f<v?f:v,v=O.Clamp(a*(v+K._linearSlop),-K._maxLinearCorrection,0),v=-x.equalizedMass*v,x=v*t.x,v=v*t.y;b.sweep.c.x-=e*x;b.sweep.c.y-=e*v;b.sweep.a-=g*(z*v-y*x);b.SynchronizeTransform();u.sweep.c.x+=h*x;u.sweep.c.y+=h*v;u.sweep.a+=n*(A*v-w*x);u.SynchronizeTransform()}}return f>-1.5*K._linearSlop};
Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.ContactSolver.s_worldManifold=new u;Box2D.Dynamics.Contacts.ContactSolver.s_psm=new q});Box2D.inherit(x,Box2D.Dynamics.Contacts.Contact);x.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;x.EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};x.Create=function(a){return new x};x.Destroy=function(a,f){};x.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f)};x.prototype.Evaluate=function(){var a=
this.fixtureA.GetBody(),f=this.fixtureB.GetBody();this.CollideEdgeAndCircle(this.manifold,this.fixtureA.GetShape()instanceof n?this.fixtureA.GetShape():null,a.xf,this.fixtureB.GetShape()instanceof t?this.fixtureB.GetShape():null,f.xf)};x.prototype.CollideEdgeAndCircle=function(a,f,c,d,b){};Box2D.inherit(M,Box2D.Dynamics.Contacts.Contact);M.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;M.NullContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};M.prototype.NullContact=
function(){this.__super.Contact.call(this)};M.prototype.Evaluate=function(){};Box2D.inherit(N,Box2D.Dynamics.Contacts.Contact);N.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;N.PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};N.Create=function(a){return new N};N.Destroy=function(a,f){};N.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f);K.Assert(a.GetType()==g.e_polygonShape);K.Assert(f.GetType()==g.e_circleShape)};N.prototype.Evaluate=
function(){var a=this.fixtureA.body,f=this.fixtureB.body;I.CollidePolygonAndCircle(this.manifold,this.fixtureA.GetShape()instanceof w?this.fixtureA.GetShape():null,a.xf,this.fixtureB.GetShape()instanceof t?this.fixtureB.GetShape():null,f.xf)};Box2D.inherit(d,Box2D.Dynamics.Contacts.Contact);d.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;d.PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};d.Create=function(a){return new d};d.Destroy=function(a,
f){};d.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f);K.Assert(a.GetType()==g.e_polygonShape);K.Assert(f.GetType()==g.e_edgeShape)};d.prototype.Evaluate=function(){var a=this.fixtureA.GetBody(),f=this.fixtureB.GetBody();this.CollidePolyAndEdge(this.manifold,this.fixtureA.GetShape()instanceof w?this.fixtureA.GetShape():null,a.xf,this.fixtureB.GetShape()instanceof n?this.fixtureB.GetShape():null,f.xf)};d.prototype.CollidePolyAndEdge=function(a,f,c,d,b){};Box2D.inherit(E,Box2D.Dynamics.Contacts.Contact);
E.prototype.__super=Box2D.Dynamics.Contacts.Contact.prototype;E.PolygonContact=function(){Box2D.Dynamics.Contacts.Contact.Contact.apply(this,arguments)};E.Create=function(a){return new E};E.Destroy=function(a,f){};E.prototype.Reset=function(a,f){this.__super.Reset.call(this,a,f)};E.prototype.Evaluate=function(){var a=this.fixtureA.GetBody(),f=this.fixtureB.GetBody();I.CollidePolygons(this.manifold,this.fixtureA.GetShape()instanceof w?this.fixtureA.GetShape():null,a.xf,this.fixtureB.GetShape()instanceof
w?this.fixtureB.GetShape():null,f.xf)};q.PositionSolverManifold=function(){};q.prototype.PositionSolverManifold=function(){this.normal=new F;this.separations=new Vector_a2j_Number(K._maxManifoldPoints);this.points=new Vector(K._maxManifoldPoints);for(var a=0;a<K._maxManifoldPoints;a++)this.points[a]=new F};q.prototype.Initialize=function(a){K.Assert(0<a.pointCount);var f,c,d,b,u,e;switch(a.type){case L.e_circles:b=a.bodyA.xf.R;d=a.localPoint;f=a.bodyA.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y);c=a.bodyA.xf.position.y+
(b.col1.y*d.x+b.col2.y*d.y);b=a.bodyB.xf.R;d=a.points[0].localPoint;u=a.bodyB.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y);b=a.bodyB.xf.position.y+(b.col1.y*d.x+b.col2.y*d.y);d=u-f;e=b-c;var g=d*d+e*e;g>Number.MIN_VALUE*Number.MIN_VALUE?(g=O.sqrt(g),this.normal.x=d/g,this.normal.y=e/g):(this.normal.x=1,this.normal.y=0);this.points[0].x=.5*(f+u);this.points[0].y=.5*(c+b);this.separations[0]=d*this.normal.x+e*this.normal.y-a.radius;break;case L.e_faceA:b=a.bodyA.xf.R;d=a.localPlaneNormal;this.normal.x=
b.col1.x*d.x+b.col2.x*d.y;this.normal.y=b.col1.y*d.x+b.col2.y*d.y;b=a.bodyA.xf.R;d=a.localPoint;u=a.bodyA.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y);e=a.bodyA.xf.position.y+(b.col1.y*d.x+b.col2.y*d.y);b=a.bodyB.xf.R;for(f=0;f<a.pointCount;++f)d=a.points[f].localPoint,c=a.bodyB.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y),d=a.bodyB.xf.position.y+(b.col1.y*d.x+b.col2.y*d.y),this.separations[f]=(c-u)*this.normal.x+(d-e)*this.normal.y-a.radius,this.points[f].x=c,this.points[f].y=d;break;case L.e_faceB:b=
a.bodyB.xf.R;d=a.localPlaneNormal;this.normal.x=b.col1.x*d.x+b.col2.x*d.y;this.normal.y=b.col1.y*d.x+b.col2.y*d.y;b=a.bodyB.xf.R;d=a.localPoint;u=a.bodyB.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y);e=a.bodyB.xf.position.y+(b.col1.y*d.x+b.col2.y*d.y);b=a.bodyA.xf.R;for(f=0;f<a.pointCount;++f)d=a.points[f].localPoint,c=a.bodyA.xf.position.x+(b.col1.x*d.x+b.col2.x*d.y),d=a.bodyA.xf.position.y+(b.col1.y*d.x+b.col2.y*d.y),this.separations[f]=(c-u)*this.normal.x+(d-e)*this.normal.y-a.radius,this.points[f].Set(c,
d);this.normal.x*=-1;this.normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.PositionSolverManifold.circlePointA=new F;Box2D.Dynamics.Contacts.PositionSolverManifold.circlePointB=new F})})();
(function(){var t=Box2D.Common.Math.Mat22,n=Box2D.Common.Math.Math,w=Box2D.Common.Math.Vec2,g=Box2D.Common.Color,e=Box2D.Dynamics.Controllers.BuoyancyController,h=Box2D.Dynamics.Controllers.ConstantAccelController,A=Box2D.Dynamics.Controllers.ConstantForceController,c=Box2D.Dynamics.Controllers.Controller,v=Box2D.Dynamics.Controllers.ControllerEdge,J=Box2D.Dynamics.Controllers.GravityController,D=Box2D.Dynamics.Controllers.TensorDampingController;Box2D.inherit(e,Box2D.Dynamics.Controllers.Controller);
e.prototype.__super=Box2D.Dynamics.Controllers.Controller.prototype;e.BuoyancyController=function(){Box2D.Dynamics.Controllers.Controller.Controller.apply(this,arguments);this.normal=new w(0,-1);this.density=this.offset=0;this.velocity=new w(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};e.prototype.Step=function(c){if(this.bodyList)for(this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy()),c=this.bodyList;c;c=c.nextBody){var e=
c.body;if(0!=e.IsAwake()){for(var g=new w,h=new w,n=0,d=0,t=e.GetFixtureList();t;t=t.GetNext()){var q=new w,v=t.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),q),n=n+v;g.x+=v*q.x;g.y+=v*q.y;d+=1*v;h.x+=v*q.x*1;h.y+=v*q.y*1}g.x/=n;g.y/=n;h.x/=d;h.y/=d;n<Number.MIN_VALUE||(d=this.gravity.GetNegative(),d.Multiply(this.density*n),e.ApplyForce(d,h),h=e.GetLinearVelocityFromWorldPoint(g),h.Subtract(this.velocity),h.Multiply(-this.linearDrag*n),e.ApplyForce(h,g),e.ApplyTorque(-e.GetInertia()/
e.GetMass()*n*e.GetAngularVelocity()*this.angularDrag))}}};e.prototype.Draw=function(c){var e=new w,h=new w;e.x=this.normal.x*this.offset+1E3*this.normal.y;e.y=this.normal.y*this.offset-1E3*this.normal.x;h.x=this.normal.x*this.offset-1E3*this.normal.y;h.y=this.normal.y*this.offset+1E3*this.normal.x;var n=new g(0,0,1);c.DrawSegment(e,h,n)};Box2D.inherit(h,Box2D.Dynamics.Controllers.Controller);h.prototype.__super=Box2D.Dynamics.Controllers.Controller.prototype;h.ConstantAccelController=function(){Box2D.Dynamics.Controllers.Controller.Controller.apply(this,
arguments);this.A=new w(0,0)};h.prototype.Step=function(c){c=new w(this.A.x*c.dt,this.A.y*c.dt);for(var e=this.bodyList;e;e=e.nextBody){var g=e.body;g.IsAwake()&&g.SetLinearVelocity(new w(g.GetLinearVelocity().x+c.x,g.GetLinearVelocity().y+c.y))}};Box2D.inherit(A,Box2D.Dynamics.Controllers.Controller);A.prototype.__super=Box2D.Dynamics.Controllers.Controller.prototype;A.ConstantForceController=function(){Box2D.Dynamics.Controllers.Controller.Controller.apply(this,arguments);this.F=new w(0,0)};A.prototype.Step=
function(c){for(c=this.bodyList;c;c=c.nextBody){var e=c.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}};c.Controller=function(){};c.prototype.Step=function(c){};c.prototype.Draw=function(c){};c.prototype.AddBody=function(c){var e=new v;e.controller=this;e.body=c;e.nextBody=this.bodyList;e.prevBody=null;this.bodyList=e;e.nextBody&&(e.nextBody.prevBody=e);this.bodyCount++;e.nextController=c.controllerList;e.prevController=null;c.controllerList=e;e.nextController&&(e.nextController.prevController=
e);c.controllerCount++};c.prototype.RemoveBody=function(c){for(var e=c.controllerList;e&&e.controller!=this;)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody);e.nextBody&&(e.nextBody.prevBody=e.prevBody);e.nextController&&(e.nextController.prevController=e.prevController);e.prevController&&(e.prevController.nextController=e.nextController);this.bodyList==e&&(this.bodyList=e.nextBody);c.controllerList==e&&(c.controllerList=e.nextController);c.controllerCount--;this.bodyCount--};c.prototype.Clear=
function(){for(;this.bodyList;)this.RemoveBody(this.bodyList.body)};c.prototype.GetNext=function(){return this.next};c.prototype.GetWorld=function(){return this.world};c.prototype.GetBodyList=function(){return this.bodyList};v.ControllerEdge=function(){};Box2D.inherit(J,Box2D.Dynamics.Controllers.Controller);J.prototype.__super=Box2D.Dynamics.Controllers.Controller.prototype;J.GravityController=function(){Box2D.Dynamics.Controllers.Controller.Controller.apply(this,arguments);this.G=1;this.invSqr=
!0};J.prototype.Step=function(c){var e,g,h,t,d,v,q,A,D;if(this.invSqr)for(c=this.bodyList;c;c=c.nextBody)for(e=c.body,g=e.GetWorldCenter(),h=e.GetMass(),t=this.bodyList;t!=c;t=t.nextBody)d=t.body,v=d.GetWorldCenter(),q=v.x-g.x,A=v.y-g.y,D=q*q+A*A,D<Number.MIN_VALUE||(q=new w(q,A),q.Multiply(this.G/D/n.sqrt(D)*h*d.GetMass()),e.IsAwake()&&e.ApplyForce(q,g),q.Multiply(-1),d.IsAwake()&&d.ApplyForce(q,v));else for(c=this.bodyList;c;c=c.nextBody)for(e=c.body,g=e.GetWorldCenter(),h=e.GetMass(),t=this.bodyList;t!=
c;t=t.nextBody)d=t.body,v=d.GetWorldCenter(),q=v.x-g.x,A=v.y-g.y,D=q*q+A*A,D<Number.MIN_VALUE||(q=new w(q,A),q.Multiply(this.G/D*h*d.GetMass()),e.IsAwake()&&e.ApplyForce(q,g),q.Multiply(-1),d.IsAwake()&&d.ApplyForce(q,v))};Box2D.inherit(D,Box2D.Dynamics.Controllers.Controller);D.prototype.__super=Box2D.Dynamics.Controllers.Controller.prototype;D.TensorDampingController=function(){Box2D.Dynamics.Controllers.Controller.Controller.apply(this,arguments);this.T=new t;this.maxTimestep=0};D.prototype.SetAxisAligned=
function(c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.T.col1.x=-c;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-e;this.maxTimestep=0<c||0<e?1/n.max(c,e):0};D.prototype.Step=function(c){c=c.dt;if(!(c<=Number.MIN_VALUE)){c>this.maxTimestep&&0<this.maxTimestep&&(c=this.maxTimestep);for(var e=this.bodyList;e;e=e.nextBody){var g=e.body;if(g.IsAwake()){var h=g.GetWorldVector(n.MulMV(this.T,g.GetLocalVector(g.GetLinearVelocity())));g.SetLinearVelocity(new w(g.GetLinearVelocity().x+h.x*c,g.GetLinearVelocity().y+
h.y*c))}}}}})();
(function(){var t=Box2D.Common.Settings,n=Box2D.Common.Math.Mat22,w=Box2D.Common.Math.Mat33,g=Box2D.Common.Math.Math,e=Box2D.Common.Math.Vec2,h=Box2D.Common.Math.Vec3,A=Box2D.Dynamics.Joints.DistanceJoint,c=Box2D.Dynamics.Joints.DistanceJointDef,v=Box2D.Dynamics.Joints.FrictionJoint,J=Box2D.Dynamics.Joints.FrictionJointDef,D=Box2D.Dynamics.Joints.GearJoint,z=Box2D.Dynamics.Joints.GearJointDef,B=Box2D.Dynamics.Joints.Jacobian,x=Box2D.Dynamics.Joints.Joint,M=Box2D.Dynamics.Joints.JointDef,N=Box2D.Dynamics.Joints.JointEdge,
d=Box2D.Dynamics.Joints.LineJoint,E=Box2D.Dynamics.Joints.LineJointDef,q=Box2D.Dynamics.Joints.MouseJoint,G=Box2D.Dynamics.Joints.MouseJointDef,H=Box2D.Dynamics.Joints.PrismaticJoint,K=Box2D.Dynamics.Joints.PrismaticJointDef,y=Box2D.Dynamics.Joints.PulleyJoint,O=Box2D.Dynamics.Joints.PulleyJointDef,F=Box2D.Dynamics.Joints.RevoluteJoint,I=Box2D.Dynamics.Joints.RevoluteJointDef,P=Box2D.Dynamics.Joints.WeldJoint,L=Box2D.Dynamics.Joints.WeldJointDef;Box2D.inherit(A,Box2D.Dynamics.Joints.Joint);A.prototype.__super=
Box2D.Dynamics.Joints.Joint.prototype;A.DistanceJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.localAnchor1=new e;this.localAnchor2=new e;this.u=new e};A.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};A.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};A.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.impulse*this.u.x,a*this.impulse*this.u.y)};A.prototype.GetReactionTorque=
function(a){return 0};A.prototype.GetLength=function(){return this.length};A.prototype.SetLength=function(a){void 0===a&&(a=0);this.length=a};A.prototype.GetFrequency=function(){return this.frequencyHz};A.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.frequencyHz=a};A.prototype.GetDampingRatio=function(){return this.dampingRatio};A.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.dampingRatio=a};A.prototype.DistanceJoint=function(a){this.__super.Joint.call(this,a);this.localAnchor1.SetV(a.localAnchorA);
this.localAnchor2.SetV(a.localAnchorB);this.length=a.length;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio;this.bias=this.gamma=this.impulse=0};A.prototype.InitVelocityConstraints=function(a){var f,c,d=this.bodyA,e=this.bodyB;f=d.xf.R;var h=this.localAnchor1.x-d.sweep.localCenter.x,r=this.localAnchor1.y-d.sweep.localCenter.y;c=f.col1.x*h+f.col2.x*r;r=f.col1.y*h+f.col2.y*r;h=c;f=e.xf.R;var b=this.localAnchor2.x-e.sweep.localCenter.x,l=this.localAnchor2.y-e.sweep.localCenter.y;c=f.col1.x*
b+f.col2.x*l;l=f.col1.y*b+f.col2.y*l;b=c;this.u.x=e.sweep.c.x+b-d.sweep.c.x-h;this.u.y=e.sweep.c.y+l-d.sweep.c.y-r;c=g.sqrt(this.u.x*this.u.x+this.u.y*this.u.y);c>t._linearSlop?this.u.Multiply(1/c):this.u.SetZero();f=h*this.u.y-r*this.u.x;var p=b*this.u.y-l*this.u.x;f=d.invMass+d.invI*f*f+e.invMass+e.invI*p*p;this.mass=0!=f?1/f:0;if(0<this.frequencyHz){c-=this.length;var p=2*g.PI*this.frequencyHz,n=this.mass*p*p;this.gamma=a.dt*(2*this.mass*this.dampingRatio*p+a.dt*n);this.gamma=0!=this.gamma?1/this.gamma:
0;this.bias=c*a.dt*n*this.gamma;this.mass=f+this.gamma;this.mass=0!=this.mass?1/this.mass:0}a.warmStarting?(this.impulse*=a.dtRatio,a=this.impulse*this.u.x,f=this.impulse*this.u.y,d.linearVelocity.x-=d.invMass*a,d.linearVelocity.y-=d.invMass*f,d.angularVelocity-=d.invI*(h*f-r*a),e.linearVelocity.x+=e.invMass*a,e.linearVelocity.y+=e.invMass*f,e.angularVelocity+=e.invI*(b*f-l*a)):this.impulse=0};A.prototype.SolveVelocityConstraints=function(a){var f;a=this.bodyA;var c=this.bodyB;f=a.xf.R;var d=this.localAnchor1.x-
a.sweep.localCenter.x,e=this.localAnchor1.y-a.sweep.localCenter.y,g=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=g;f=c.xf.R;var h=this.localAnchor2.x-c.sweep.localCenter.x,b=this.localAnchor2.y-c.sweep.localCenter.y,g=f.col1.x*h+f.col2.x*b,b=f.col1.y*h+f.col2.y*b,h=g,g=-this.mass*(this.u.x*(c.linearVelocity.x+-c.angularVelocity*b-(a.linearVelocity.x+-a.angularVelocity*e))+this.u.y*(c.linearVelocity.y+c.angularVelocity*h-(a.linearVelocity.y+a.angularVelocity*d))+this.bias+this.gamma*this.impulse);
this.impulse+=g;f=g*this.u.x;g*=this.u.y;a.linearVelocity.x-=a.invMass*f;a.linearVelocity.y-=a.invMass*g;a.angularVelocity-=a.invI*(d*g-e*f);c.linearVelocity.x+=c.invMass*f;c.linearVelocity.y+=c.invMass*g;c.angularVelocity+=c.invI*(h*g-b*f)};A.prototype.SolvePositionConstraints=function(a){var f;if(0<this.frequencyHz)return!0;a=this.bodyA;var c=this.bodyB;f=a.xf.R;var d=this.localAnchor1.x-a.sweep.localCenter.x,e=this.localAnchor1.y-a.sweep.localCenter.y,h=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*
e,d=h;f=c.xf.R;var r=this.localAnchor2.x-c.sweep.localCenter.x,b=this.localAnchor2.y-c.sweep.localCenter.y,h=f.col1.x*r+f.col2.x*b,b=f.col1.y*r+f.col2.y*b,r=h,h=c.sweep.c.x+r-a.sweep.c.x-d,l=c.sweep.c.y+b-a.sweep.c.y-e;f=g.sqrt(h*h+l*l);h/=f;l/=f;f-=this.length;f=g.Clamp(f,-t._maxLinearCorrection,t._maxLinearCorrection);var p=-this.mass*f;this.u.Set(h,l);h=p*this.u.x;l=p*this.u.y;a.sweep.c.x-=a.invMass*h;a.sweep.c.y-=a.invMass*l;a.sweep.a-=a.invI*(d*l-e*h);c.sweep.c.x+=c.invMass*h;c.sweep.c.y+=c.invMass*
l;c.sweep.a+=c.invI*(r*l-b*h);a.SynchronizeTransform();c.SynchronizeTransform();return g.Abs(f)<t._linearSlop};Box2D.inherit(c,Box2D.Dynamics.Joints.JointDef);c.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;c.DistanceJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e};c.prototype.DistanceJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=
0};c.prototype.Initialize=function(a,f,c,d){this.bodyA=a;this.bodyB=f;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));a=d.x-c.x;c=d.y-c.y;this.length=g.sqrt(a*a+c*c);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(v,Box2D.Dynamics.Joints.Joint);v.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;v.FrictionJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.linearMass=
new n;this.linearImpulse=new e};v.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchorA)};v.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchorB)};v.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.linearImpulse.x,a*this.linearImpulse.y)};v.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.angularImpulse};v.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.maxForce=a};v.prototype.GetMaxForce=
function(){return this.maxForce};v.prototype.SetMaxTorque=function(a){void 0===a&&(a=0);this.maxTorque=a};v.prototype.GetMaxTorque=function(){return this.maxTorque};v.prototype.FrictionJoint=function(a){this.__super.Joint.call(this,a);this.localAnchorA.SetV(a.localAnchorA);this.localAnchorB.SetV(a.localAnchorB);this.linearMass.SetZero();this.angularMass=0;this.linearImpulse.SetZero();this.angularImpulse=0;this.maxForce=a.maxForce;this.maxTorque=a.maxTorque};v.prototype.InitVelocityConstraints=function(a){var f,
c,d=this.bodyA,e=this.bodyB;f=d.xf.R;var g=this.localAnchorA.x-d.sweep.localCenter.x,h=this.localAnchorA.y-d.sweep.localCenter.y;c=f.col1.x*g+f.col2.x*h;h=f.col1.y*g+f.col2.y*h;g=c;f=e.xf.R;var b=this.localAnchorB.x-e.sweep.localCenter.x,l=this.localAnchorB.y-e.sweep.localCenter.y;c=f.col1.x*b+f.col2.x*l;l=f.col1.y*b+f.col2.y*l;b=c;f=d.invMass;c=e.invMass;var p=d.invI,t=e.invI,q=new n;q.col1.x=f+c;q.col2.x=0;q.col1.y=0;q.col2.y=f+c;q.col1.x+=p*h*h;q.col2.x+=-p*g*h;q.col1.y+=-p*g*h;q.col2.y+=p*g*g;
q.col1.x+=t*l*l;q.col2.x+=-t*b*l;q.col1.y+=-t*b*l;q.col2.y+=t*b*b;q.GetInverse(this.linearMass);this.angularMass=p+t;0<this.angularMass&&(this.angularMass=1/this.angularMass);a.warmStarting?(this.linearImpulse.x*=a.dtRatio,this.linearImpulse.y*=a.dtRatio,this.angularImpulse*=a.dtRatio,a=this.linearImpulse,d.linearVelocity.x-=f*a.x,d.linearVelocity.y-=f*a.y,d.angularVelocity-=p*(g*a.y-h*a.x+this.angularImpulse),e.linearVelocity.x+=c*a.x,e.linearVelocity.y+=c*a.y,e.angularVelocity+=t*(b*a.y-l*a.x+this.angularImpulse)):
(this.linearImpulse.SetZero(),this.angularImpulse=0)};v.prototype.SolveVelocityConstraints=function(a){var f,c,d=this.bodyA,k=this.bodyB,h=d.linearVelocity,r=d.angularVelocity,b=k.linearVelocity,l=k.angularVelocity,p=d.invMass,n=k.invMass,t=d.invI,q=k.invI;f=d.xf.R;var w=this.localAnchorA.x-d.sweep.localCenter.x,v=this.localAnchorA.y-d.sweep.localCenter.y;c=f.col1.x*w+f.col2.x*v;v=f.col1.y*w+f.col2.y*v;w=c;f=k.xf.R;var x=this.localAnchorB.x-k.sweep.localCenter.x,y=this.localAnchorB.y-k.sweep.localCenter.y;
c=f.col1.x*x+f.col2.x*y;y=f.col1.y*x+f.col2.y*y;x=c;c=-this.angularMass*(l-r);var z=this.angularImpulse;f=a.dt*this.maxTorque;this.angularImpulse=g.Clamp(this.angularImpulse+c,-f,f);c=this.angularImpulse-z;r-=t*c;l+=q*c;f=g.MulMV(this.linearMass,new e(-(b.x-l*y-h.x+r*v),-(b.y+l*x-h.y-r*w)));c=this.linearImpulse.Copy();this.linearImpulse.Add(f);f=a.dt*this.maxForce;this.linearImpulse.LengthSquared()>f*f&&(this.linearImpulse.Normalize(),this.linearImpulse.Multiply(f));f=g.SubtractVV(this.linearImpulse,
c);h.x-=p*f.x;h.y-=p*f.y;r-=t*(w*f.y-v*f.x);b.x+=n*f.x;b.y+=n*f.y;l+=q*(x*f.y-y*f.x);d.angularVelocity=r;k.angularVelocity=l};v.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(J,Box2D.Dynamics.Joints.JointDef);J.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;J.FrictionJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e};J.prototype.FrictionJointDef=function(){this.__super.JointDef.call(this);
this.type=x.e_frictionJoint;this.maxTorque=this.maxForce=0};J.prototype.Initialize=function(a,f,c){this.bodyA=a;this.bodyB=f;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))};Box2D.inherit(D,Box2D.Dynamics.Joints.Joint);D.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;D.GearJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.groundAnchor1=new e;this.groundAnchor2=new e;this.localAnchor1=new e;this.localAnchor2=
new e;this.J=new B};D.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};D.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};D.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.impulse*this.J.linearB.x,a*this.impulse*this.J.linearB.y)};D.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);var f=this.bodyB.xf.R,c=this.localAnchor1.x-this.bodyB.sweep.localCenter.x,d=this.localAnchor1.y-this.bodyB.sweep.localCenter.y,
e=f.col1.x*c+f.col2.x*d,d=f.col1.y*c+f.col2.y*d;return a*(this.impulse*this.J.angularB-e*this.impulse*this.J.linearB.y+d*this.impulse*this.J.linearB.x)};D.prototype.GetRatio=function(){return this.ratio};D.prototype.SetRatio=function(a){void 0===a&&(a=0);this.ratio=a};D.prototype.GearJoint=function(a){this.__super.Joint.call(this,a);var f=parseInt(a.joint1.type),c=parseInt(a.joint2.type);this.prismatic2=this.revolute2=this.prismatic1=this.revolute1=null;this.ground1=a.joint1.GetBodyA();this.bodyA=
a.joint1.GetBodyB();f==x.e_revoluteJoint?(this.revolute1=a.joint1 instanceof F?a.joint1:null,this.groundAnchor1.SetV(this.revolute1.localAnchor1),this.localAnchor1.SetV(this.revolute1.localAnchor2),f=this.revolute1.GetJointAngle()):(this.prismatic1=a.joint1 instanceof H?a.joint1:null,this.groundAnchor1.SetV(this.prismatic1.localAnchor1),this.localAnchor1.SetV(this.prismatic1.localAnchor2),f=this.prismatic1.GetJointTranslation());this.ground2=a.joint2.GetBodyA();this.bodyB=a.joint2.GetBodyB();c==x.e_revoluteJoint?
(this.revolute2=a.joint2 instanceof F?a.joint2:null,this.groundAnchor2.SetV(this.revolute2.localAnchor1),this.localAnchor2.SetV(this.revolute2.localAnchor2),c=this.revolute2.GetJointAngle()):(this.prismatic2=a.joint2 instanceof H?a.joint2:null,this.groundAnchor2.SetV(this.prismatic2.localAnchor1),this.localAnchor2.SetV(this.prismatic2.localAnchor2),c=this.prismatic2.GetJointTranslation());this.ratio=a.ratio;this.constant=f+this.ratio*c;this.impulse=0};D.prototype.InitVelocityConstraints=function(a){var f=
this.ground1,c=this.ground2,d=this.bodyA,e=this.bodyB,g,h,b,l,p,n=0;this.J.SetZero();this.revolute1?(this.J.angularA=-1,n+=d.invI):(l=f.xf.R,g=this.prismatic1.localXAxis1,f=l.col1.x*g.x+l.col2.x*g.y,g=l.col1.y*g.x+l.col2.y*g.y,l=d.xf.R,h=this.localAnchor1.x-d.sweep.localCenter.x,b=this.localAnchor1.y-d.sweep.localCenter.y,p=l.col1.x*h+l.col2.x*b,b=l.col1.y*h+l.col2.y*b,l=p*g-b*f,this.J.linearA.Set(-f,-g),this.J.angularA=-l,n+=d.invMass+d.invI*l*l);this.revolute2?(this.J.angularB=-this.ratio,n+=this.ratio*
this.ratio*e.invI):(l=c.xf.R,g=this.prismatic2.localXAxis1,f=l.col1.x*g.x+l.col2.x*g.y,g=l.col1.y*g.x+l.col2.y*g.y,l=e.xf.R,h=this.localAnchor2.x-e.sweep.localCenter.x,b=this.localAnchor2.y-e.sweep.localCenter.y,p=l.col1.x*h+l.col2.x*b,b=l.col1.y*h+l.col2.y*b,l=p*g-b*f,this.J.linearB.Set(-this.ratio*f,-this.ratio*g),this.J.angularB=-this.ratio*l,n+=this.ratio*this.ratio*(e.invMass+e.invI*l*l));this.mass=0<n?1/n:0;a.warmStarting?(d.linearVelocity.x+=d.invMass*this.impulse*this.J.linearA.x,d.linearVelocity.y+=
d.invMass*this.impulse*this.J.linearA.y,d.angularVelocity+=d.invI*this.impulse*this.J.angularA,e.linearVelocity.x+=e.invMass*this.impulse*this.J.linearB.x,e.linearVelocity.y+=e.invMass*this.impulse*this.J.linearB.y,e.angularVelocity+=e.invI*this.impulse*this.J.angularB):this.impulse=0};D.prototype.SolveVelocityConstraints=function(a){a=this.bodyA;var f=this.bodyB,c=this.J.Compute(a.linearVelocity,a.angularVelocity,f.linearVelocity,f.angularVelocity),c=-this.mass*c;this.impulse+=c;a.linearVelocity.x+=
a.invMass*c*this.J.linearA.x;a.linearVelocity.y+=a.invMass*c*this.J.linearA.y;a.angularVelocity+=a.invI*c*this.J.angularA;f.linearVelocity.x+=f.invMass*c*this.J.linearB.x;f.linearVelocity.y+=f.invMass*c*this.J.linearB.y;f.angularVelocity+=f.invI*c*this.J.angularB};D.prototype.SolvePositionConstraints=function(a){a=this.bodyA;var f=this.bodyB,c,d;c=this.revolute1?this.revolute1.GetJointAngle():this.prismatic1.GetJointTranslation();d=this.revolute2?this.revolute2.GetJointAngle():this.prismatic2.GetJointTranslation();
c=-this.mass*(this.constant-(c+this.ratio*d));a.sweep.c.x+=a.invMass*c*this.J.linearA.x;a.sweep.c.y+=a.invMass*c*this.J.linearA.y;a.sweep.a+=a.invI*c*this.J.angularA;f.sweep.c.x+=f.invMass*c*this.J.linearB.x;f.sweep.c.y+=f.invMass*c*this.J.linearB.y;f.sweep.a+=f.invI*c*this.J.angularB;a.SynchronizeTransform();f.SynchronizeTransform();return 0<t._linearSlop};Box2D.inherit(z,Box2D.Dynamics.Joints.JointDef);z.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;z.GearJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,
arguments)};z.prototype.GearJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};B.Jacobian=function(){this.linearA=new e;this.linearB=new e};B.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};B.prototype.Set=function(a,f,c,d){void 0===f&&(f=0);void 0===d&&(d=0);this.linearA.SetV(a);this.angularA=f;this.linearB.SetV(c);this.angularB=d};B.prototype.Compute=function(a,f,c,d){void 0===
f&&(f=0);void 0===d&&(d=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*f+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d};x.Joint=function(){this.edgeA=new N;this.edgeB=new N;this.localCenterA=new e;this.localCenterB=new e};x.prototype.GetType=function(){return this.type};x.prototype.GetAnchorA=function(){return null};x.prototype.GetAnchorB=function(){return null};x.prototype.GetReactionForce=function(a){return null};x.prototype.GetReactionTorque=function(a){return 0};x.prototype.GetBodyA=
function(){return this.bodyA};x.prototype.GetBodyB=function(){return this.bodyB};x.prototype.GetNext=function(){return this.next};x.prototype.GetUserData=function(){return this.userData};x.prototype.SetUserData=function(a){this.userData=a};x.prototype.IsActive=function(){return this.bodyA.IsActive()&&this.bodyB.IsActive()};x.Create=function(a,f){var e=null;switch(a.type){case x.e_distanceJoint:e=new A(a instanceof c?a:null);break;case x.e_mouseJoint:e=new q(a instanceof G?a:null);break;case x.e_prismaticJoint:e=
new H(a instanceof K?a:null);break;case x.e_revoluteJoint:e=new F(a instanceof I?a:null);break;case x.e_pulleyJoint:e=new y(a instanceof O?a:null);break;case x.e_gearJoint:e=new D(a instanceof z?a:null);break;case x.e_lineJoint:e=new d(a instanceof E?a:null);break;case x.e_weldJoint:e=new P(a instanceof L?a:null);break;case x.e_frictionJoint:e=new v(a instanceof J?a:null)}return e};x.Destroy=function(a,f){};x.prototype.Joint=function(a){t.Assert(a.bodyA!=a.bodyB);this.type=a.type;this.next=this.prev=
null;this.bodyA=a.bodyA;this.bodyB=a.bodyB;this.collideConnected=a.collideConnected;this.islandFlag=!1;this.userData=a.userData};x.prototype.InitVelocityConstraints=function(a){};x.prototype.SolveVelocityConstraints=function(a){};x.prototype.FinalizeVelocityConstraints=function(){};x.prototype.SolvePositionConstraints=function(a){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.Joint.e_prismaticJoint=
2;Box2D.Dynamics.Joints.Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.Joint.e_gearJoint=6;Box2D.Dynamics.Joints.Joint.e_lineJoint=7;Box2D.Dynamics.Joints.Joint.e_weldJoint=8;Box2D.Dynamics.Joints.Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.Joint.e_equalLimits=3});M.JointDef=function(){};
M.prototype.JointDef=function(){this.type=x.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};N.JointEdge=function(){};Box2D.inherit(d,Box2D.Dynamics.Joints.Joint);d.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;d.LineJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.localAnchor1=new e;this.localAnchor2=new e;this.localXAxis1=new e;this.localYAxis1=new e;this.axis=new e;this.perp=new e;this.K=new n;this.impulse=new e};d.prototype.GetAnchorA=
function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};d.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};d.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*(this.impulse.x*this.perp.x+(this.motorImpulse+this.impulse.y)*this.axis.x),a*(this.impulse.x*this.perp.y+(this.motorImpulse+this.impulse.y)*this.axis.y))};d.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.impulse.y};d.prototype.GetJointTranslation=function(){var a=
this.bodyA,f=this.bodyB,c=a.GetWorldPoint(this.localAnchor1),d=f.GetWorldPoint(this.localAnchor2),f=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.localXAxis1);return a.x*f+a.y*c};d.prototype.GetJointSpeed=function(){var a=this.bodyA,f=this.bodyB,c;c=a.xf.R;var d=this.localAnchor1.x-a.sweep.localCenter.x,e=this.localAnchor1.y-a.sweep.localCenter.y,g=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*e,d=g;c=f.xf.R;var h=this.localAnchor2.x-f.sweep.localCenter.x,b=this.localAnchor2.y-f.sweep.localCenter.y,g=c.col1.x*
h+c.col2.x*b,b=c.col1.y*h+c.col2.y*b,h=g;c=f.sweep.c.x+h-(a.sweep.c.x+d);var g=f.sweep.c.y+b-(a.sweep.c.y+e),l=a.GetWorldVector(this.localXAxis1),p=a.linearVelocity,n=f.linearVelocity,a=a.angularVelocity,f=f.angularVelocity;return c*-a*l.y+g*a*l.x+(l.x*(n.x+-f*b-p.x- -a*e)+l.y*(n.y+f*h-p.y-a*d))};d.prototype.IsLimitEnabled=function(){return this.enableLimit};d.prototype.EnableLimit=function(a){this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.enableLimit=a};d.prototype.GetLowerLimit=function(){return this.lowerTranslation};
d.prototype.GetUpperLimit=function(){return this.upperTranslation};d.prototype.SetLimits=function(a,f){void 0===a&&(a=0);void 0===f&&(f=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.lowerTranslation=a;this.upperTranslation=f};d.prototype.IsMotorEnabled=function(){return this.enableMotor};d.prototype.EnableMotor=function(a){this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.enableMotor=a};d.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);
this.motorSpeed=a};d.prototype.GetMotorSpeed=function(){return this.motorSpeed};d.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.maxMotorForce=a};d.prototype.GetMaxMotorForce=function(){return this.maxMotorForce};d.prototype.GetMotorForce=function(){return this.motorImpulse};d.prototype.LineJoint=function(a){this.__super.Joint.call(this,a);this.localAnchor1.SetV(a.localAnchorA);this.localAnchor2.SetV(a.localAnchorB);this.localXAxis1.SetV(a.localAxisA);
this.localYAxis1.x=-this.localXAxis1.y;this.localYAxis1.y=this.localXAxis1.x;this.impulse.SetZero();this.motorImpulse=this.motorMass=0;this.lowerTranslation=a.lowerTranslation;this.upperTranslation=a.upperTranslation;this.maxMotorForce=a.maxMotorForce;this.motorSpeed=a.motorSpeed;this.enableLimit=a.enableLimit;this.enableMotor=a.enableMotor;this.limitState=x.e_inactiveLimit;this.axis.SetZero();this.perp.SetZero()};d.prototype.InitVelocityConstraints=function(a){var f=this.bodyA,c=this.bodyB,d,e;this.localCenterA.SetV(f.GetLocalCenter());
this.localCenterB.SetV(c.GetLocalCenter());var h=f.GetTransform();c.GetTransform();d=f.xf.R;var r=this.localAnchor1.x-this.localCenterA.x,b=this.localAnchor1.y-this.localCenterA.y;e=d.col1.x*r+d.col2.x*b;b=d.col1.y*r+d.col2.y*b;r=e;d=c.xf.R;var l=this.localAnchor2.x-this.localCenterB.x,p=this.localAnchor2.y-this.localCenterB.y;e=d.col1.x*l+d.col2.x*p;p=d.col1.y*l+d.col2.y*p;l=e;d=c.sweep.c.x+l-f.sweep.c.x-r;e=c.sweep.c.y+p-f.sweep.c.y-b;this.invMassA=f.invMass;this.invMassB=c.invMass;this.invIA=f.invI;
this.invIB=c.invI;this.axis.SetV(g.MulMV(h.R,this.localXAxis1));this.a1=(d+r)*this.axis.y-(e+b)*this.axis.x;this.a2=l*this.axis.y-p*this.axis.x;this.motorMass=this.invMassA+this.invMassB+this.invIA*this.a1*this.a1+this.invIB*this.a2*this.a2;this.motorMass=this.motorMass>Number.MIN_VALUE?1/this.motorMass:0;this.perp.SetV(g.MulMV(h.R,this.localYAxis1));this.s1=(d+r)*this.perp.y-(e+b)*this.perp.x;this.s2=l*this.perp.y-p*this.perp.x;h=this.invMassA;r=this.invMassB;b=this.invIA;l=this.invIB;this.K.col1.x=
h+r+b*this.s1*this.s1+l*this.s2*this.s2;this.K.col1.y=b*this.s1*this.a1+l*this.s2*this.a2;this.K.col2.x=this.K.col1.y;this.K.col2.y=h+r+b*this.a1*this.a1+l*this.a2*this.a2;this.enableLimit?(d=this.axis.x*d+this.axis.y*e,g.Abs(this.upperTranslation-this.lowerTranslation)<2*t._linearSlop?this.limitState=x.e_equalLimits:d<=this.lowerTranslation?this.limitState!=x.e_atLowerLimit&&(this.limitState=x.e_atLowerLimit,this.impulse.y=0):d>=this.upperTranslation?this.limitState!=x.e_atUpperLimit&&(this.limitState=
x.e_atUpperLimit,this.impulse.y=0):(this.limitState=x.e_inactiveLimit,this.impulse.y=0)):this.limitState=x.e_inactiveLimit;0==this.enableMotor&&(this.motorImpulse=0);a.warmStarting?(this.impulse.x*=a.dtRatio,this.impulse.y*=a.dtRatio,this.motorImpulse*=a.dtRatio,a=this.impulse.x*this.perp.x+(this.motorImpulse+this.impulse.y)*this.axis.x,d=this.impulse.x*this.perp.y+(this.motorImpulse+this.impulse.y)*this.axis.y,e=this.impulse.x*this.s1+(this.motorImpulse+this.impulse.y)*this.a1,h=this.impulse.x*this.s2+
(this.motorImpulse+this.impulse.y)*this.a2,f.linearVelocity.x-=this.invMassA*a,f.linearVelocity.y-=this.invMassA*d,f.angularVelocity-=this.invIA*e,c.linearVelocity.x+=this.invMassB*a,c.linearVelocity.y+=this.invMassB*d,c.angularVelocity+=this.invIB*h):(this.impulse.SetZero(),this.motorImpulse=0)};d.prototype.SolveVelocityConstraints=function(a){var f=this.bodyA,c=this.bodyB,d=f.linearVelocity,k=f.angularVelocity,h=c.linearVelocity,r=c.angularVelocity,b,l,p;this.enableMotor&&this.limitState!=x.e_equalLimits&&
(p=this.motorMass*(this.motorSpeed-(this.axis.x*(h.x-d.x)+this.axis.y*(h.y-d.y)+this.a2*r-this.a1*k)),b=this.motorImpulse,a=a.dt*this.maxMotorForce,this.motorImpulse=g.Clamp(this.motorImpulse+p,-a,a),p=this.motorImpulse-b,b=p*this.axis.x,a=p*this.axis.y,l=p*this.a1,p*=this.a2,d.x-=this.invMassA*b,d.y-=this.invMassA*a,k-=this.invIA*l,h.x+=this.invMassB*b,h.y+=this.invMassB*a,r+=this.invIB*p);a=this.perp.x*(h.x-d.x)+this.perp.y*(h.y-d.y)+this.s2*r-this.s1*k;this.enableLimit&&this.limitState!=x.e_inactiveLimit?
(l=this.axis.x*(h.x-d.x)+this.axis.y*(h.y-d.y)+this.a2*r-this.a1*k,b=this.impulse.Copy(),p=this.K.Solve(new e,-a,-l),this.impulse.Add(p),this.limitState==x.e_atLowerLimit?this.impulse.y=g.Max(this.impulse.y,0):this.limitState==x.e_atUpperLimit&&(this.impulse.y=g.Min(this.impulse.y,0)),a=-a-(this.impulse.y-b.y)*this.K.col2.x,this.impulse.x=0!=this.K.col1.x?a/this.K.col1.x+b.x:b.x,p.x=this.impulse.x-b.x,p.y=this.impulse.y-b.y,b=p.x*this.perp.x+p.y*this.axis.x,a=p.x*this.perp.y+p.y*this.axis.y,l=p.x*
this.s1+p.y*this.a1,p=p.x*this.s2+p.y*this.a2):(p=0!=this.K.col1.x?-a/this.K.col1.x:0,this.impulse.x+=p,b=p*this.perp.x,a=p*this.perp.y,l=p*this.s1,p*=this.s2);d.x-=this.invMassA*b;d.y-=this.invMassA*a;k-=this.invIA*l;h.x+=this.invMassB*b;h.y+=this.invMassB*a;r+=this.invIB*p;f.linearVelocity.SetV(d);f.angularVelocity=k;c.linearVelocity.SetV(h);c.angularVelocity=r};d.prototype.SolvePositionConstraints=function(a){a=this.bodyA;var f=this.bodyB,c=a.sweep.c,d=a.sweep.a,k=f.sweep.c,h=f.sweep.a,r,b,l,p,
q,w,v=0;l=!1;var x=0,y=n.FromAngle(d);q=n.FromAngle(h);r=y;var z=this.localAnchor1.x-this.localCenterA.x;p=this.localAnchor1.y-this.localCenterA.y;b=r.col1.x*z+r.col2.x*p;p=r.col1.y*z+r.col2.y*p;z=b;r=q;q=this.localAnchor2.x-this.localCenterB.x;w=this.localAnchor2.y-this.localCenterB.y;b=r.col1.x*q+r.col2.x*w;w=r.col1.y*q+r.col2.y*w;q=b;r=k.x+q-c.x-z;b=k.y+w-c.y-p;if(this.enableLimit){this.axis=g.MulMV(y,this.localXAxis1);this.a1=(r+z)*this.axis.y-(b+p)*this.axis.x;this.a2=q*this.axis.y-w*this.axis.x;
var A=this.axis.x*r+this.axis.y*b;g.Abs(this.upperTranslation-this.lowerTranslation)<2*t._linearSlop?(x=g.Clamp(A,-t._maxLinearCorrection,t._maxLinearCorrection),v=g.Abs(A),l=!0):A<=this.lowerTranslation?(x=g.Clamp(A-this.lowerTranslation+t._linearSlop,-t._maxLinearCorrection,0),v=this.lowerTranslation-A,l=!0):A>=this.upperTranslation&&(x=g.Clamp(A-this.upperTranslation+t._linearSlop,0,t._maxLinearCorrection),v=A-this.upperTranslation,l=!0)}this.perp=g.MulMV(y,this.localYAxis1);this.s1=(r+z)*this.perp.y-
(b+p)*this.perp.x;this.s2=q*this.perp.y-w*this.perp.x;y=new e;z=this.perp.x*r+this.perp.y*b;v=g.Max(v,g.Abs(z));l?(l=this.invMassA,p=this.invMassB,q=this.invIA,w=this.invIB,this.K.col1.x=l+p+q*this.s1*this.s1+w*this.s2*this.s2,this.K.col1.y=q*this.s1*this.a1+w*this.s2*this.a2,this.K.col2.x=this.K.col1.y,this.K.col2.y=l+p+q*this.a1*this.a1+w*this.a2*this.a2,this.K.Solve(y,-z,-x)):(l=this.invMassA,p=this.invMassB,q=this.invIA,w=this.invIB,x=l+p+q*this.s1*this.s1+w*this.s2*this.s2,y.x=0!=x?-z/x:0,y.y=
0);x=y.x*this.perp.x+y.y*this.axis.x;l=y.x*this.perp.y+y.y*this.axis.y;z=y.x*this.s1+y.y*this.a1;y=y.x*this.s2+y.y*this.a2;c.x-=this.invMassA*x;c.y-=this.invMassA*l;d-=this.invIA*z;k.x+=this.invMassB*x;k.y+=this.invMassB*l;h+=this.invIB*y;a.sweep.a=d;f.sweep.a=h;a.SynchronizeTransform();f.SynchronizeTransform();return v<=t._linearSlop&&0<=t._angularSlop};Box2D.inherit(E,Box2D.Dynamics.Joints.JointDef);E.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;E.LineJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,
arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.localAxisA=new e};E.prototype.LineJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};E.prototype.Initialize=function(a,f,c,d){this.bodyA=a;this.bodyB=f;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d)};
Box2D.inherit(q,Box2D.Dynamics.Joints.Joint);q.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;q.MouseJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.localAnchor=new e;this.target=new e;this.impulse=new e;this.mass=new n;this.C=new e};q.prototype.GetAnchorA=function(){return this.target};q.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor)};q.prototype.GetReactionForce=function(a){void 0===
a&&(a=0);return new e(a*this.impulse.x,a*this.impulse.y)};q.prototype.GetReactionTorque=function(a){return 0};q.prototype.GetTarget=function(){return this.target};q.prototype.SetTarget=function(a){0==this.bodyB.IsAwake()&&this.bodyB.SetAwake(!0);this.target=a};q.prototype.GetMaxForce=function(){return this.maxForce};q.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.maxForce=a};q.prototype.GetFrequency=function(){return this.frequencyHz};q.prototype.SetFrequency=function(a){void 0===a&&(a=
0);this.frequencyHz=a};q.prototype.GetDampingRatio=function(){return this.dampingRatio};q.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.dampingRatio=a};q.prototype.MouseJoint=function(a){this.__super.Joint.call(this,a);this.target.SetV(a.target);var f=this.target.x-this.bodyB.xf.position.x,c=this.target.y-this.bodyB.xf.position.y,d=this.bodyB.xf.R;this.localAnchor.x=f*d.col1.x+c*d.col1.y;this.localAnchor.y=f*d.col2.x+c*d.col2.y;this.maxForce=a.maxForce;this.impulse.SetZero();this.frequencyHz=
a.frequencyHz;this.dampingRatio=a.dampingRatio;this.gamma=this.beta=0};q.prototype.InitVelocityConstraints=function(a){var f=this.bodyB,c=f.GetMass(),d=2*g.PI*this.frequencyHz,e=c*d*d;this.gamma=a.dt*(2*c*this.dampingRatio*d+a.dt*e);this.gamma=0!=this.gamma?1/this.gamma:0;this.beta=a.dt*e*this.gamma;var e=f.xf.R,c=this.localAnchor.x-f.sweep.localCenter.x,d=this.localAnchor.y-f.sweep.localCenter.y,h=e.col1.x*c+e.col2.x*d,d=e.col1.y*c+e.col2.y*d,c=h,e=f.invMass,h=f.invI;this.K1.col1.x=e;this.K1.col2.x=
0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=h*d*d;this.K2.col2.x=-h*c*d;this.K2.col1.y=-h*c*d;this.K2.col2.y=h*c*c;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.gamma;this.K.col2.y+=this.gamma;this.K.GetInverse(this.mass);this.C.x=f.sweep.c.x+c-this.target.x;this.C.y=f.sweep.c.y+d-this.target.y;f.angularVelocity*=.98;this.impulse.x*=a.dtRatio;this.impulse.y*=a.dtRatio;f.linearVelocity.x+=e*this.impulse.x;f.linearVelocity.y+=e*this.impulse.y;f.angularVelocity+=h*(c*this.impulse.y-
d*this.impulse.x)};q.prototype.SolveVelocityConstraints=function(a){var f=this.bodyB,c,d,e;c=f.xf.R;var g=this.localAnchor.x-f.sweep.localCenter.x,h=this.localAnchor.y-f.sweep.localCenter.y;d=c.col1.x*g+c.col2.x*h;h=c.col1.y*g+c.col2.y*h;g=d;d=f.linearVelocity.x+-f.angularVelocity*h;var b=f.linearVelocity.y+f.angularVelocity*g;c=this.mass;d=d+this.beta*this.C.x+this.gamma*this.impulse.x;e=b+this.beta*this.C.y+this.gamma*this.impulse.y;b=-(c.col1.x*d+c.col2.x*e);e=-(c.col1.y*d+c.col2.y*e);c=this.impulse.x;
d=this.impulse.y;this.impulse.x+=b;this.impulse.y+=e;a=a.dt*this.maxForce;this.impulse.LengthSquared()>a*a&&this.impulse.Multiply(a/this.impulse.Length());b=this.impulse.x-c;e=this.impulse.y-d;f.linearVelocity.x+=f.invMass*b;f.linearVelocity.y+=f.invMass*e;f.angularVelocity+=f.invI*(g*e-h*b)};q.prototype.SolvePositionConstraints=function(a){return!0};Box2D.inherit(G,Box2D.Dynamics.Joints.JointDef);G.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;G.MouseJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,
arguments);this.target=new e};G.prototype.MouseJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=.7};Box2D.inherit(H,Box2D.Dynamics.Joints.Joint);H.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;H.PrismaticJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.localAnchor1=new e;this.localAnchor2=new e;this.localXAxis1=new e;this.localYAxis1=new e;this.axis=new e;this.perp=new e;this.K=
new w;this.impulse=new h};H.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};H.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};H.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*(this.impulse.x*this.perp.x+(this.motorImpulse+this.impulse.z)*this.axis.x),a*(this.impulse.x*this.perp.y+(this.motorImpulse+this.impulse.z)*this.axis.y))};H.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.impulse.y};
H.prototype.GetJointTranslation=function(){var a=this.bodyA,f=this.bodyB,c=a.GetWorldPoint(this.localAnchor1),d=f.GetWorldPoint(this.localAnchor2),f=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.localXAxis1);return a.x*f+a.y*c};H.prototype.GetJointSpeed=function(){var a=this.bodyA,f=this.bodyB,c;c=a.xf.R;var d=this.localAnchor1.x-a.sweep.localCenter.x,e=this.localAnchor1.y-a.sweep.localCenter.y,g=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*e,d=g;c=f.xf.R;var h=this.localAnchor2.x-f.sweep.localCenter.x,
b=this.localAnchor2.y-f.sweep.localCenter.y,g=c.col1.x*h+c.col2.x*b,b=c.col1.y*h+c.col2.y*b,h=g;c=f.sweep.c.x+h-(a.sweep.c.x+d);var g=f.sweep.c.y+b-(a.sweep.c.y+e),l=a.GetWorldVector(this.localXAxis1),p=a.linearVelocity,n=f.linearVelocity,a=a.angularVelocity,f=f.angularVelocity;return c*-a*l.y+g*a*l.x+(l.x*(n.x+-f*b-p.x- -a*e)+l.y*(n.y+f*h-p.y-a*d))};H.prototype.IsLimitEnabled=function(){return this.enableLimit};H.prototype.EnableLimit=function(a){this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.enableLimit=
a};H.prototype.GetLowerLimit=function(){return this.lowerTranslation};H.prototype.GetUpperLimit=function(){return this.upperTranslation};H.prototype.SetLimits=function(a,f){void 0===a&&(a=0);void 0===f&&(f=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.lowerTranslation=a;this.upperTranslation=f};H.prototype.IsMotorEnabled=function(){return this.enableMotor};H.prototype.EnableMotor=function(a){this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.enableMotor=a};H.prototype.SetMotorSpeed=function(a){void 0===
a&&(a=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.motorSpeed=a};H.prototype.GetMotorSpeed=function(){return this.motorSpeed};H.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.maxMotorForce=a};H.prototype.GetMotorForce=function(){return this.motorImpulse};H.prototype.PrismaticJoint=function(a){this.__super.Joint.call(this,a);this.localAnchor1.SetV(a.localAnchorA);this.localAnchor2.SetV(a.localAnchorB);this.localXAxis1.SetV(a.localAxisA);
this.localYAxis1.x=-this.localXAxis1.y;this.localYAxis1.y=this.localXAxis1.x;this.refAngle=a.referenceAngle;this.impulse.SetZero();this.motorImpulse=this.motorMass=0;this.lowerTranslation=a.lowerTranslation;this.upperTranslation=a.upperTranslation;this.maxMotorForce=a.maxMotorForce;this.motorSpeed=a.motorSpeed;this.enableLimit=a.enableLimit;this.enableMotor=a.enableMotor;this.limitState=x.e_inactiveLimit;this.axis.SetZero();this.perp.SetZero()};H.prototype.InitVelocityConstraints=function(a){var f=
this.bodyA,c=this.bodyB,d,e;this.localCenterA.SetV(f.GetLocalCenter());this.localCenterB.SetV(c.GetLocalCenter());var h=f.GetTransform();c.GetTransform();d=f.xf.R;var r=this.localAnchor1.x-this.localCenterA.x,b=this.localAnchor1.y-this.localCenterA.y;e=d.col1.x*r+d.col2.x*b;b=d.col1.y*r+d.col2.y*b;r=e;d=c.xf.R;var l=this.localAnchor2.x-this.localCenterB.x,p=this.localAnchor2.y-this.localCenterB.y;e=d.col1.x*l+d.col2.x*p;p=d.col1.y*l+d.col2.y*p;l=e;d=c.sweep.c.x+l-f.sweep.c.x-r;e=c.sweep.c.y+p-f.sweep.c.y-
b;this.invMassA=f.invMass;this.invMassB=c.invMass;this.invIA=f.invI;this.invIB=c.invI;this.axis.SetV(g.MulMV(h.R,this.localXAxis1));this.a1=(d+r)*this.axis.y-(e+b)*this.axis.x;this.a2=l*this.axis.y-p*this.axis.x;this.motorMass=this.invMassA+this.invMassB+this.invIA*this.a1*this.a1+this.invIB*this.a2*this.a2;this.motorMass>Number.MIN_VALUE&&(this.motorMass=1/this.motorMass);this.perp.SetV(g.MulMV(h.R,this.localYAxis1));this.s1=(d+r)*this.perp.y-(e+b)*this.perp.x;this.s2=l*this.perp.y-p*this.perp.x;
h=this.invMassA;r=this.invMassB;b=this.invIA;l=this.invIB;this.K.col1.x=h+r+b*this.s1*this.s1+l*this.s2*this.s2;this.K.col1.y=b*this.s1+l*this.s2;this.K.col1.z=b*this.s1*this.a1+l*this.s2*this.a2;this.K.col2.x=this.K.col1.y;this.K.col2.y=b+l;this.K.col2.z=b*this.a1+l*this.a2;this.K.col3.x=this.K.col1.z;this.K.col3.y=this.K.col2.z;this.K.col3.z=h+r+b*this.a1*this.a1+l*this.a2*this.a2;this.enableLimit?(d=this.axis.x*d+this.axis.y*e,g.Abs(this.upperTranslation-this.lowerTranslation)<2*t._linearSlop?
this.limitState=x.e_equalLimits:d<=this.lowerTranslation?this.limitState!=x.e_atLowerLimit&&(this.limitState=x.e_atLowerLimit,this.impulse.z=0):d>=this.upperTranslation?this.limitState!=x.e_atUpperLimit&&(this.limitState=x.e_atUpperLimit,this.impulse.z=0):(this.limitState=x.e_inactiveLimit,this.impulse.z=0)):this.limitState=x.e_inactiveLimit;0==this.enableMotor&&(this.motorImpulse=0);a.warmStarting?(this.impulse.x*=a.dtRatio,this.impulse.y*=a.dtRatio,this.motorImpulse*=a.dtRatio,a=this.impulse.x*
this.perp.x+(this.motorImpulse+this.impulse.z)*this.axis.x,d=this.impulse.x*this.perp.y+(this.motorImpulse+this.impulse.z)*this.axis.y,e=this.impulse.x*this.s1+this.impulse.y+(this.motorImpulse+this.impulse.z)*this.a1,h=this.impulse.x*this.s2+this.impulse.y+(this.motorImpulse+this.impulse.z)*this.a2,f.linearVelocity.x-=this.invMassA*a,f.linearVelocity.y-=this.invMassA*d,f.angularVelocity-=this.invIA*e,c.linearVelocity.x+=this.invMassB*a,c.linearVelocity.y+=this.invMassB*d,c.angularVelocity+=this.invIB*
h):(this.impulse.SetZero(),this.motorImpulse=0)};H.prototype.SolveVelocityConstraints=function(a){var f=this.bodyA,c=this.bodyB,d=f.linearVelocity,k=f.angularVelocity,n=c.linearVelocity,r=c.angularVelocity,b,l,p;this.enableMotor&&this.limitState!=x.e_equalLimits&&(p=this.motorMass*(this.motorSpeed-(this.axis.x*(n.x-d.x)+this.axis.y*(n.y-d.y)+this.a2*r-this.a1*k)),b=this.motorImpulse,a=a.dt*this.maxMotorForce,this.motorImpulse=g.Clamp(this.motorImpulse+p,-a,a),p=this.motorImpulse-b,b=p*this.axis.x,
a=p*this.axis.y,l=p*this.a1,p*=this.a2,d.x-=this.invMassA*b,d.y-=this.invMassA*a,k-=this.invIA*l,n.x+=this.invMassB*b,n.y+=this.invMassB*a,r+=this.invIB*p);l=this.perp.x*(n.x-d.x)+this.perp.y*(n.y-d.y)+this.s2*r-this.s1*k;a=r-k;this.enableLimit&&this.limitState!=x.e_inactiveLimit?(p=this.axis.x*(n.x-d.x)+this.axis.y*(n.y-d.y)+this.a2*r-this.a1*k,b=this.impulse.Copy(),p=this.K.Solve33(new h,-l,-a,-p),this.impulse.Add(p),this.limitState==x.e_atLowerLimit?this.impulse.z=g.Max(this.impulse.z,0):this.limitState==
x.e_atUpperLimit&&(this.impulse.z=g.Min(this.impulse.z,0)),l=-l-(this.impulse.z-b.z)*this.K.col3.x,a=-a-(this.impulse.z-b.z)*this.K.col3.y,a=this.K.Solve22(new e,l,a),a.x+=b.x,a.y+=b.y,this.impulse.x=a.x,this.impulse.y=a.y,p.x=this.impulse.x-b.x,p.y=this.impulse.y-b.y,p.z=this.impulse.z-b.z,b=p.x*this.perp.x+p.z*this.axis.x,a=p.x*this.perp.y+p.z*this.axis.y,l=p.x*this.s1+p.y+p.z*this.a1,p=p.x*this.s2+p.y+p.z*this.a2):(p=this.K.Solve22(new e,-l,-a),this.impulse.x+=p.x,this.impulse.y+=p.y,b=p.x*this.perp.x,
a=p.x*this.perp.y,l=p.x*this.s1+p.y,p=p.x*this.s2+p.y);d.x-=this.invMassA*b;d.y-=this.invMassA*a;k-=this.invIA*l;n.x+=this.invMassB*b;n.y+=this.invMassB*a;r+=this.invIB*p;f.linearVelocity.SetV(d);f.angularVelocity=k;c.linearVelocity.SetV(n);c.angularVelocity=r};H.prototype.SolvePositionConstraints=function(a){a=this.bodyA;var c=this.bodyB,d=a.sweep.c,m=a.sweep.a,k=c.sweep.c,q=c.sweep.a,r,b,l,p,w=0,x;l=!1;var v=0,y=n.FromAngle(m),z=n.FromAngle(q);r=y;x=this.localAnchor1.x-this.localCenterA.x;var A=
this.localAnchor1.y-this.localCenterA.y;b=r.col1.x*x+r.col2.x*A;A=r.col1.y*x+r.col2.y*A;x=b;r=z;z=this.localAnchor2.x-this.localCenterB.x;p=this.localAnchor2.y-this.localCenterB.y;b=r.col1.x*z+r.col2.x*p;p=r.col1.y*z+r.col2.y*p;z=b;r=k.x+z-d.x-x;b=k.y+p-d.y-A;if(this.enableLimit){this.axis=g.MulMV(y,this.localXAxis1);this.a1=(r+x)*this.axis.y-(b+A)*this.axis.x;this.a2=z*this.axis.y-p*this.axis.x;var B=this.axis.x*r+this.axis.y*b;g.Abs(this.upperTranslation-this.lowerTranslation)<2*t._linearSlop?(v=
g.Clamp(B,-t._maxLinearCorrection,t._maxLinearCorrection),w=g.Abs(B),l=!0):B<=this.lowerTranslation?(v=g.Clamp(B-this.lowerTranslation+t._linearSlop,-t._maxLinearCorrection,0),w=this.lowerTranslation-B,l=!0):B>=this.upperTranslation&&(v=g.Clamp(B-this.upperTranslation+t._linearSlop,0,t._maxLinearCorrection),w=B-this.upperTranslation,l=!0)}this.perp=g.MulMV(y,this.localYAxis1);this.s1=(r+x)*this.perp.y-(b+A)*this.perp.x;this.s2=z*this.perp.y-p*this.perp.x;y=new h;A=this.perp.x*r+this.perp.y*b;z=q-
m-this.refAngle;w=g.Max(w,g.Abs(A));x=g.Abs(z);l?(l=this.invMassA,p=this.invMassB,r=this.invIA,b=this.invIB,this.K.col1.x=l+p+r*this.s1*this.s1+b*this.s2*this.s2,this.K.col1.y=r*this.s1+b*this.s2,this.K.col1.z=r*this.s1*this.a1+b*this.s2*this.a2,this.K.col2.x=this.K.col1.y,this.K.col2.y=r+b,this.K.col2.z=r*this.a1+b*this.a2,this.K.col3.x=this.K.col1.z,this.K.col3.y=this.K.col2.z,this.K.col3.z=l+p+r*this.a1*this.a1+b*this.a2*this.a2,this.K.Solve33(y,-A,-z,-v)):(l=this.invMassA,p=this.invMassB,r=this.invIA,
b=this.invIB,v=r*this.s1+b*this.s2,B=r+b,this.K.col1.Set(l+p+r*this.s1*this.s1+b*this.s2*this.s2,v,0),this.K.col2.Set(v,B,0),v=this.K.Solve22(new e,-A,-z),y.x=v.x,y.y=v.y,y.z=0);v=y.x*this.perp.x+y.z*this.axis.x;l=y.x*this.perp.y+y.z*this.axis.y;A=y.x*this.s1+y.y+y.z*this.a1;y=y.x*this.s2+y.y+y.z*this.a2;d.x-=this.invMassA*v;d.y-=this.invMassA*l;m-=this.invIA*A;k.x+=this.invMassB*v;k.y+=this.invMassB*l;q+=this.invIB*y;a.sweep.a=m;c.sweep.a=q;a.SynchronizeTransform();c.SynchronizeTransform();return w<=
t._linearSlop&&x<=t._angularSlop};Box2D.inherit(K,Box2D.Dynamics.Joints.JointDef);K.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;K.PrismaticJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.localAxisA=new e};K.prototype.PrismaticJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=
0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};K.prototype.Initialize=function(a,c,d,e){this.bodyA=a;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(y,Box2D.Dynamics.Joints.Joint);y.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;y.PulleyJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,
arguments);this.groundAnchor1=new e;this.groundAnchor2=new e;this.localAnchor1=new e;this.localAnchor2=new e;this.u1=new e;this.u2=new e};y.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};y.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};y.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.impulse*this.u2.x,a*this.impulse*this.u2.y)};y.prototype.GetReactionTorque=function(a){return 0};y.prototype.GetGroundAnchorA=
function(){var a=this.ground.xf.position.Copy();a.Add(this.groundAnchor1);return a};y.prototype.GetGroundAnchorB=function(){var a=this.ground.xf.position.Copy();a.Add(this.groundAnchor2);return a};y.prototype.GetLength1=function(){var a=this.bodyA.GetWorldPoint(this.localAnchor1),c=a.x-(this.ground.xf.position.x+this.groundAnchor1.x),a=a.y-(this.ground.xf.position.y+this.groundAnchor1.y);return g.sqrt(c*c+a*a)};y.prototype.GetLength2=function(){var a=this.bodyB.GetWorldPoint(this.localAnchor2),c=
a.x-(this.ground.xf.position.x+this.groundAnchor2.x),a=a.y-(this.ground.xf.position.y+this.groundAnchor2.y);return g.sqrt(c*c+a*a)};y.prototype.GetRatio=function(){return this.ratio};y.prototype.PulleyJoint=function(a){this.__super.Joint.call(this,a);this.ground=this.bodyA.world.groundBody;this.groundAnchor1.x=a.groundAnchorA.x-this.ground.xf.position.x;this.groundAnchor1.y=a.groundAnchorA.y-this.ground.xf.position.y;this.groundAnchor2.x=a.groundAnchorB.x-this.ground.xf.position.x;this.groundAnchor2.y=
a.groundAnchorB.y-this.ground.xf.position.y;this.localAnchor1.SetV(a.localAnchorA);this.localAnchor2.SetV(a.localAnchorB);this.ratio=a.ratio;this.constant=a.lengthA+this.ratio*a.lengthB;this.maxLength1=g.Min(a.maxLengthA,this.constant-this.ratio*y._minPulleyLength);this.maxLength2=g.Min(a.maxLengthB,(this.constant-y._minPulleyLength)/this.ratio);this.limitImpulse2=this.limitImpulse1=this.impulse=0};y.prototype.InitVelocityConstraints=function(a){var c=this.bodyA,d=this.bodyB,e;e=c.xf.R;var k=this.localAnchor1.x-
c.sweep.localCenter.x,g=this.localAnchor1.y-c.sweep.localCenter.y,h=e.col1.x*k+e.col2.x*g,g=e.col1.y*k+e.col2.y*g,k=h;e=d.xf.R;var b=this.localAnchor2.x-d.sweep.localCenter.x,l=this.localAnchor2.y-d.sweep.localCenter.y,h=e.col1.x*b+e.col2.x*l,l=e.col1.y*b+e.col2.y*l,b=h;e=d.sweep.c.x+b;var h=d.sweep.c.y+l,p=this.ground.xf.position.x+this.groundAnchor2.x,n=this.ground.xf.position.y+this.groundAnchor2.y;this.u1.Set(c.sweep.c.x+k-(this.ground.xf.position.x+this.groundAnchor1.x),c.sweep.c.y+g-(this.ground.xf.position.y+
this.groundAnchor1.y));this.u2.Set(e-p,h-n);e=this.u1.Length();h=this.u2.Length();e>t._linearSlop?this.u1.Multiply(1/e):this.u1.SetZero();h>t._linearSlop?this.u2.Multiply(1/h):this.u2.SetZero();0<this.constant-e-this.ratio*h?(this.state=x.e_inactiveLimit,this.impulse=0):this.state=x.e_atUpperLimit;e<this.maxLength1?(this.limitState1=x.e_inactiveLimit,this.limitImpulse1=0):this.limitState1=x.e_atUpperLimit;h<this.maxLength2?(this.limitState2=x.e_inactiveLimit,this.limitImpulse2=0):this.limitState2=
x.e_atUpperLimit;e=k*this.u1.y-g*this.u1.x;h=b*this.u2.y-l*this.u2.x;this.limitMass1=c.invMass+c.invI*e*e;this.limitMass2=d.invMass+d.invI*h*h;this.pulleyMass=this.limitMass1+this.ratio*this.ratio*this.limitMass2;this.limitMass1=1/this.limitMass1;this.limitMass2=1/this.limitMass2;this.pulleyMass=1/this.pulleyMass;a.warmStarting?(this.impulse*=a.dtRatio,this.limitImpulse1*=a.dtRatio,this.limitImpulse2*=a.dtRatio,a=(-this.impulse-this.limitImpulse1)*this.u1.x,e=(-this.impulse-this.limitImpulse1)*this.u1.y,
h=(-this.ratio*this.impulse-this.limitImpulse2)*this.u2.x,p=(-this.ratio*this.impulse-this.limitImpulse2)*this.u2.y,c.linearVelocity.x+=c.invMass*a,c.linearVelocity.y+=c.invMass*e,c.angularVelocity+=c.invI*(k*e-g*a),d.linearVelocity.x+=d.invMass*h,d.linearVelocity.y+=d.invMass*p,d.angularVelocity+=d.invI*(b*p-l*h)):this.limitImpulse2=this.limitImpulse1=this.impulse=0};y.prototype.SolveVelocityConstraints=function(a){a=this.bodyA;var c=this.bodyB,d;d=a.xf.R;var e=this.localAnchor1.x-a.sweep.localCenter.x,
k=this.localAnchor1.y-a.sweep.localCenter.y,h=d.col1.x*e+d.col2.x*k,k=d.col1.y*e+d.col2.y*k,e=h;d=c.xf.R;var r=this.localAnchor2.x-c.sweep.localCenter.x,b=this.localAnchor2.y-c.sweep.localCenter.y,h=d.col1.x*r+d.col2.x*b,b=d.col1.y*r+d.col2.y*b,r=h,l,p;this.state==x.e_atUpperLimit&&(d=a.linearVelocity.x+-a.angularVelocity*k,h=a.linearVelocity.y+a.angularVelocity*e,l=c.linearVelocity.x+-c.angularVelocity*b,p=c.linearVelocity.y+c.angularVelocity*r,d=-(this.u1.x*d+this.u1.y*h)-this.ratio*(this.u2.x*
l+this.u2.y*p),p=this.pulleyMass*-d,d=this.impulse,this.impulse=g.Max(0,this.impulse+p),p=this.impulse-d,d=-p*this.u1.x,h=-p*this.u1.y,l=-this.ratio*p*this.u2.x,p=-this.ratio*p*this.u2.y,a.linearVelocity.x+=a.invMass*d,a.linearVelocity.y+=a.invMass*h,a.angularVelocity+=a.invI*(e*h-k*d),c.linearVelocity.x+=c.invMass*l,c.linearVelocity.y+=c.invMass*p,c.angularVelocity+=c.invI*(r*p-b*l));this.limitState1==x.e_atUpperLimit&&(d=a.linearVelocity.x+-a.angularVelocity*k,h=a.linearVelocity.y+a.angularVelocity*
e,d=-(this.u1.x*d+this.u1.y*h),p=-this.limitMass1*d,d=this.limitImpulse1,this.limitImpulse1=g.Max(0,this.limitImpulse1+p),p=this.limitImpulse1-d,d=-p*this.u1.x,h=-p*this.u1.y,a.linearVelocity.x+=a.invMass*d,a.linearVelocity.y+=a.invMass*h,a.angularVelocity+=a.invI*(e*h-k*d));this.limitState2==x.e_atUpperLimit&&(l=c.linearVelocity.x+-c.angularVelocity*b,p=c.linearVelocity.y+c.angularVelocity*r,d=-(this.u2.x*l+this.u2.y*p),p=-this.limitMass2*d,d=this.limitImpulse2,this.limitImpulse2=g.Max(0,this.limitImpulse2+
p),p=this.limitImpulse2-d,l=-p*this.u2.x,p=-p*this.u2.y,c.linearVelocity.x+=c.invMass*l,c.linearVelocity.y+=c.invMass*p,c.angularVelocity+=c.invI*(r*p-b*l))};y.prototype.SolvePositionConstraints=function(a){a=this.bodyA;var c=this.bodyB,d,e=this.ground.xf.position.x+this.groundAnchor1.x,k=this.ground.xf.position.y+this.groundAnchor1.y,h=this.ground.xf.position.x+this.groundAnchor2.x,r=this.ground.xf.position.y+this.groundAnchor2.y,b,l,p,n,q,w,v,y=0;this.state==x.e_atUpperLimit&&(d=a.xf.R,b=this.localAnchor1.x-
a.sweep.localCenter.x,l=this.localAnchor1.y-a.sweep.localCenter.y,q=d.col1.x*b+d.col2.x*l,l=d.col1.y*b+d.col2.y*l,b=q,d=c.xf.R,p=this.localAnchor2.x-c.sweep.localCenter.x,n=this.localAnchor2.y-c.sweep.localCenter.y,q=d.col1.x*p+d.col2.x*n,n=d.col1.y*p+d.col2.y*n,p=q,d=a.sweep.c.x+b,q=a.sweep.c.y+l,w=c.sweep.c.x+p,v=c.sweep.c.y+n,this.u1.Set(d-e,q-k),this.u2.Set(w-h,v-r),d=this.u1.Length(),q=this.u2.Length(),d>t._linearSlop?this.u1.Multiply(1/d):this.u1.SetZero(),q>t._linearSlop?this.u2.Multiply(1/
q):this.u2.SetZero(),d=this.constant-d-this.ratio*q,y=g.Max(y,-d),d=g.Clamp(d+t._linearSlop,-t._maxLinearCorrection,0),v=-this.pulleyMass*d,d=-v*this.u1.x,q=-v*this.u1.y,w=-this.ratio*v*this.u2.x,v=-this.ratio*v*this.u2.y,a.sweep.c.x+=a.invMass*d,a.sweep.c.y+=a.invMass*q,a.sweep.a+=a.invI*(b*q-l*d),c.sweep.c.x+=c.invMass*w,c.sweep.c.y+=c.invMass*v,c.sweep.a+=c.invI*(p*v-n*w),a.SynchronizeTransform(),c.SynchronizeTransform());this.limitState1==x.e_atUpperLimit&&(d=a.xf.R,b=this.localAnchor1.x-a.sweep.localCenter.x,
l=this.localAnchor1.y-a.sweep.localCenter.y,q=d.col1.x*b+d.col2.x*l,l=d.col1.y*b+d.col2.y*l,b=q,d=a.sweep.c.x+b,q=a.sweep.c.y+l,this.u1.Set(d-e,q-k),d=this.u1.Length(),d>t._linearSlop?(this.u1.x*=1/d,this.u1.y*=1/d):this.u1.SetZero(),d=this.maxLength1-d,y=g.Max(y,-d),d=g.Clamp(d+t._linearSlop,-t._maxLinearCorrection,0),v=-this.limitMass1*d,d=-v*this.u1.x,q=-v*this.u1.y,a.sweep.c.x+=a.invMass*d,a.sweep.c.y+=a.invMass*q,a.sweep.a+=a.invI*(b*q-l*d),a.SynchronizeTransform());this.limitState2==x.e_atUpperLimit&&
(d=c.xf.R,p=this.localAnchor2.x-c.sweep.localCenter.x,n=this.localAnchor2.y-c.sweep.localCenter.y,q=d.col1.x*p+d.col2.x*n,n=d.col1.y*p+d.col2.y*n,p=q,w=c.sweep.c.x+p,v=c.sweep.c.y+n,this.u2.Set(w-h,v-r),q=this.u2.Length(),q>t._linearSlop?(this.u2.x*=1/q,this.u2.y*=1/q):this.u2.SetZero(),d=this.maxLength2-q,y=g.Max(y,-d),d=g.Clamp(d+t._linearSlop,-t._maxLinearCorrection,0),v=-this.limitMass2*d,w=-v*this.u2.x,v=-v*this.u2.y,c.sweep.c.x+=c.invMass*w,c.sweep.c.y+=c.invMass*v,c.sweep.a+=c.invI*(p*v-n*
w),c.SynchronizeTransform());return y<t._linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.PulleyJoint._minPulleyLength=2});Box2D.inherit(O,Box2D.Dynamics.Joints.JointDef);O.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;O.PulleyJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,arguments);this.groundAnchorA=new e;this.groundAnchorB=new e;this.localAnchorA=new e;this.localAnchorB=new e};O.prototype.PulleyJointDef=function(){this.__super.JointDef.call(this);
this.type=x.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};O.prototype.Initialize=function(a,c,d,e,k,h,r){void 0===r&&(r=0);this.bodyA=a;this.bodyB=c;this.groundAnchorA.SetV(d);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(h);a=k.x-d.x;d=k.y-d.y;this.lengthA=
g.sqrt(a*a+d*d);d=h.x-e.x;e=h.y-e.y;this.lengthB=g.sqrt(d*d+e*e);this.ratio=r;r=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=r-this.ratio*y._minPulleyLength;this.maxLengthB=(r-y._minPulleyLength)/this.ratio};Box2D.inherit(F,Box2D.Dynamics.Joints.Joint);F.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;F.RevoluteJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.K=new n;this.K1=new n;this.K2=new n;this.K3=new n;this.impulse3=new h;this.impulse2=new e;this.reduced=
new e;this.localAnchor1=new e;this.localAnchor2=new e;this.impulse=new h;this.mass=new w};F.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchor1)};F.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchor2)};F.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new e(a*this.impulse.x,a*this.impulse.y)};F.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.impulse.z};F.prototype.GetJointAngle=function(){return this.bodyB.sweep.a-
this.bodyA.sweep.a-this.referenceAngle};F.prototype.GetJointSpeed=function(){return this.bodyB.angularVelocity-this.bodyA.angularVelocity};F.prototype.IsLimitEnabled=function(){return this.enableLimit};F.prototype.EnableLimit=function(a){this.enableLimit=a};F.prototype.GetLowerLimit=function(){return this.lowerAngle};F.prototype.GetUpperLimit=function(){return this.upperAngle};F.prototype.SetLimits=function(a,c){void 0===a&&(a=0);void 0===c&&(c=0);this.lowerAngle=a;this.upperAngle=c};F.prototype.IsMotorEnabled=
function(){this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);return this.enableMotor};F.prototype.EnableMotor=function(a){this.enableMotor=a};F.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.bodyA.SetAwake(!0);this.bodyB.SetAwake(!0);this.motorSpeed=a};F.prototype.GetMotorSpeed=function(){return this.motorSpeed};F.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0);this.maxMotorTorque=a};F.prototype.GetMotorTorque=function(){return this.maxMotorTorque};F.prototype.RevoluteJoint=function(a){this.__super.Joint.call(this,
a);this.localAnchor1.SetV(a.localAnchorA);this.localAnchor2.SetV(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.impulse.SetZero();this.motorImpulse=0;this.lowerAngle=a.lowerAngle;this.upperAngle=a.upperAngle;this.maxMotorTorque=a.maxMotorTorque;this.motorSpeed=a.motorSpeed;this.enableLimit=a.enableLimit;this.enableMotor=a.enableMotor;this.limitState=x.e_inactiveLimit};F.prototype.InitVelocityConstraints=function(a){var c=this.bodyA,d=this.bodyB,e,k;e=c.xf.R;var h=this.localAnchor1.x-c.sweep.localCenter.x,
r=this.localAnchor1.y-c.sweep.localCenter.y;k=e.col1.x*h+e.col2.x*r;r=e.col1.y*h+e.col2.y*r;h=k;e=d.xf.R;var b=this.localAnchor2.x-d.sweep.localCenter.x,l=this.localAnchor2.y-d.sweep.localCenter.y;k=e.col1.x*b+e.col2.x*l;l=e.col1.y*b+e.col2.y*l;b=k;e=c.invMass;k=d.invMass;var p=c.invI,n=d.invI;this.mass.col1.x=e+k+r*r*p+l*l*n;this.mass.col2.x=-r*h*p-l*b*n;this.mass.col3.x=-r*p-l*n;this.mass.col1.y=this.mass.col2.x;this.mass.col2.y=e+k+h*h*p+b*b*n;this.mass.col3.y=h*p+b*n;this.mass.col1.z=this.mass.col3.x;
this.mass.col2.z=this.mass.col3.y;this.mass.col3.z=p+n;this.motorMass=1/(p+n);0==this.enableMotor&&(this.motorImpulse=0);if(this.enableLimit){var q=d.sweep.a-c.sweep.a-this.referenceAngle;g.Abs(this.upperAngle-this.lowerAngle)<2*t._angularSlop?this.limitState=x.e_equalLimits:q<=this.lowerAngle?(this.limitState!=x.e_atLowerLimit&&(this.impulse.z=0),this.limitState=x.e_atLowerLimit):q>=this.upperAngle?(this.limitState!=x.e_atUpperLimit&&(this.impulse.z=0),this.limitState=x.e_atUpperLimit):(this.limitState=
x.e_inactiveLimit,this.impulse.z=0)}else this.limitState=x.e_inactiveLimit;a.warmStarting?(this.impulse.x*=a.dtRatio,this.impulse.y*=a.dtRatio,this.motorImpulse*=a.dtRatio,a=this.impulse.x,q=this.impulse.y,c.linearVelocity.x-=e*a,c.linearVelocity.y-=e*q,c.angularVelocity-=p*(h*q-r*a+this.motorImpulse+this.impulse.z),d.linearVelocity.x+=k*a,d.linearVelocity.y+=k*q,d.angularVelocity+=n*(b*q-l*a+this.motorImpulse+this.impulse.z)):(this.impulse.SetZero(),this.motorImpulse=0)};F.prototype.SolveVelocityConstraints=
function(a){var c=this.bodyA,d=this.bodyB,e,k,h,r,b,l=c.linearVelocity,p=c.angularVelocity,n=d.linearVelocity,q=d.angularVelocity,t=c.invMass,w=d.invMass,v=c.invI,y=d.invI;this.enableMotor&&this.limitState!=x.e_equalLimits&&(h=this.motorMass*-(q-p-this.motorSpeed),r=this.motorImpulse,a=a.dt*this.maxMotorTorque,this.motorImpulse=g.Clamp(this.motorImpulse+h,-a,a),h=this.motorImpulse-r,p-=v*h,q+=y*h);if(this.enableLimit&&this.limitState!=x.e_inactiveLimit){e=c.xf.R;h=this.localAnchor1.x-c.sweep.localCenter.x;
r=this.localAnchor1.y-c.sweep.localCenter.y;k=e.col1.x*h+e.col2.x*r;r=e.col1.y*h+e.col2.y*r;h=k;e=d.xf.R;a=this.localAnchor2.x-d.sweep.localCenter.x;b=this.localAnchor2.y-d.sweep.localCenter.y;k=e.col1.x*a+e.col2.x*b;b=e.col1.y*a+e.col2.y*b;a=k;k=n.x+-q*b-l.x- -p*r;var z=n.y+q*a-l.y-p*h;this.mass.Solve33(this.impulse3,-k,-z,-(q-p));this.limitState==x.e_equalLimits?this.impulse.Add(this.impulse3):this.limitState==x.e_atLowerLimit?(e=this.impulse.z+this.impulse3.z,0>e&&(this.mass.Solve22(this.reduced,
-k,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.impulse.z,this.impulse.x+=this.reduced.x,this.impulse.y+=this.reduced.y,this.impulse.z=0)):this.limitState==x.e_atUpperLimit&&(e=this.impulse.z+this.impulse3.z,0<e&&(this.mass.Solve22(this.reduced,-k,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.impulse.z,this.impulse.x+=this.reduced.x,this.impulse.y+=this.reduced.y,this.impulse.z=0));l.x-=t*this.impulse3.x;l.y-=t*this.impulse3.y;
p-=v*(h*this.impulse3.y-r*this.impulse3.x+this.impulse3.z);n.x+=w*this.impulse3.x;n.y+=w*this.impulse3.y;q+=y*(a*this.impulse3.y-b*this.impulse3.x+this.impulse3.z)}else e=c.xf.R,h=this.localAnchor1.x-c.sweep.localCenter.x,r=this.localAnchor1.y-c.sweep.localCenter.y,k=e.col1.x*h+e.col2.x*r,r=e.col1.y*h+e.col2.y*r,h=k,e=d.xf.R,a=this.localAnchor2.x-d.sweep.localCenter.x,b=this.localAnchor2.y-d.sweep.localCenter.y,k=e.col1.x*a+e.col2.x*b,b=e.col1.y*a+e.col2.y*b,a=k,this.mass.Solve22(this.impulse2,-(n.x+
-q*b-l.x- -p*r),-(n.y+q*a-l.y-p*h)),this.impulse.x+=this.impulse2.x,this.impulse.y+=this.impulse2.y,l.x-=t*this.impulse2.x,l.y-=t*this.impulse2.y,p-=v*(h*this.impulse2.y-r*this.impulse2.x),n.x+=w*this.impulse2.x,n.y+=w*this.impulse2.y,q+=y*(a*this.impulse2.y-b*this.impulse2.x);c.linearVelocity.SetV(l);c.angularVelocity=p;d.linearVelocity.SetV(n);d.angularVelocity=q};F.prototype.SolvePositionConstraints=function(a){var c,d;a=this.bodyA;var e=this.bodyB,k=0,h,n,b;if(this.enableLimit&&this.limitState!=
x.e_inactiveLimit){c=e.sweep.a-a.sweep.a-this.referenceAngle;var l=0;this.limitState==x.e_equalLimits?(c=g.Clamp(c-this.lowerAngle,-t._maxAngularCorrection,t._maxAngularCorrection),l=-this.motorMass*c,k=g.Abs(c)):this.limitState==x.e_atLowerLimit?(c-=this.lowerAngle,k=-c,c=g.Clamp(c+t._angularSlop,-t._maxAngularCorrection,0),l=-this.motorMass*c):this.limitState==x.e_atUpperLimit&&(k=c-=this.upperAngle,c=g.Clamp(c-t._angularSlop,0,t._maxAngularCorrection),l=-this.motorMass*c);a.sweep.a-=a.invI*l;e.sweep.a+=
e.invI*l;a.SynchronizeTransform();e.SynchronizeTransform()}d=a.xf.R;l=this.localAnchor1.x-a.sweep.localCenter.x;c=this.localAnchor1.y-a.sweep.localCenter.y;h=d.col1.x*l+d.col2.x*c;c=d.col1.y*l+d.col2.y*c;l=h;d=e.xf.R;var p=this.localAnchor2.x-e.sweep.localCenter.x,q=this.localAnchor2.y-e.sweep.localCenter.y;h=d.col1.x*p+d.col2.x*q;q=d.col1.y*p+d.col2.y*q;p=h;n=e.sweep.c.x+p-a.sweep.c.x-l;b=e.sweep.c.y+q-a.sweep.c.y-c;var w=n*n+b*b;d=g.sqrt(w);h=a.invMass;var v=e.invMass,y=a.invI,z=e.invI,A=10*t._linearSlop;
w>A*A&&(w=1/(h+v),n=w*-n,b=w*-b,a.sweep.c.x-=.5*h*n,a.sweep.c.y-=.5*h*b,e.sweep.c.x+=.5*v*n,e.sweep.c.y+=.5*v*b,n=e.sweep.c.x+p-a.sweep.c.x-l,b=e.sweep.c.y+q-a.sweep.c.y-c);this.K1.col1.x=h+v;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h+v;this.K2.col1.x=y*c*c;this.K2.col2.x=-y*l*c;this.K2.col1.y=-y*l*c;this.K2.col2.y=y*l*l;this.K3.col1.x=z*q*q;this.K3.col2.x=-z*p*q;this.K3.col1.y=-z*p*q;this.K3.col2.y=z*p*p;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(F.tImpulse,
-n,-b);n=F.tImpulse.x;b=F.tImpulse.y;a.sweep.c.x-=a.invMass*n;a.sweep.c.y-=a.invMass*b;a.sweep.a-=a.invI*(l*b-c*n);e.sweep.c.x+=e.invMass*n;e.sweep.c.y+=e.invMass*b;e.sweep.a+=e.invI*(p*b-q*n);a.SynchronizeTransform();e.SynchronizeTransform();return d<=t._linearSlop&&k<=t._angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.RevoluteJoint.tImpulse=new e});Box2D.inherit(I,Box2D.Dynamics.Joints.JointDef);I.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;I.RevoluteJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,
arguments);this.localAnchorA=new e;this.localAnchorB=new e};I.prototype.RevoluteJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};I.prototype.Initialize=function(a,c,d){this.bodyA=a;this.bodyB=c;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.referenceAngle=
this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(P,Box2D.Dynamics.Joints.Joint);P.prototype.__super=Box2D.Dynamics.Joints.Joint.prototype;P.WeldJoint=function(){Box2D.Dynamics.Joints.Joint.Joint.apply(this,arguments);this.localAnchorA=new e;this.localAnchorB=new e;this.impulse=new h;this.mass=new w};P.prototype.GetAnchorA=function(){return this.bodyA.GetWorldPoint(this.localAnchorA)};P.prototype.GetAnchorB=function(){return this.bodyB.GetWorldPoint(this.localAnchorB)};P.prototype.GetReactionForce=
function(a){void 0===a&&(a=0);return new e(a*this.impulse.x,a*this.impulse.y)};P.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.impulse.z};P.prototype.WeldJoint=function(a){this.__super.Joint.call(this,a);this.localAnchorA.SetV(a.localAnchorA);this.localAnchorB.SetV(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.impulse.SetZero();this.mass=new w};P.prototype.InitVelocityConstraints=function(a){var c,d,e=this.bodyA,k=this.bodyB;c=e.xf.R;var h=this.localAnchorA.x-
e.sweep.localCenter.x,g=this.localAnchorA.y-e.sweep.localCenter.y;d=c.col1.x*h+c.col2.x*g;g=c.col1.y*h+c.col2.y*g;h=d;c=k.xf.R;var b=this.localAnchorB.x-k.sweep.localCenter.x,l=this.localAnchorB.y-k.sweep.localCenter.y;d=c.col1.x*b+c.col2.x*l;l=c.col1.y*b+c.col2.y*l;b=d;c=e.invMass;d=k.invMass;var p=e.invI,n=k.invI;this.mass.col1.x=c+d+g*g*p+l*l*n;this.mass.col2.x=-g*h*p-l*b*n;this.mass.col3.x=-g*p-l*n;this.mass.col1.y=this.mass.col2.x;this.mass.col2.y=c+d+h*h*p+b*b*n;this.mass.col3.y=h*p+b*n;this.mass.col1.z=
this.mass.col3.x;this.mass.col2.z=this.mass.col3.y;this.mass.col3.z=p+n;a.warmStarting?(this.impulse.x*=a.dtRatio,this.impulse.y*=a.dtRatio,this.impulse.z*=a.dtRatio,e.linearVelocity.x-=c*this.impulse.x,e.linearVelocity.y-=c*this.impulse.y,e.angularVelocity-=p*(h*this.impulse.y-g*this.impulse.x+this.impulse.z),k.linearVelocity.x+=d*this.impulse.x,k.linearVelocity.y+=d*this.impulse.y,k.angularVelocity+=n*(b*this.impulse.y-l*this.impulse.x+this.impulse.z)):this.impulse.SetZero()};P.prototype.SolveVelocityConstraints=
function(a){var c,d;a=this.bodyA;var e=this.bodyB,k=a.linearVelocity,g=a.angularVelocity,n=e.linearVelocity,b=e.angularVelocity,l=a.invMass,p=e.invMass,q=a.invI,t=e.invI;c=a.xf.R;var w=this.localAnchorA.x-a.sweep.localCenter.x,v=this.localAnchorA.y-a.sweep.localCenter.y;d=c.col1.x*w+c.col2.x*v;v=c.col1.y*w+c.col2.y*v;w=d;c=e.xf.R;var x=this.localAnchorB.x-e.sweep.localCenter.x,y=this.localAnchorB.y-e.sweep.localCenter.y;d=c.col1.x*x+c.col2.x*y;y=c.col1.y*x+c.col2.y*y;x=d;c=n.x-b*y-k.x+g*v;d=n.y+b*
x-k.y-g*w;var z=b-g,A=new h;this.mass.Solve33(A,-c,-d,-z);this.impulse.Add(A);k.x-=l*A.x;k.y-=l*A.y;g-=q*(w*A.y-v*A.x+A.z);n.x+=p*A.x;n.y+=p*A.y;b+=t*(x*A.y-y*A.x+A.z);a.angularVelocity=g;e.angularVelocity=b};P.prototype.SolvePositionConstraints=function(a){var c,d;a=this.bodyA;var e=this.bodyB;c=a.xf.R;var k=this.localAnchorA.x-a.sweep.localCenter.x,n=this.localAnchorA.y-a.sweep.localCenter.y;d=c.col1.x*k+c.col2.x*n;n=c.col1.y*k+c.col2.y*n;k=d;c=e.xf.R;var q=this.localAnchorB.x-e.sweep.localCenter.x,
b=this.localAnchorB.y-e.sweep.localCenter.y;d=c.col1.x*q+c.col2.x*b;b=c.col1.y*q+c.col2.y*b;q=d;c=a.invMass;d=e.invMass;var l=a.invI,p=e.invI,w=e.sweep.c.x+q-a.sweep.c.x-k,v=e.sweep.c.y+b-a.sweep.c.y-n,x=e.sweep.a-a.sweep.a-this.referenceAngle,y=10*t._linearSlop,z=g.sqrt(w*w+v*v),A=g.Abs(x);z>y&&(l*=1,p*=1);this.mass.col1.x=c+d+n*n*l+b*b*p;this.mass.col2.x=-n*k*l-b*q*p;this.mass.col3.x=-n*l-b*p;this.mass.col1.y=this.mass.col2.x;this.mass.col2.y=c+d+k*k*l+q*q*p;this.mass.col3.y=k*l+q*p;this.mass.col1.z=
this.mass.col3.x;this.mass.col2.z=this.mass.col3.y;this.mass.col3.z=l+p;y=new h;this.mass.Solve33(y,-w,-v,-x);a.sweep.c.x-=c*y.x;a.sweep.c.y-=c*y.y;a.sweep.a-=l*(k*y.y-n*y.x+y.z);e.sweep.c.x+=d*y.x;e.sweep.c.y+=d*y.y;e.sweep.a+=p*(q*y.y-b*y.x+y.z);a.SynchronizeTransform();e.SynchronizeTransform();return z<=t._linearSlop&&A<=t._angularSlop};Box2D.inherit(L,Box2D.Dynamics.Joints.JointDef);L.prototype.__super=Box2D.Dynamics.Joints.JointDef.prototype;L.WeldJointDef=function(){Box2D.Dynamics.Joints.JointDef.JointDef.apply(this,
arguments);this.localAnchorA=new e;this.localAnchorB=new e};L.prototype.WeldJointDef=function(){this.__super.JointDef.call(this);this.type=x.e_weldJoint;this.referenceAngle=0};L.prototype.Initialize=function(a,c,d){this.bodyA=a;this.bodyB=c;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var t=Box2D.Dynamics.DebugDraw;t.DebugDraw=function(){this.xformScale=this.fillAlpha=this.alpha=this.lineThickness=this.drawScale=1;var n=this;this.sprite={graphics:{clear:function(){n.ctx.clearRect(0,0,n.ctx.canvas.width,n.ctx.canvas.height)}}}};t.prototype._color=function(n,t){return"rgba("+((n&16711680)>>16)+","+((n&65280)>>8)+","+(n&255)+","+t+")"};t.prototype.DebugDraw=function(){this.drawFlags=0};t.prototype.SetFlags=function(n){void 0===n&&(n=0);this.drawFlags=n};t.prototype.GetFlags=
function(){return this.drawFlags};t.prototype.AppendFlags=function(n){void 0===n&&(n=0);this.drawFlags|=n};t.prototype.ClearFlags=function(n){void 0===n&&(n=0);this.drawFlags&=~n};t.prototype.SetSprite=function(n){this.ctx=n};t.prototype.GetSprite=function(){return this.ctx};t.prototype.SetDrawScale=function(n){void 0===n&&(n=0);this.drawScale=n};t.prototype.GetDrawScale=function(){return this.drawScale};t.prototype.SetLineThickness=function(n){void 0===n&&(n=0);this.lineThickness=n;this.ctx.strokeWidth=
n};t.prototype.GetLineThickness=function(){return this.lineThickness};t.prototype.SetAlpha=function(n){void 0===n&&(n=0);this.alpha=n};t.prototype.GetAlpha=function(){return this.alpha};t.prototype.SetFillAlpha=function(n){void 0===n&&(n=0);this.fillAlpha=n};t.prototype.GetFillAlpha=function(){return this.fillAlpha};t.prototype.SetXFormScale=function(n){void 0===n&&(n=0);this.xformScale=n};t.prototype.GetXFormScale=function(){return this.xformScale};t.prototype.DrawPolygon=function(n,t,g){if(t){var e=
this.ctx,h=this.drawScale;e.beginPath();e.strokeStyle=this._color(g.color,this.alpha);e.moveTo(n[0].x*h,n[0].y*h);for(g=1;g<t;g++)e.lineTo(n[g].x*h,n[g].y*h);e.lineTo(n[0].x*h,n[0].y*h);e.closePath();e.stroke()}};t.prototype.DrawSolidPolygon=function(n,t,g){if(t){var e=this.ctx,h=this.drawScale;e.beginPath();e.strokeStyle=this._color(g.color,this.alpha);e.fillStyle=this._color(g.color,this.fillAlpha);e.moveTo(n[0].x*h,n[0].y*h);for(g=1;g<t;g++)e.lineTo(n[g].x*h,n[g].y*h);e.lineTo(n[0].x*h,n[0].y*
h);e.closePath();e.fill();e.stroke()}};t.prototype.DrawCircle=function(n,t,g){if(t){var e=this.ctx,h=this.drawScale;e.beginPath();e.strokeStyle=this._color(g.color,this.alpha);e.arc(n.x*h,n.y*h,t*h,0,2*Math.PI,!0);e.closePath();e.stroke()}};t.prototype.DrawSolidCircle=function(n,t,g,e){if(t){var h=this.ctx,A=this.drawScale,c=n.x*A,v=n.y*A;h.moveTo(0,0);h.beginPath();h.strokeStyle=this._color(e.color,this.alpha);h.fillStyle=this._color(e.color,this.fillAlpha);h.arc(c,v,t*A,0,2*Math.PI,!0);h.moveTo(c,
v);h.lineTo((n.x+g.x*t)*A,(n.y+g.y*t)*A);h.closePath();h.fill();h.stroke()}};t.prototype.DrawSegment=function(n,t,g){var e=this.ctx,h=this.drawScale;e.strokeStyle=this._color(g.color,this.alpha);e.beginPath();e.moveTo(n.x*h,n.y*h);e.lineTo(t.x*h,t.y*h);e.closePath();e.stroke()};t.prototype.DrawTransform=function(n){var t=this.ctx,g=this.drawScale;t.beginPath();t.strokeStyle=this._color(16711680,this.alpha);t.moveTo(n.position.x*g,n.position.y*g);t.lineTo((n.position.x+this.xformScale*n.R.col1.x)*
g,(n.position.y+this.xformScale*n.R.col1.y)*g);t.strokeStyle=this._color(65280,this.alpha);t.moveTo(n.position.x*g,n.position.y*g);t.lineTo((n.position.x+this.xformScale*n.R.col2.x)*g,(n.position.y+this.xformScale*n.R.col2.y)*g);t.closePath();t.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;
